{"version":3,"names":["_zegoUikitRn","_interopRequireWildcard","require","_logger","_reactNativeEncryptedStorage","_interopRequireDefault","_EventEmitter","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","_appInfo","_localUser","_pluginConnectionState","ZIMKitPlugin","_install","plugins","ZegoUIKit","installPlugins","forEach","plugin","ZIMKit","zloginfo","getModuleName","temp","_storeLoginInfo","EncryptedStorage","setItem","JSON","stringify","userID","userName","appID","appSign","error","zlogerror","ZegoPrebuiltPlugins","init","ZegoUIKitLogger","logSetUserID","callbackID","String","Math","floor","random","getSignalingPlugin","onConnectionStateChanged","state","login","then","eventEmitter","emit","EventName","LOGINED","reconnectIfDisconnected","ZegoInvitationConnectionState","disconnected","logout","uninit","getLocalUser","getAppInfo","getZIMKitPlugin","loadLoginInfoFromLocalEncryptedStorage","loginInfoStr","getItem","parse","Promise","resolve","undefined","_default","exports"],"sources":["plugins.js"],"sourcesContent":["import ZegoUIKit, {\n  ZegoInvitationConnectionState,\n  ZegoUIKitLogger,\n} from '@zegocloud/zego-uikit-rn';\nimport { zlogerror, zloginfo } from '../../utils/logger';\nimport EncryptedStorage from 'react-native-encrypted-storage';\nimport { eventEmitter, EventName } from '../../utils/EventEmitter';\n\nconst _appInfo = {};\nconst _localUser = {};\nlet _pluginConnectionState;\nlet ZIMKitPlugin = null;\n\nconst _install = (plugins) => {\n  ZegoUIKit.installPlugins(plugins);\n  plugins.forEach(plugin => {\n    if (plugin.ZIMKit) {\n      zloginfo('[Plugins] install ZIMKit success.');\n      ZIMKitPlugin = plugin;\n    } else if (plugin.default && typeof plugin.default.getModuleName === 'function') {\n      const temp = plugin.default.getModuleName();\n      if (temp === 'ZIMKit') {\n        zloginfo('[Plugins] install ZIMKit success.');\n        ZIMKitPlugin = plugin;\n      }\n    }\n  })\n};\n\nconst _storeLoginInfo = async () => {\n  try {\n    await EncryptedStorage.setItem(\n      \"_ZegoUIKitPrebuiltCallLoginInfo\",\n      JSON.stringify({\n        userID: _localUser.userID,\n        userName: _localUser.userName,\n        appID: _appInfo.appID,\n        appSign: _appInfo.appSign,\n      })\n    );\n  } catch (error) {\n    zlogerror('[Plugins] _storeLoginInfo error', error)\n  }\n}\n\nconst ZegoPrebuiltPlugins = {\n  init: (appID, appSign, userID, userName, plugins) => {\n    ZegoUIKitLogger.logSetUserID(userID)\n\n    zloginfo('[ZegoPrebuiltPlugins] init', {\n      appID,\n      userID,\n      userName,\n    });\n\n    const callbackID =\n      'ZegoPrebuiltPlugins' + String(Math.floor(Math.random() * 10000));\n    _install(plugins);\n    ZegoUIKit.getSignalingPlugin().init(appID, appSign);\n    ZegoUIKit.getSignalingPlugin().onConnectionStateChanged(\n      callbackID,\n      ({ state }) => {\n        _pluginConnectionState = state;\n      }\n    );\n    _appInfo.appID = appID;\n    _appInfo.appSign = appSign;\n    _localUser.userID = userID;\n    _localUser.userName = userName;\n    _storeLoginInfo();\n\n    return ZegoUIKit.getSignalingPlugin()\n      .login(userID, userName)\n      .then(() => {\n        zloginfo(`[Plugins] login success. userID: ${userID}, userName: ${userName}`);\n        eventEmitter.emit(EventName.LOGINED, { userID, userName });\n      });\n  },\n  reconnectIfDisconnected: () => {\n    zloginfo(\n      '[Plugins] reconnectIfDisconnected',\n      _pluginConnectionState,\n      ZegoInvitationConnectionState.disconnected\n    );\n    if (_pluginConnectionState === ZegoInvitationConnectionState.disconnected) {\n      ZegoUIKit.getSignalingPlugin().logout().then(() => {\n        zloginfo('[Plugins] auto logout success.');\n        ZegoUIKit.getSignalingPlugin().login(\n          _localUser.userID,\n          _localUser.userName\n        ).then(() => {\n          zloginfo('[Plugins] auto reconnect success.');\n        });\n      });\n    }\n  },\n  uninit: () => {\n    zloginfo('[ZegoPrebuiltPlugins] uninit');\n\n    delete _appInfo.appID;\n    delete _appInfo.appSign;\n    delete _localUser.userID;\n    delete _localUser.userName;\n    ZegoUIKit.getSignalingPlugin().logout();\n    ZegoUIKit.getSignalingPlugin().uninit();\n  },\n  getLocalUser: () => {\n    return _localUser;\n  },\n  getAppInfo: () => {\n    return _appInfo;\n  },\n  getZIMKitPlugin: () => {\n    return ZIMKitPlugin;\n  },\n  loadLoginInfoFromLocalEncryptedStorage: async () => {\n    try {\n      const loginInfoStr = await EncryptedStorage.getItem(\n        \"_ZegoUIKitPrebuiltCallLoginInfo\"\n      );\n      if (loginInfoStr) {\n        return JSON.parse(loginInfoStr);\n      }\n    } catch (error) {\n      zlogerror('[Plugins] getAppInfoFromLocalEncryptedStorage error', error)\n      return Promise.resolve(undefined)\n    }\n  }\n};\n\nexport default ZegoPrebuiltPlugins;\n"],"mappings":"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","ignoreList":[]}