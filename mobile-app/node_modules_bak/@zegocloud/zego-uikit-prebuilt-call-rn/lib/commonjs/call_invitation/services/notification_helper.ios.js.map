{"version":3,"names":["_reactNative","require","_reactNativeSound","_reactNativeUuid","_interopRequireDefault","_zegoUikitRn","_services","_logger","_report","_call_invite_helper","_defines","_inner_text_helper","_plugins","_NotificationHelper","e","__esModule","default","_defineProperty","r","t","_toPropertyKey","Object","defineProperty","value","enumerable","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","NotificationHelper","constructor","ZegoUIKit","getSignalingPlugin","getZegoUIKitSignalingPlugin","getInstance","TAG","Math","floor","random","Map","AppState","addEventListener","nextState","zloginfo","dismissNotification","_currentCallID","_instance","init","_uikitSignalingPlugin","onCallKitEndCall","_onCallKitEndCall","bind","onCallKitAnswerCall","_onCallKitAnswerCall","showOfflineNotification","callID","callUUID","callData","zlogerror","JSON","stringify","notifyUuid","_callIDUuidMap","get","reportCallKitCallEnded","set","call_id","roomID","type","inviter","invitees","_currentCallStatus","_refuse","undefined","PrebuiltCallReport","reportEvent","_callData","isPureOfflinePush","showOnlineNotification","uuid","v4","callerName","InnerTextHelper","instance","getIncomingCallDialogTitle","name","length","cxCallUpdate","localizedCallerName","hasVideo","ZegoInvitationType","videoCall","reportIncomingCall","then","catch","message","currentState","reason","from","action","hangUp","fulfill","_callbackID","appState","_signalingPlugin","onLoginSuccess","refuseInvitation","id","userID","ZegoPrebuiltPlugins","getLocalUser","userName","result","code","CallInviteHelper","refuseCall","error","fail","app_state","setOfflineData","setCategory","acceptCall","acceptInvitation","ZegoUIKitPrebuiltCallService","getCurrentInCallID","exports"],"sources":["notification_helper.ios.tsx"],"sourcesContent":["import { AppState } from 'react-native';\n// @ts-ignore\nimport { setCategory } from 'react-native-sound';\nimport uuid from 'react-native-uuid';\n\nimport ZegoUIKit, { CXAction, CXCallUpdate, ZegoPluginResult } from '@zegocloud/zego-uikit-rn';\nimport { ZIMError } from 'zego-zim-react-native';\n\nimport ZegoUIKitPrebuiltCallService from '../../services';\nimport { zlogerror, zloginfo } from '../../utils/logger';\nimport PrebuiltCallReport from '../../utils/report';\nimport CallInviteHelper from './call_invite_helper';\nimport { ZegoInvitationType } from './defines';\nimport InnerTextHelper from './inner_text_helper';\nimport ZegoPrebuiltPlugins from './plugins';\n\nexport type CallStatus = 'waiting' | 'notification' | 'calling';\n\nexport default class NotificationHelper {\n    TAG = 'NotificationHelper';\n    static _instance: NotificationHelper;\n\n    _signalingPlugin = ZegoUIKit.getSignalingPlugin()\n    _uikitSignalingPlugin = ZegoUIKit.getSignalingPlugin().getZegoUIKitSignalingPlugin().getInstance()\n    _callbackID = `${this.TAG}_${String(Math.floor(Math.random() * 10000))}`\n\n    _callData = {};\n    _callIDUuidMap = new Map<string, string>();\n    _currentCallID = '';\n    _currentCallStatus: CallStatus = 'waiting'\n\n    constructor() {\n        AppState.addEventListener('change', async nextState => {\n            zloginfo('nextState', nextState);\n            if (nextState === 'active') {\n                this.dismissNotification(this._currentCallID, 'active', this.TAG)\n            }\n        });\n    }\n    static getInstance() {\n        return this._instance || (this._instance = new NotificationHelper());\n    }\n\n    init() {\n        zloginfo(`[NotificationHelper][init]`)\n\n        this._uikitSignalingPlugin.onCallKitEndCall(this._onCallKitEndCall.bind(this))\n        zloginfo(`[NotificationHelper][init] set onCallKitEndCall`)\n\n        this._uikitSignalingPlugin.onCallKitAnswerCall(this._onCallKitAnswerCall.bind(this))\n        zloginfo(`[NotificationHelper][init] set onCallKitAnswerCall`)\n    }\n\n    // for offline call\n    showOfflineNotification(callID: string, callUUID: string, callData: any) {\n        if (!callData) {\n            zlogerror('[NotificationHelper][showOfflineNotification] callData is empty')\n            return\n        }\n        zloginfo(`[NotificationHelper][showOfflineNotification] callID: ${callID}, callUUID: ${callUUID}, callData: ${JSON.stringify(callData)}`)\n\n        let notifyUuid = this._callIDUuidMap.get(callID);\n        if (notifyUuid) {\n            zloginfo(`[NotificationHelper][showOfflineNotification] callID: ${callID} ignore, already shown notification`)\n            this._uikitSignalingPlugin.reportCallKitCallEnded(callUUID, 2)    // 2 - RemoteEnded\n            return\n        }\n        this._callIDUuidMap.set(callID, callUUID)\n\n        let { call_id: roomID, type, inviter, invitees } = callData;\n\n        if (this._currentCallID && this._currentCallStatus === 'notification') {\n            zloginfo(`[NotificationHelper][showOfflineNotification] another call is showing`)\n\n            this._refuse(undefined, callID, roomID, inviter, 'busy', 'restarted')\n            this._uikitSignalingPlugin.reportCallKitCallEnded(callUUID, 2)    // 2 - RemoteEnded\n\n            PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                'call_id': callID,\n                'app_state': 'restarted',\n                'action': 'busy'\n            })\n            return;\n        }\n\n        this._currentCallID = callID\n        this._currentCallStatus = 'notification'\n        zloginfo(`[NotificationHelper][showOfflineNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n        \n        zloginfo(`[NotificationHelper][showOfflineNotification] displayIncomingCall callID: ${callID}`)\n\n        // callID mean zim callID\n        this._callData = { callID, roomID, type, inviter, invitees, isPureOfflinePush: true }\n        zloginfo(`[NotificationHelper][showOfflineNotification] _callData: ${JSON.stringify(this._callData)}`)\n    }\n\n    // for online call when background\n    showOnlineNotification(callID: string, callData: any) {\n        let notifyUuid = this._callIDUuidMap.get(callID);\n        if (notifyUuid) {\n            zloginfo(`[NotificationHelper][showOnlineNotification] callID: ${callID} ignore, already shown notification`)\n            return\n        }\n\n        if (!callData) {\n            zlogerror('[NotificationHelper][showOnlineNotification] _callData is empty')\n            return\n        }\n\n        // @ts-ignore\n        let { roomID, type, inviter, invitees } = callData;\n\n        zloginfo(`[NotificationHelper][showOnlineNotification] callID: ${callID}, roomID: ${roomID}, isVideoCall: ${type}, inviter: ${JSON.stringify(inviter)}, invitees: ${JSON.stringify(invitees)}`)\n        \n        notifyUuid = uuid.v4();\n        zloginfo(`[NotificationHelper][showOnlineNotification] reportIncomingCall callID: ${callID}, uuid: ${notifyUuid}`)\n\n        const callerName = InnerTextHelper.instance().getIncomingCallDialogTitle(inviter.name, type, invitees.length);\n        zloginfo(`[NotificationHelper][showOnlineNotification], callerName: ${callerName}`);\n        \n        let cxCallUpdate = { } as CXCallUpdate;\n        cxCallUpdate.localizedCallerName = callerName\n        cxCallUpdate.hasVideo = (type === ZegoInvitationType.videoCall)\n        this._uikitSignalingPlugin.reportIncomingCall(cxCallUpdate, notifyUuid).then(() => {\n            zloginfo(`[NotificationHelper][showOnlineNotification] reportIncomingCall succeeded, callID: ${callID}`)\n        }).catch((message: string) => {\n            zlogerror(`[NotificationHelper][showOnlineNotification] reportIncomingCall failed, reason: ${message}`)\n        })\n        \n        this._currentCallID = callID\n        this._currentCallStatus = 'notification'\n        zloginfo(`[NotificationHelper][showOnlineNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n        this._callIDUuidMap.set(callID, notifyUuid)\n        zloginfo(`[NotificationHelper][showOnlineNotification] set ${callID} into _callIDUuidMap`)\n\n        PrebuiltCallReport.reportEvent('call/displayNotification', {\n            'call_id': callID,\n            'app_state': AppState.currentState\n        })\n\n        this._callData = { callID, roomID, type, inviter, invitees }\n        zloginfo(`[NotificationHelper][showOnlineNotification] _callData: ${JSON.stringify(this._callData)}`)\n    }\n\n    dismissNotification(callID: string, reason: string, from: string) {\n        zloginfo(`[NotificationHelper][dismissNotification] callID: ${callID}, reason: ${reason}, from: ${from}`)\n\n        if (reason === 'active') {\n            // Handed over to the active state for handling\n            let notifyUuid = this._callIDUuidMap.get(callID);\n            if (notifyUuid) {\n                this._uikitSignalingPlugin.reportCallKitCallEnded(notifyUuid, 2)    // 2 - RemoteEnded\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][dismissNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n            }\n        } else if (reason === 'BeCancelled' || reason === 'Timeout') {\n            if (!callID || callID !== this._currentCallID) {\n                zloginfo(`[NotificationHelper][dismissNotification] ignore callID: ${callID}`)\n                return\n            }\n    \n            let notifyUuid = this._callIDUuidMap.get(callID);\n            if (notifyUuid) {\n                this._uikitSignalingPlugin.reportCallKitCallEnded(notifyUuid, 2)    // 2 - RemoteEnded\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][dismissNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n                PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                    'call_id': callID,\n                    'app_state': AppState.currentState,\n                    'action': reason\n                })\n            }\n        }\n    }\n\n    _onCallKitEndCall(action: CXAction) {\n        if (!this._callData) {\n            zlogerror('[NotificationHelper][_onCallKitEndCall] _callData is empty')\n            return\n        }\n        zloginfo(`[NotificationHelper][_onCallKitEndCall] callData: ${JSON.stringify(this._callData)}, state: ${AppState.currentState}`)\n        \n        // Offline incoming calls are not supported (too early), and online incoming calls rely on ZegoCallInvitationDialog\n        // CallEventNotifyApp.getInstance().notifyIncomingCallDeclineButtonPressed()\n        \n        if (this._currentCallID && this._currentCallStatus === 'calling') {\n            // click accept and hangup\n            this.hangUp(this._currentCallID, 'onCallKitEndCall')\n            zloginfo(`[NotificationHelper][_onCallKitEndCall] hangUp`)\n            this._currentCallID = ''\n            this._currentCallStatus = 'waiting'\n            zloginfo(`[NotificationHelper][_onCallKitEndCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n            action.fulfill();\n        } else {\n            // click decline button from notification\n        \n            // @ts-ignore\n            let { callID, roomID, inviter } = this._callData;\n            this._callData = undefined\n\n            zloginfo(`[NotificationHelper][_onCallKitEndCall] will refuse after signalingPlugin login succ, callbackID: ${this._callbackID}`)\n            this._refuse(action, callID, roomID, inviter, 'refuse', AppState.currentState)\n        }\n    }\n\n    _refuse(action: CXAction, callID: string, roomID: string, inviter: any, reason: string, appState: string) {\n        this._signalingPlugin.onLoginSuccess(this._callbackID, () => {\n            // tell caller\n            this._signalingPlugin.refuseInvitation(inviter.id, JSON.stringify({\n                callID, \n                call_id: roomID,\n                // @ts-ignore\n                'invitee': {userID: ZegoPrebuiltPlugins.getLocalUser().userID, userName: ZegoPrebuiltPlugins.getLocalUser().userName}\n            }))\n            .then((result: ZegoPluginResult) => {\n                zloginfo(`[NotificationHelper][_onCallKitEndCall] refuseInvitation then, code: ${result.code}, message: ${result.message}`)\n\n                PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                    'call_id': callID,\n                    'app_state': appState,\n                    'action': reason\n                })\n        \n                CallInviteHelper.getInstance().refuseCall(callID);\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][_onCallKitEndCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n                // tell ios decline completion\n                if (action) {\n                    action.fulfill();\n                }\n            })\n            .catch((error: ZIMError) => {\n                zloginfo(`[NotificationHelper][_onCallKitEndCall] refuseInvitation catch, error: ${error.code}, message: ${error.message}`)\n\n                CallInviteHelper.getInstance().refuseCall(callID);\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][_onCallKitEndCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n                // tell ios decline fail\n                if (action) {\n                    action.fail();\n                }\n            })\n\n            this._signalingPlugin.onLoginSuccess(this._callbackID)\n        })\n    }\n\n    _onCallKitAnswerCall(action: CXAction) {\n        if (!this._callData) {\n            zlogerror('[NotificationHelper][_onCallKitAnswerCall] _callData is empty')\n            return\n        }\n        zloginfo(`[NotificationHelper][_onCallKitAnswerCall] callData: ${JSON.stringify(this._callData)}, state: ${AppState.currentState}`)\n\n        // @ts-ignore\n        let { callID, roomID, type, inviter, invitees, isPureOfflinePush } = this._callData;\n        // this._callData = undefined   // Do not clear it, as it will still be needed when the VoIP call is hangup later.\n\n        zloginfo(`[NotificationHelper][_onCallKitAnswerCall] will accept after signalingPlugin login succ, callbackID: ${this._callbackID}`)\n        this._signalingPlugin.onLoginSuccess(this._callbackID, () => {\n            let app_state: string = AppState.currentState\n            if (isPureOfflinePush) {\n                CallInviteHelper.getInstance().setOfflineData({call_id: roomID, type, inviter, invitees});\n                app_state = \"restarted\"\n            }\n\n            setCategory('PlayAndRecord');\n            CallInviteHelper.getInstance().acceptCall(callID, {call_id: roomID, type, inviter, invitees});\n            ZegoUIKit.getSignalingPlugin().acceptInvitation(inviter.id, JSON.stringify({\n                callID, \n                call_id: roomID,\n                // @ts-ignore\n                'invitee': {userID: ZegoPrebuiltPlugins.getLocalUser().userID, userName: ZegoPrebuiltPlugins.getLocalUser().userName}\n            }))\n            .then((result: ZegoPluginResult) => {\n                zloginfo(`[NotificationHelper][_onCallKitAnswerCall] acceptInvitation then, code: ${result.code}, message: ${result.message}`)\n\n                PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                    'call_id': callID,\n                    app_state,\n                    'action': 'accept'\n                })\n\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][_onCallKitAnswerCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n                if (AppState.currentState === 'background') {\n                    this._currentCallID = callID\n                    this._currentCallStatus = 'calling'\n                    zloginfo(`[NotificationHelper][_onCallKitAnswerCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n                }\n\n                action.fulfill();\n            })\n            .catch((error: ZIMError) => {\n                zloginfo(`[NotificationHelper][_onCallKitAnswerCall] acceptInvitation catch, error: ${error.code}, message: ${error.message}`)\n\n                this.hangUp(callID, 'acceptFailed')\n                CallInviteHelper.getInstance().refuseCall(callID);\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][_onCallKitAnswerCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n                // tell ios decline fail\n                action.fail();\n            })\n        })\n    }\n\n    hangUp(callID: string, reason: string) {\n        zloginfo(`[NotificationHelper][hangUp] callID: ${callID}, reason: ${reason}`)\n\n        if (reason === 'onCallKitEndCall' || reason === 'acceptFailed') {\n            ZegoUIKitPrebuiltCallService.getInstance().hangUp();\n        } else {\n            let notifyUuid = this._callIDUuidMap.get(callID);\n            if (notifyUuid) {\n                this._uikitSignalingPlugin.reportCallKitCallEnded(notifyUuid, 2)    // 2 - RemoteEnded\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][hangUp] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n            }\n        }\n    }\n\n    getCurrentInCallID() {\n        if (this._currentCallStatus === 'calling') {\n            return this._currentCallID;\n        } else {\n            return ''\n        }\n    }\n}"],"mappings":"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","ignoreList":[]}