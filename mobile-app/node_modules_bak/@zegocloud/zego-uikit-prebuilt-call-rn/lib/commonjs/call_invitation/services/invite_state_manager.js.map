{"version":3,"names":["_zegoUikitRn","_interopRequireDefault","require","_plugins","_logger","e","__esModule","default","InviteState","uncompleted","completed","pending","accepted","missed","rejected","CallInviteStateManage","_callbackID","_invitationMap","Map","_onInviteCompletedWithNobodyMap","_onSomeoneAcceptedInviteMap","_inOutgoingCall","_notifyInviteCompletedWithNobody","callID","stateDetails","get","zloginfo","completedWithNobody","inviteState","Array","from","invitees","values","find","forEach","callback","_judgeInviteCompleted","inviteDetails","init","registerCallback","uninit","unRegisterCallback","clear","String","Math","floor","random","ZegoUIKit","getSignalingPlugin","onInvitationResponseTimeout","data","invitee","set","id","onInvitationRefused","isInviteCompleted","onInvitationAccepted","onInvitationReceived","type","inviter","TAG","JSON","stringify","parse","addInviteData","map","user_id","onInvitationCanceled","delete","onInvitationTimeout","localUser","ZegoPrebuiltPlugins","getLocalUser","userID","initInviteData","setOutgoingCallStatus","isInviteCalling","invitationID","inviterID","temp","inviteeID","updateInviteDataAfterRejected","updateInviteDataAfterAccepted","updateInviteDataAfterCancel","isAutoCancelInvite","auto","filter","length","isOncall","newCallID","localUserID","isOn","size","callIDs","keys","index","len","currentCallID","onSomeoneAcceptedInvite","callbackID","has","onInviteCompletedWithNobody","_default","exports"],"sources":["invite_state_manager.js"],"sourcesContent":["import ZegoUIKit from '@zegocloud/zego-uikit-rn';\nimport ZegoPrebuiltPlugins from './plugins';\nimport { zloginfo } from '../../utils/logger';\n\n// completed: Someone ran out of time, accepted or declined an invitation\n// uncompleted: Others did not accept or reject the invitation, and the invitation did not time out\n\n// Consider having multiple call invitation processes at the same time\n\nconst InviteState = {\n  uncompleted: 1, // inviter: send an invitation、init state\n  completed: 2, // inviter: send an invitation\n  pending: 3, // invitee: call pending、init state\n  accepted: 4, // invitee: accept\n  missed: 5, // invitee: timout\n  rejected: 6, // invitee: rejection\n};\n\nconst CallInviteStateManage = {\n  _callbackID: '',\n  _invitationMap: new Map(), // callID -> state detail\n  _onInviteCompletedWithNobodyMap: new Map(),\n  _onSomeoneAcceptedInviteMap: new Map(),\n  \n  // Set to true when making an outgoing call, and reset to false after the call is answered or canceled\n  _inOutgoingCall: false,\n\n  _notifyInviteCompletedWithNobody: (callID) => {\n    const stateDetails = CallInviteStateManage._invitationMap.get(callID);\n    if (stateDetails) {\n      zloginfo(\n        '######_notifyInviteCompletedWithNobody######',\n        callID,\n        CallInviteStateManage._invitationMap\n      );\n      const completedWithNobody =\n        stateDetails.inviteState === InviteState.completed &&\n        !Array.from(stateDetails.invitees.values()).find(\n          (inviteState) => inviteState === InviteState.accepted\n        );\n      if (completedWithNobody) {\n        // notify\n        Array.from(\n          CallInviteStateManage._onInviteCompletedWithNobodyMap.values()\n        ).forEach((callback) => {\n          callback && callback(callID);\n        });\n      }\n    }\n  },\n  _judgeInviteCompleted: (callID) => {\n    const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n    return !Array.from(inviteDetails.invitees.values()).find(\n      (inviteState) => inviteState === InviteState.pending\n    );\n  },\n  init: () => {\n    CallInviteStateManage.registerCallback();\n  },\n  uninit: () => {\n    CallInviteStateManage.unRegisterCallback();\n    CallInviteStateManage._invitationMap.clear();\n    CallInviteStateManage._onInviteCompletedWithNobodyMap.clear();\n    CallInviteStateManage._onSomeoneAcceptedInviteMap.clear();\n    zloginfo('[CallInviteStateManage][uninit]')\n  },\n  registerCallback: () => {\n    zloginfo('[CallInviteStateManage]registerCallback success');\n    CallInviteStateManage._callbackID =\n      'CallInviteStateManage' + String(Math.floor(Math.random() * 10000));\n    ZegoUIKit.getSignalingPlugin().onInvitationResponseTimeout(\n      CallInviteStateManage._callbackID,\n      ({ callID, invitees, data }) => {\n        // update _invitationMap\n        const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n        if (inviteDetails) {\n          zloginfo(`[InviteStateManage][onInvitationResponseTimeout], callID: ${callID}, inviteDetails: ${inviteDetails}`)\n          invitees.forEach((invitee) => {\n            inviteDetails.invitees.set(invitee.id, InviteState.missed);\n          });\n          inviteDetails.inviteState =\n            CallInviteStateManage._judgeInviteCompleted(callID)\n              ? InviteState.completed\n              : InviteState.uncompleted;\n          zloginfo(`[InviteStateManage][onInvitationResponseTimeout], callID: ${callID}, set inviteState: ${inviteDetails.inviteState}`)\n          CallInviteStateManage._notifyInviteCompletedWithNobody(callID);\n        }\n      }\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationRefused(\n      CallInviteStateManage._callbackID,\n      ({ callID, invitee, data }) => {\n        // update _invitationMap\n        const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n        if (inviteDetails) {\n          inviteDetails.invitees.set(invitee.id, InviteState.rejected);\n          let isInviteCompleted = CallInviteStateManage._judgeInviteCompleted(callID)\n          zloginfo(`[InviteStateManage][onInvitationRefused] isInviteCompleted: ${isInviteCompleted}`)\n          inviteDetails.inviteState = isInviteCompleted ? InviteState.completed : InviteState.uncompleted;\n          CallInviteStateManage._notifyInviteCompletedWithNobody(callID);\n        }\n      }\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationAccepted(\n      CallInviteStateManage._callbackID,\n      ({ callID, invitee, data }) => {\n        // update _invitationMap\n        zloginfo(\n          '######onInvitationAccepted######',\n          CallInviteStateManage._invitationMap,\n          callID\n        );\n        const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n        if (inviteDetails) {\n          inviteDetails.invitees.set(invitee.id, InviteState.accepted);\n          inviteDetails.inviteState =\n            CallInviteStateManage._judgeInviteCompleted(callID)\n              ? InviteState.completed\n              : InviteState.uncompleted;\n          // notify\n          Array.from(\n            CallInviteStateManage._onSomeoneAcceptedInviteMap.values()\n          ).forEach((callback) => {\n            callback && callback(callID);\n          });\n        }\n      }\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationReceived(CallInviteStateManage._callbackID,\n      ({ callID, type, inviter, data }) => {\n        zloginfo(`onInvitationReceived implement by ${TAG}, callID: ${callID}, inviter: ${JSON.stringify(inviter)}, data: ${data}`);\n\n        data = JSON.parse(data);\n        // update _invitationMap\n        const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n        if (inviteDetails) {\n          // No such case\n        } else {\n          CallInviteStateManage.addInviteData(\n            callID,\n            inviter.id,\n            data.invitees.map((invitee) => invitee.user_id)\n          );\n        }\n      },\n      TAG\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationCanceled(\n      CallInviteStateManage._callbackID,\n      ({ callID, inviter, data }) => {\n        // update _invitationMap\n        CallInviteStateManage._invitationMap.delete(callID);\n      }\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationTimeout(\n      CallInviteStateManage._callbackID,\n      ({ callID, inviter, data }) => {\n        // update _invitationMap\n        const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n        if (inviteDetails) {\n          const localUser = ZegoPrebuiltPlugins.getLocalUser();\n          inviteDetails.invitees.set(localUser.userID, InviteState.missed);\n        } else {\n          // No such case\n        }\n      }\n    );\n  },\n  unRegisterCallback: () => {\n    ZegoUIKit.getSignalingPlugin().onInvitationResponseTimeout(\n      CallInviteStateManage._callbackID\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationRefused(\n      CallInviteStateManage._callbackID\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationAccepted(\n      CallInviteStateManage._callbackID\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationReceived(\n      CallInviteStateManage._callbackID\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationCanceled(\n      CallInviteStateManage._callbackID\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationTimeout(\n      CallInviteStateManage._callbackID\n    );\n  },\n  // This call is called after the call invitation has ended or before an invitation starts\n  initInviteData: () => {\n    zloginfo('[CallInviteStateManage][initInviteData]')\n    CallInviteStateManage._invitationMap.clear();\n  },\n  setOutgoingCallStatus: (isInviteCalling) => {\n    zloginfo('[CallInviteStateManage][setOutgoingCallStatus]', isInviteCalling)\n    CallInviteStateManage._inOutgoingCall = isInviteCalling\n  },\n  // This interface is called after the invitation is received and the invitation is successfully sent\n  addInviteData: (invitationID, inviterID, invitees) => {\n    const temp = new Map();\n    invitees.forEach((inviteeID) => {\n      temp.set(inviteeID, InviteState.pending);\n    });\n    CallInviteStateManage._invitationMap.set(invitationID, {\n      inviterID,\n      inviteState: InviteState.uncompleted,\n      invitees: temp,\n    });\n    zloginfo('[CallInviteStateManage][addInviteData]', JSON.stringify(...CallInviteStateManage._invitationMap));\n  },\n  // This interface is called after the invitation is successfully rejected\n  updateInviteDataAfterRejected: (callID) => {\n    // update _invitationMap\n    CallInviteStateManage._invitationMap.delete(callID);\n    zloginfo('[CallInviteStateManage][updateInviteDataAfterRejected]', JSON.stringify(...CallInviteStateManage._invitationMap));\n  },\n  // This interface is called after the invitation is successfully accepted\n  updateInviteDataAfterAccepted: (invitationID) => {\n    // update _invitationMap\n    const localUser = ZegoPrebuiltPlugins.getLocalUser();\n    const inviteDetails = CallInviteStateManage._invitationMap.get(invitationID);\n    if (inviteDetails) {\n      inviteDetails.invitees.set(localUser.userID, InviteState.accepted);\n    }\n    zloginfo('[CallInviteStateManage][updateInviteDataAfterAccepted]', JSON.stringify(...CallInviteStateManage._invitationMap));\n  },\n  // This interface is called after the invitation is successfully cancel\n  updateInviteDataAfterCancel: (invitationID) => {\n    // update _invitationMap\n    CallInviteStateManage._invitationMap.delete(invitationID);\n    zloginfo('[CallInviteStateManage][updateInviteDataAfterCancel]', JSON.stringify(...CallInviteStateManage._invitationMap));\n  },\n  isInviteCompleted: (invitationID) => {\n    const inviteDetails = CallInviteStateManage._invitationMap.get(invitationID);\n    if (inviteDetails) {\n      return inviteDetails.inviteState === InviteState.completed;\n    } else {\n      return false;\n    }\n  },\n  isAutoCancelInvite: (invitationID) => {\n    zloginfo(\n      '######isAutoCancelInvite######',\n      invitationID,\n      CallInviteStateManage._invitationMap\n    );\n    let auto = false;\n    if (!CallInviteStateManage.isInviteCompleted(invitationID)) {\n      const inviteDetails = CallInviteStateManage._invitationMap.get(invitationID);\n      if (inviteDetails) {\n        const temp = Array.from(inviteDetails.invitees.values());\n        if (\n          !temp.find(\n            (inviteState) =>\n              inviteState === InviteState.accepted ||\n              inviteState === InviteState.rejected\n          )\n        ) {\n          // Scene1: When no one clicks accept or reject\n          auto = true;\n        } else if (\n          !temp.find((inviteState) => inviteState === InviteState.accepted) &&\n          temp.filter((inviteState) => inviteState === InviteState.rejected)\n            .length < temp.length\n        ) {\n          // Scene2: No one accepts, only some people refuse\n          auto = true;\n        }\n      }\n    }\n    return auto;\n  },\n  // Determine whether a call is being made\n  isOncall: (newCallID) => {\n    let localUserID = ZegoPrebuiltPlugins.getLocalUser().userID\n    zloginfo('[InviteStateManage]######isOncall######', newCallID);\n\n    // determine for onInvitationReceived\n    if (newCallID && CallInviteStateManage._inOutgoingCall) {\n      isOn = true;\n      zloginfo(`[InviteStateManage][isOncall] isOn: ${isOn}, reason: _inOutgoingCall === true`)\n      return isOn\n    }\n\n    zloginfo(`[InviteStateManage][isOncall] _invitationMap.size: ${CallInviteStateManage._invitationMap.size}, _invitationMap: ${JSON.stringify(...CallInviteStateManage._invitationMap)}`)\n    let isOn = false;\n    const callIDs = Array.from(CallInviteStateManage._invitationMap.keys());\n    for (let index = 0, len = callIDs.length; index < len; index++) {\n      const currentCallID = callIDs[index];\n      if (currentCallID !== newCallID) {\n        const stateDetails = CallInviteStateManage._invitationMap.get(currentCallID);\n        if (!stateDetails) {\n          continue\n        }\n\n        if (stateDetails.inviterID === localUserID && stateDetails.inviteState == InviteState.uncompleted) {\n          isOn = true;\n          zloginfo(`[InviteStateManage][isOncall] isOn: ${isOn}, reason: stateDetails.inviterID === localUserID, stateDetails: ${currentCallID} ${JSON.stringify(stateDetails)}`)\n          break;\n        }\n\n        const inviteState = stateDetails.invitees.get(localUserID);\n        if (\n          inviteState === InviteState.pending ||\n          inviteState === InviteState.accepted\n        ) {\n          isOn = true;\n          zloginfo(`[InviteStateManage][isOncall] isOn: ${isOn}, reason: localUserID pending or accepted, stateDetails: ${currentCallID} ${JSON.stringify(stateDetails)}`)\n          break;\n        }\n      }\n    }\n    zloginfo(`[InviteStateManage][isOncall] isOn: ${isOn}`)\n    return isOn;\n  },\n\n  onSomeoneAcceptedInvite: (callbackID, callback) => {\n    if (typeof callback !== 'function') {\n      if (CallInviteStateManage._onSomeoneAcceptedInviteMap.has(callbackID)) {\n        CallInviteStateManage._onSomeoneAcceptedInviteMap.delete(callbackID);\n      }\n    } else {\n      CallInviteStateManage._onSomeoneAcceptedInviteMap.set(\n        callbackID,\n        callback\n      );\n    }\n  },\n  onInviteCompletedWithNobody: (callbackID, callback) => {\n    if (typeof callback !== 'function') {\n      if (CallInviteStateManage._onInviteCompletedWithNobodyMap.has(callbackID)) {\n        CallInviteStateManage._onInviteCompletedWithNobodyMap.delete(\n          callbackID\n        );\n      }\n    } else {\n      CallInviteStateManage._onInviteCompletedWithNobodyMap.set(\n        callbackID,\n        callback\n      );\n    }\n  },\n};\n\nexport default CallInviteStateManage;\nconst TAG = 'invite_state_manager';"],"mappings":";;;;;;AAAA,IAAAA,YAAA,GAAAC,sBAAA,CAAAC,OAAA;AACA,IAAAC,QAAA,GAAAF,sBAAA,CAAAC,OAAA;AACA,IAAAE,OAAA,GAAAF,OAAA;AAA8C,SAAAD,uBAAAI,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAE9C;AACA;;AAEA;;AAEA,MAAMG,WAAW,GAAG;EAClBC,WAAW,EAAE,CAAC;EAAE;EAChBC,SAAS,EAAE,CAAC;EAAE;EACdC,OAAO,EAAE,CAAC;EAAE;EACZC,QAAQ,EAAE,CAAC;EAAE;EACbC,MAAM,EAAE,CAAC;EAAE;EACXC,QAAQ,EAAE,CAAC,CAAE;AACf,CAAC;AAED,MAAMC,qBAAqB,GAAG;EAC5BC,WAAW,EAAE,EAAE;EACfC,cAAc,EAAE,IAAIC,GAAG,CAAC,CAAC;EAAE;EAC3BC,+BAA+B,EAAE,IAAID,GAAG,CAAC,CAAC;EAC1CE,2BAA2B,EAAE,IAAIF,GAAG,CAAC,CAAC;EAEtC;EACAG,eAAe,EAAE,KAAK;EAEtBC,gCAAgC,EAAGC,MAAM,IAAK;IAC5C,MAAMC,YAAY,GAAGT,qBAAqB,CAACE,cAAc,CAACQ,GAAG,CAACF,MAAM,CAAC;IACrE,IAAIC,YAAY,EAAE;MAChB,IAAAE,gBAAQ,EACN,8CAA8C,EAC9CH,MAAM,EACNR,qBAAqB,CAACE,cACxB,CAAC;MACD,MAAMU,mBAAmB,GACvBH,YAAY,CAACI,WAAW,KAAKpB,WAAW,CAACE,SAAS,IAClD,CAACmB,KAAK,CAACC,IAAI,CAACN,YAAY,CAACO,QAAQ,CAACC,MAAM,CAAC,CAAC,CAAC,CAACC,IAAI,CAC7CL,WAAW,IAAKA,WAAW,KAAKpB,WAAW,CAACI,QAC/C,CAAC;MACH,IAAIe,mBAAmB,EAAE;QACvB;QACAE,KAAK,CAACC,IAAI,CACRf,qBAAqB,CAACI,+BAA+B,CAACa,MAAM,CAAC,CAC/D,CAAC,CAACE,OAAO,CAAEC,QAAQ,IAAK;UACtBA,QAAQ,IAAIA,QAAQ,CAACZ,MAAM,CAAC;QAC9B,CAAC,CAAC;MACJ;IACF;EACF,CAAC;EACDa,qBAAqB,EAAGb,MAAM,IAAK;IACjC,MAAMc,aAAa,GAAGtB,qBAAqB,CAACE,cAAc,CAACQ,GAAG,CAACF,MAAM,CAAC;IACtE,OAAO,CAACM,KAAK,CAACC,IAAI,CAACO,aAAa,CAACN,QAAQ,CAACC,MAAM,CAAC,CAAC,CAAC,CAACC,IAAI,CACrDL,WAAW,IAAKA,WAAW,KAAKpB,WAAW,CAACG,OAC/C,CAAC;EACH,CAAC;EACD2B,IAAI,EAAEA,CAAA,KAAM;IACVvB,qBAAqB,CAACwB,gBAAgB,CAAC,CAAC;EAC1C,CAAC;EACDC,MAAM,EAAEA,CAAA,KAAM;IACZzB,qBAAqB,CAAC0B,kBAAkB,CAAC,CAAC;IAC1C1B,qBAAqB,CAACE,cAAc,CAACyB,KAAK,CAAC,CAAC;IAC5C3B,qBAAqB,CAACI,+BAA+B,CAACuB,KAAK,CAAC,CAAC;IAC7D3B,qBAAqB,CAACK,2BAA2B,CAACsB,KAAK,CAAC,CAAC;IACzD,IAAAhB,gBAAQ,EAAC,iCAAiC,CAAC;EAC7C,CAAC;EACDa,gBAAgB,EAAEA,CAAA,KAAM;IACtB,IAAAb,gBAAQ,EAAC,iDAAiD,CAAC;IAC3DX,qBAAqB,CAACC,WAAW,GAC/B,uBAAuB,GAAG2B,MAAM,CAACC,IAAI,CAACC,KAAK,CAACD,IAAI,CAACE,MAAM,CAAC,CAAC,GAAG,KAAK,CAAC,CAAC;IACrEC,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACC,2BAA2B,CACxDlC,qBAAqB,CAACC,WAAW,EACjC,CAAC;MAAEO,MAAM;MAAEQ,QAAQ;MAAEmB;IAAK,CAAC,KAAK;MAC9B;MACA,MAAMb,aAAa,GAAGtB,qBAAqB,CAACE,cAAc,CAACQ,GAAG,CAACF,MAAM,CAAC;MACtE,IAAIc,aAAa,EAAE;QACjB,IAAAX,gBAAQ,EAAC,6DAA6DH,MAAM,oBAAoBc,aAAa,EAAE,CAAC;QAChHN,QAAQ,CAACG,OAAO,CAAEiB,OAAO,IAAK;UAC5Bd,aAAa,CAACN,QAAQ,CAACqB,GAAG,CAACD,OAAO,CAACE,EAAE,EAAE7C,WAAW,CAACK,MAAM,CAAC;QAC5D,CAAC,CAAC;QACFwB,aAAa,CAACT,WAAW,GACvBb,qBAAqB,CAACqB,qBAAqB,CAACb,MAAM,CAAC,GAC/Cf,WAAW,CAACE,SAAS,GACrBF,WAAW,CAACC,WAAW;QAC7B,IAAAiB,gBAAQ,EAAC,6DAA6DH,MAAM,sBAAsBc,aAAa,CAACT,WAAW,EAAE,CAAC;QAC9Hb,qBAAqB,CAACO,gCAAgC,CAACC,MAAM,CAAC;MAChE;IACF,CACF,CAAC;IACDwB,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACM,mBAAmB,CAChDvC,qBAAqB,CAACC,WAAW,EACjC,CAAC;MAAEO,MAAM;MAAE4B,OAAO;MAAED;IAAK,CAAC,KAAK;MAC7B;MACA,MAAMb,aAAa,GAAGtB,qBAAqB,CAACE,cAAc,CAACQ,GAAG,CAACF,MAAM,CAAC;MACtE,IAAIc,aAAa,EAAE;QACjBA,aAAa,CAACN,QAAQ,CAACqB,GAAG,CAACD,OAAO,CAACE,EAAE,EAAE7C,WAAW,CAACM,QAAQ,CAAC;QAC5D,IAAIyC,iBAAiB,GAAGxC,qBAAqB,CAACqB,qBAAqB,CAACb,MAAM,CAAC;QAC3E,IAAAG,gBAAQ,EAAC,+DAA+D6B,iBAAiB,EAAE,CAAC;QAC5FlB,aAAa,CAACT,WAAW,GAAG2B,iBAAiB,GAAG/C,WAAW,CAACE,SAAS,GAAGF,WAAW,CAACC,WAAW;QAC/FM,qBAAqB,CAACO,gCAAgC,CAACC,MAAM,CAAC;MAChE;IACF,CACF,CAAC;IACDwB,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACQ,oBAAoB,CACjDzC,qBAAqB,CAACC,WAAW,EACjC,CAAC;MAAEO,MAAM;MAAE4B,OAAO;MAAED;IAAK,CAAC,KAAK;MAC7B;MACA,IAAAxB,gBAAQ,EACN,kCAAkC,EAClCX,qBAAqB,CAACE,cAAc,EACpCM,MACF,CAAC;MACD,MAAMc,aAAa,GAAGtB,qBAAqB,CAACE,cAAc,CAACQ,GAAG,CAACF,MAAM,CAAC;MACtE,IAAIc,aAAa,EAAE;QACjBA,aAAa,CAACN,QAAQ,CAACqB,GAAG,CAACD,OAAO,CAACE,EAAE,EAAE7C,WAAW,CAACI,QAAQ,CAAC;QAC5DyB,aAAa,CAACT,WAAW,GACvBb,qBAAqB,CAACqB,qBAAqB,CAACb,MAAM,CAAC,GAC/Cf,WAAW,CAACE,SAAS,GACrBF,WAAW,CAACC,WAAW;QAC7B;QACAoB,KAAK,CAACC,IAAI,CACRf,qBAAqB,CAACK,2BAA2B,CAACY,MAAM,CAAC,CAC3D,CAAC,CAACE,OAAO,CAAEC,QAAQ,IAAK;UACtBA,QAAQ,IAAIA,QAAQ,CAACZ,MAAM,CAAC;QAC9B,CAAC,CAAC;MACJ;IACF,CACF,CAAC;IACDwB,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACS,oBAAoB,CAAC1C,qBAAqB,CAACC,WAAW,EACnF,CAAC;MAAEO,MAAM;MAAEmC,IAAI;MAAEC,OAAO;MAAET;IAAK,CAAC,KAAK;MACnC,IAAAxB,gBAAQ,EAAC,qCAAqCkC,GAAG,aAAarC,MAAM,cAAcsC,IAAI,CAACC,SAAS,CAACH,OAAO,CAAC,WAAWT,IAAI,EAAE,CAAC;MAE3HA,IAAI,GAAGW,IAAI,CAACE,KAAK,CAACb,IAAI,CAAC;MACvB;MACA,MAAMb,aAAa,GAAGtB,qBAAqB,CAACE,cAAc,CAACQ,GAAG,CAACF,MAAM,CAAC;MACtE,IAAIc,aAAa,EAAE;QACjB;MAAA,CACD,MAAM;QACLtB,qBAAqB,CAACiD,aAAa,CACjCzC,MAAM,EACNoC,OAAO,CAACN,EAAE,EACVH,IAAI,CAACnB,QAAQ,CAACkC,GAAG,CAAEd,OAAO,IAAKA,OAAO,CAACe,OAAO,CAChD,CAAC;MACH;IACF,CAAC,EACDN,GACF,CAAC;IACDb,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACmB,oBAAoB,CACjDpD,qBAAqB,CAACC,WAAW,EACjC,CAAC;MAAEO,MAAM;MAAEoC,OAAO;MAAET;IAAK,CAAC,KAAK;MAC7B;MACAnC,qBAAqB,CAACE,cAAc,CAACmD,MAAM,CAAC7C,MAAM,CAAC;IACrD,CACF,CAAC;IACDwB,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACqB,mBAAmB,CAChDtD,qBAAqB,CAACC,WAAW,EACjC,CAAC;MAAEO,MAAM;MAAEoC,OAAO;MAAET;IAAK,CAAC,KAAK;MAC7B;MACA,MAAMb,aAAa,GAAGtB,qBAAqB,CAACE,cAAc,CAACQ,GAAG,CAACF,MAAM,CAAC;MACtE,IAAIc,aAAa,EAAE;QACjB,MAAMiC,SAAS,GAAGC,gBAAmB,CAACC,YAAY,CAAC,CAAC;QACpDnC,aAAa,CAACN,QAAQ,CAACqB,GAAG,CAACkB,SAAS,CAACG,MAAM,EAAEjE,WAAW,CAACK,MAAM,CAAC;MAClE,CAAC,MAAM;QACL;MAAA;IAEJ,CACF,CAAC;EACH,CAAC;EACD4B,kBAAkB,EAAEA,CAAA,KAAM;IACxBM,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACC,2BAA2B,CACxDlC,qBAAqB,CAACC,WACxB,CAAC;IACD+B,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACM,mBAAmB,CAChDvC,qBAAqB,CAACC,WACxB,CAAC;IACD+B,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACQ,oBAAoB,CACjDzC,qBAAqB,CAACC,WACxB,CAAC;IACD+B,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACS,oBAAoB,CACjD1C,qBAAqB,CAACC,WACxB,CAAC;IACD+B,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACmB,oBAAoB,CACjDpD,qBAAqB,CAACC,WACxB,CAAC;IACD+B,oBAAS,CAACC,kBAAkB,CAAC,CAAC,CAACqB,mBAAmB,CAChDtD,qBAAqB,CAACC,WACxB,CAAC;EACH,CAAC;EACD;EACA0D,cAAc,EAAEA,CAAA,KAAM;IACpB,IAAAhD,gBAAQ,EAAC,yCAAyC,CAAC;IACnDX,qBAAqB,CAACE,cAAc,CAACyB,KAAK,CAAC,CAAC;EAC9C,CAAC;EACDiC,qBAAqB,EAAGC,eAAe,IAAK;IAC1C,IAAAlD,gBAAQ,EAAC,gDAAgD,EAAEkD,eAAe,CAAC;IAC3E7D,qBAAqB,CAACM,eAAe,GAAGuD,eAAe;EACzD,CAAC;EACD;EACAZ,aAAa,EAAEA,CAACa,YAAY,EAAEC,SAAS,EAAE/C,QAAQ,KAAK;IACpD,MAAMgD,IAAI,GAAG,IAAI7D,GAAG,CAAC,CAAC;IACtBa,QAAQ,CAACG,OAAO,CAAE8C,SAAS,IAAK;MAC9BD,IAAI,CAAC3B,GAAG,CAAC4B,SAAS,EAAExE,WAAW,CAACG,OAAO,CAAC;IAC1C,CAAC,CAAC;IACFI,qBAAqB,CAACE,cAAc,CAACmC,GAAG,CAACyB,YAAY,EAAE;MACrDC,SAAS;MACTlD,WAAW,EAAEpB,WAAW,CAACC,WAAW;MACpCsB,QAAQ,EAAEgD;IACZ,CAAC,CAAC;IACF,IAAArD,gBAAQ,EAAC,wCAAwC,EAAEmC,IAAI,CAACC,SAAS,CAAC,GAAG/C,qBAAqB,CAACE,cAAc,CAAC,CAAC;EAC7G,CAAC;EACD;EACAgE,6BAA6B,EAAG1D,MAAM,IAAK;IACzC;IACAR,qBAAqB,CAACE,cAAc,CAACmD,MAAM,CAAC7C,MAAM,CAAC;IACnD,IAAAG,gBAAQ,EAAC,wDAAwD,EAAEmC,IAAI,CAACC,SAAS,CAAC,GAAG/C,qBAAqB,CAACE,cAAc,CAAC,CAAC;EAC7H,CAAC;EACD;EACAiE,6BAA6B,EAAGL,YAAY,IAAK;IAC/C;IACA,MAAMP,SAAS,GAAGC,gBAAmB,CAACC,YAAY,CAAC,CAAC;IACpD,MAAMnC,aAAa,GAAGtB,qBAAqB,CAACE,cAAc,CAACQ,GAAG,CAACoD,YAAY,CAAC;IAC5E,IAAIxC,aAAa,EAAE;MACjBA,aAAa,CAACN,QAAQ,CAACqB,GAAG,CAACkB,SAAS,CAACG,MAAM,EAAEjE,WAAW,CAACI,QAAQ,CAAC;IACpE;IACA,IAAAc,gBAAQ,EAAC,wDAAwD,EAAEmC,IAAI,CAACC,SAAS,CAAC,GAAG/C,qBAAqB,CAACE,cAAc,CAAC,CAAC;EAC7H,CAAC;EACD;EACAkE,2BAA2B,EAAGN,YAAY,IAAK;IAC7C;IACA9D,qBAAqB,CAACE,cAAc,CAACmD,MAAM,CAACS,YAAY,CAAC;IACzD,IAAAnD,gBAAQ,EAAC,sDAAsD,EAAEmC,IAAI,CAACC,SAAS,CAAC,GAAG/C,qBAAqB,CAACE,cAAc,CAAC,CAAC;EAC3H,CAAC;EACDsC,iBAAiB,EAAGsB,YAAY,IAAK;IACnC,MAAMxC,aAAa,GAAGtB,qBAAqB,CAACE,cAAc,CAACQ,GAAG,CAACoD,YAAY,CAAC;IAC5E,IAAIxC,aAAa,EAAE;MACjB,OAAOA,aAAa,CAACT,WAAW,KAAKpB,WAAW,CAACE,SAAS;IAC5D,CAAC,MAAM;MACL,OAAO,KAAK;IACd;EACF,CAAC;EACD0E,kBAAkB,EAAGP,YAAY,IAAK;IACpC,IAAAnD,gBAAQ,EACN,gCAAgC,EAChCmD,YAAY,EACZ9D,qBAAqB,CAACE,cACxB,CAAC;IACD,IAAIoE,IAAI,GAAG,KAAK;IAChB,IAAI,CAACtE,qBAAqB,CAACwC,iBAAiB,CAACsB,YAAY,CAAC,EAAE;MAC1D,MAAMxC,aAAa,GAAGtB,qBAAqB,CAACE,cAAc,CAACQ,GAAG,CAACoD,YAAY,CAAC;MAC5E,IAAIxC,aAAa,EAAE;QACjB,MAAM0C,IAAI,GAAGlD,KAAK,CAACC,IAAI,CAACO,aAAa,CAACN,QAAQ,CAACC,MAAM,CAAC,CAAC,CAAC;QACxD,IACE,CAAC+C,IAAI,CAAC9C,IAAI,CACPL,WAAW,IACVA,WAAW,KAAKpB,WAAW,CAACI,QAAQ,IACpCgB,WAAW,KAAKpB,WAAW,CAACM,QAChC,CAAC,EACD;UACA;UACAuE,IAAI,GAAG,IAAI;QACb,CAAC,MAAM,IACL,CAACN,IAAI,CAAC9C,IAAI,CAAEL,WAAW,IAAKA,WAAW,KAAKpB,WAAW,CAACI,QAAQ,CAAC,IACjEmE,IAAI,CAACO,MAAM,CAAE1D,WAAW,IAAKA,WAAW,KAAKpB,WAAW,CAACM,QAAQ,CAAC,CAC/DyE,MAAM,GAAGR,IAAI,CAACQ,MAAM,EACvB;UACA;UACAF,IAAI,GAAG,IAAI;QACb;MACF;IACF;IACA,OAAOA,IAAI;EACb,CAAC;EACD;EACAG,QAAQ,EAAGC,SAAS,IAAK;IACvB,IAAIC,WAAW,GAAGnB,gBAAmB,CAACC,YAAY,CAAC,CAAC,CAACC,MAAM;IAC3D,IAAA/C,gBAAQ,EAAC,yCAAyC,EAAE+D,SAAS,CAAC;;IAE9D;IACA,IAAIA,SAAS,IAAI1E,qBAAqB,CAACM,eAAe,EAAE;MACtDsE,IAAI,GAAG,IAAI;MACX,IAAAjE,gBAAQ,EAAC,uCAAuCiE,IAAI,oCAAoC,CAAC;MACzF,OAAOA,IAAI;IACb;IAEA,IAAAjE,gBAAQ,EAAC,sDAAsDX,qBAAqB,CAACE,cAAc,CAAC2E,IAAI,qBAAqB/B,IAAI,CAACC,SAAS,CAAC,GAAG/C,qBAAqB,CAACE,cAAc,CAAC,EAAE,CAAC;IACvL,IAAI0E,IAAI,GAAG,KAAK;IAChB,MAAME,OAAO,GAAGhE,KAAK,CAACC,IAAI,CAACf,qBAAqB,CAACE,cAAc,CAAC6E,IAAI,CAAC,CAAC,CAAC;IACvE,KAAK,IAAIC,KAAK,GAAG,CAAC,EAAEC,GAAG,GAAGH,OAAO,CAACN,MAAM,EAAEQ,KAAK,GAAGC,GAAG,EAAED,KAAK,EAAE,EAAE;MAC9D,MAAME,aAAa,GAAGJ,OAAO,CAACE,KAAK,CAAC;MACpC,IAAIE,aAAa,KAAKR,SAAS,EAAE;QAC/B,MAAMjE,YAAY,GAAGT,qBAAqB,CAACE,cAAc,CAACQ,GAAG,CAACwE,aAAa,CAAC;QAC5E,IAAI,CAACzE,YAAY,EAAE;UACjB;QACF;QAEA,IAAIA,YAAY,CAACsD,SAAS,KAAKY,WAAW,IAAIlE,YAAY,CAACI,WAAW,IAAIpB,WAAW,CAACC,WAAW,EAAE;UACjGkF,IAAI,GAAG,IAAI;UACX,IAAAjE,gBAAQ,EAAC,uCAAuCiE,IAAI,mEAAmEM,aAAa,IAAIpC,IAAI,CAACC,SAAS,CAACtC,YAAY,CAAC,EAAE,CAAC;UACvK;QACF;QAEA,MAAMI,WAAW,GAAGJ,YAAY,CAACO,QAAQ,CAACN,GAAG,CAACiE,WAAW,CAAC;QAC1D,IACE9D,WAAW,KAAKpB,WAAW,CAACG,OAAO,IACnCiB,WAAW,KAAKpB,WAAW,CAACI,QAAQ,EACpC;UACA+E,IAAI,GAAG,IAAI;UACX,IAAAjE,gBAAQ,EAAC,uCAAuCiE,IAAI,4DAA4DM,aAAa,IAAIpC,IAAI,CAACC,SAAS,CAACtC,YAAY,CAAC,EAAE,CAAC;UAChK;QACF;MACF;IACF;IACA,IAAAE,gBAAQ,EAAC,uCAAuCiE,IAAI,EAAE,CAAC;IACvD,OAAOA,IAAI;EACb,CAAC;EAEDO,uBAAuB,EAAEA,CAACC,UAAU,EAAEhE,QAAQ,KAAK;IACjD,IAAI,OAAOA,QAAQ,KAAK,UAAU,EAAE;MAClC,IAAIpB,qBAAqB,CAACK,2BAA2B,CAACgF,GAAG,CAACD,UAAU,CAAC,EAAE;QACrEpF,qBAAqB,CAACK,2BAA2B,CAACgD,MAAM,CAAC+B,UAAU,CAAC;MACtE;IACF,CAAC,MAAM;MACLpF,qBAAqB,CAACK,2BAA2B,CAACgC,GAAG,CACnD+C,UAAU,EACVhE,QACF,CAAC;IACH;EACF,CAAC;EACDkE,2BAA2B,EAAEA,CAACF,UAAU,EAAEhE,QAAQ,KAAK;IACrD,IAAI,OAAOA,QAAQ,KAAK,UAAU,EAAE;MAClC,IAAIpB,qBAAqB,CAACI,+BAA+B,CAACiF,GAAG,CAACD,UAAU,CAAC,EAAE;QACzEpF,qBAAqB,CAACI,+BAA+B,CAACiD,MAAM,CAC1D+B,UACF,CAAC;MACH;IACF,CAAC,MAAM;MACLpF,qBAAqB,CAACI,+BAA+B,CAACiC,GAAG,CACvD+C,UAAU,EACVhE,QACF,CAAC;IACH;EACF;AACF,CAAC;AAAC,IAAAmE,QAAA,GAAAC,OAAA,CAAAhG,OAAA,GAEaQ,qBAAqB;AACpC,MAAM6C,GAAG,GAAG,sBAAsB","ignoreList":[]}