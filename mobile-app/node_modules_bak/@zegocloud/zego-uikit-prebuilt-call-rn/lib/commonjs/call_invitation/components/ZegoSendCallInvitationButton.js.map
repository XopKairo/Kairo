{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_zegoUikitRn","_defines","_plugins","_interopRequireDefault","_native","_inner_text_helper","_invitation","_logger","_EventEmitter","_report","_invite_state_manager","e","__esModule","default","t","WeakMap","r","n","o","i","f","__proto__","has","get","set","hasOwnProperty","call","Object","defineProperty","getOwnPropertyDescriptor","ZegoSendCallInvitationButton","props","navigation","useNavigation","icon","text","invitees","isVideoCall","timeout","onWillPressed","onPressed","width","height","verticalLayout","textColor","fontSize","backgroundColor","borderRadius","borderWidth","borderColor","borderStyle","callID","callName","showWaitingPageWhenGroupCall","resourceID","_resourceID","customData","getInviteeIDList","map","invitee","userID","localUser","setLocalUser","useState","ZegoPrebuiltPlugins","getLocalUser","_roomID","isCanSendInvitation","canSendInvitation","isOnCall","CallInviteStateManage","isOncall","zlogwarning","zloginfo","onPress","errorCode","errorMessage","errorInvitees","invitationID","successfulInvitees","PrebuiltCallReport","reportEvent","ZegoUIKitPrebuiltCallInvitation","getInstance","onInvitationSent","onFailure","code","message","undefined","onRequestStatusChanged","isInviteCalling","setOutgoingCallStatus","loginHandler","userName","useEffect","unsubscribe1","addListener","unsubscribe2","unsubscribe3","eventEmitter","on","EventName","LOGINED","off","updateData","Date","now","_data","JSON","stringify","call_id","call_name","user_id","user_name","type","ZegoInvitationType","videoCall","voiceCall","inviter","id","name","custom_data","createElement","View","style","styles","container","ZegoSendInvitationButton","onRequestData","color","notificationTitle","InnerTextHelper","instance","getIncomingCallDialogTitle","length","notificationMessage","getIncomingCallDialogMessage","StyleSheet","create"],"sources":["ZegoSendCallInvitationButton.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { StyleSheet, View } from 'react-native';\nimport { ZegoSendInvitationButton } from '@zegocloud/zego-uikit-rn';\nimport { ZegoInvitationType } from '../services/defines';\nimport ZegoPrebuiltPlugins from '../services/plugins';\nimport { useNavigation } from '@react-navigation/native';\nimport InnerTextHelper from '../services/inner_text_helper';\nimport ZegoUIKitPrebuiltCallInvitation from '../../services/invitation';\nimport { zloginfo, zlogwarning } from '../../utils/logger';\nimport { eventEmitter, EventName } from '../../utils/EventEmitter';\nimport PrebuiltCallReport from '../../utils/report';\nimport CallInviteStateManage from '../services/invite_state_manager';\n\nexport default function ZegoSendCallInvitationButton(props) {\n  const navigation = useNavigation();\n  const {\n    icon,\n    text,\n    invitees = [],\n    isVideoCall = false,\n    timeout = 60,\n    onWillPressed,\n    onPressed,\n    width = 42,\n    height = 42,\n    verticalLayout = false,\n    textColor,\n    fontSize,\n    backgroundColor,\n    borderRadius,\n    borderWidth,\n    borderColor,\n    borderStyle,\n    callID,\n    callName,\n    showWaitingPageWhenGroupCall = false,\n    resourceID: _resourceID = '',\n    customData,\n  } = props;\n\n  const getInviteeIDList = () => {\n    return invitees.map((invitee) => {\n      return invitee.userID;\n    });\n  };\n\n  const [localUser, setLocalUser] = useState({\n    ...ZegoPrebuiltPlugins.getLocalUser(),\n  });\n\n  let _roomID = ''\n\n  const isCanSendInvitation = () => {\n    let canSendInvitation = false\n\n    let isOnCall = CallInviteStateManage.isOncall()\n    if (isOnCall) {\n      canSendInvitation = false\n    } else if (callID && typeof callID !== 'string') {\n      zlogwarning('[ZegoSendCallInvitationButton][isCanSendInvitation] callID should be string')\n      canSendInvitation = false\n    } else if (!onWillPressed) {\n      canSendInvitation = true\n    } else if (typeof onWillPressed === 'function') {\n      canSendInvitation = onWillPressed();\n    } else {\n      // don't support promise\n      canSendInvitation = false\n    }\n\n    zloginfo('isCanSendInvitation', canSendInvitation)\n    return canSendInvitation\n  }\n\n  const onPress = ({\n    errorCode,\n    errorMessage,\n    errorInvitees,\n    invitationID,\n    invitees: successfulInvitees,\n  }) => {\n    PrebuiltCallReport.reportEvent('call/invite', {\n      'call_id': invitationID,\n      'room_id': callID,\n      'source': 'button'\n    })\n\n    ZegoUIKitPrebuiltCallInvitation.getInstance().onInvitationSent(\n      navigation,\n      invitationID,\n      invitees,\n      successfulInvitees,\n      _roomID,\n      isVideoCall,\n      callName,\n      showWaitingPageWhenGroupCall\n    );\n\n    if (typeof onPressed === 'function') {\n      onPressed(errorCode, errorMessage, errorInvitees);\n    }\n  };\n\n  const onFailure = ({ code: errorCode, message: errorMessage }) => {\n    if (typeof onPressed === 'function') {\n      onPressed(errorCode, errorMessage, undefined);\n    }\n  };\n\n  const onRequestStatusChanged = (isInviteCalling) => {\n    CallInviteStateManage.setOutgoingCallStatus(isInviteCalling)\n  }\n\n  const loginHandler = ({ userID, userName }) => {\n    if (localUser.userID === userID) {\n      zloginfo(`[ZegoSendCallInvitationButton][loginHandler] userID not changed, userID: ${userID}`)\n      return;\n    }\n\n    zloginfo(`[ZegoSendCallInvitationButton][loginHandler] userID: ${userID}, userName: ${userName}`)\n    setLocalUser({ userID, userName });\n  };\n\n  useEffect(() => {\n    zloginfo(`[ZegoSendCallInvitationButton] useEffect, callName: ${callName}`)\n\n    const unsubscribe1 = navigation.addListener('blur', () => {\n      zloginfo(\n        `[Navigation] ZegoSendCallInvitationButton blur, isVideoCall: ${isVideoCall}`\n      );\n    });\n    const unsubscribe2 = navigation.addListener('focus', () => {\n      zloginfo(\n        `[Navigation] ZegoSendCallInvitationButton focus, isVideoCall: ${isVideoCall}`\n      );\n    });\n    const unsubscribe3 = navigation.addListener('beforeRemove', () => {\n      zloginfo(\n        `[Navigation] ZegoSendCallInvitationButton beforeRemove, isVideoCall: ${isVideoCall}`\n      );\n    });\n    eventEmitter.on(EventName.LOGINED, loginHandler);\n\n    return () => {\n      zloginfo(`[ZegoSendCallInvitationButton] useEffect return`)\n\n      unsubscribe1();\n      unsubscribe2();\n      unsubscribe3();\n      eventEmitter.off(EventName.LOGINED, loginHandler);\n    };\n  }, []);\n\n  const updateData = () => {\n    _roomID = callID ?? `call_${localUser.userID}_${Date.now()}`;\n    zloginfo(`ZegoSendCallInvitationButton _roomID: ${_roomID}`);\n\n    const _data = JSON.stringify({\n      call_id: _roomID,\n      call_name: callName,\n      invitees: invitees.map((invitee) => {\n        return { user_id: invitee.userID, user_name: invitee.userName };\n      }),\n      type: isVideoCall\n        ? ZegoInvitationType.videoCall\n        : ZegoInvitationType.voiceCall,\n      inviter: { id: localUser.userID, name: localUser.userName },\n      timeout: timeout,\n      custom_data: customData,\n    });\n\n    return _data\n  }\n\n  return (\n    <View style={styles.container}>\n      <ZegoSendInvitationButton\n        icon={icon}\n        text={text}\n        invitees={getInviteeIDList()}\n        type={\n          isVideoCall\n            ? ZegoInvitationType.videoCall\n            : ZegoInvitationType.voiceCall\n        }\n        onRequestData={() => {return updateData()}}\n        timeout={timeout}\n        onWillPressed={() => {return isCanSendInvitation()}}\n        onPressed={onPress}\n        onFailure={onFailure}\n        onRequestStatusChanged={onRequestStatusChanged}\n        resourceID={_resourceID}\n        width={width}\n        height={height}\n        color={textColor}\n        fontSize={fontSize}\n        backgroundColor={backgroundColor}\n        verticalLayout={verticalLayout}\n        borderRadius={borderRadius}\n        borderWidth={borderWidth}\n        borderColor={borderColor}\n        borderStyle={borderStyle}\n        notificationTitle={\n          callName ? callName :\n            InnerTextHelper.instance().getIncomingCallDialogTitle(\n              localUser.userName,\n              isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall,\n              invitees.length)\n        }\n        notificationMessage={\n          InnerTextHelper.instance().getIncomingCallDialogMessage(\n            isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall,\n            invitees.length\n          )}\n      />\n    </View>\n  );\n}\nconst styles = StyleSheet.create({\n  container: {},\n});\n"],"mappings":"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","ignoreList":[]}