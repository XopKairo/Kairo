{"version":3,"names":["_defines","require","_plugins","_interopRequireDefault","_zegoUikitRn","_invite_state_manager","_inner_text_helper","_logger","_offline_call_event_listener","_report","e","__esModule","default","_defineProperty","r","t","_toPropertyKey","Object","defineProperty","value","enumerable","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","ZegoUIKitPrebuiltCallInvitation","constructor","getInstance","_instance","sendCallInvitation","invitees","isVideoCall","navigation","options","resourceID","timeout","notificationTitle","notificationMessage","callID","customData","callName","showWaitingPageWhenGroupCall","localUser","ZegoPrebuiltPlugins","getLocalUser","roomID","length","userID","Date","now","nonNullNotificationTitle","InnerTextHelper","instance","getIncomingCallDialogTitle","userName","ZegoInvitationType","videoCall","voiceCall","nonNullNotificationMessage","getIncomingCallDialogMessage","data","JSON","stringify","call_id","call_name","map","invitee","user_id","user_name","type","inviter","id","name","custom_data","inviteeIDs","notificationConfig","title","message","Promise","resolve","reject","ZegoUIKit","getSignalingPlugin","sendInvitation","then","code","errorInvitees","PrebuiltCallReport","reportEvent","zloginfo","successfulInvitees","parse","forEach","errorInviteeID","index","findIndex","inviteeID","splice","onInvitationSent","catch","allInvitees","CallInviteStateManage","addInviteData","navigate","inviterID","invitationID","exports"],"sources":["invitation.js"],"sourcesContent":["import { ZegoInvitationType } from \"../call_invitation/services/defines\";\nimport ZegoPrebuiltPlugins from \"../call_invitation/services/plugins\";\nimport ZegoUIKit from '@zegocloud/zego-uikit-rn';\nimport CallInviteStateManage from \"../call_invitation/services/invite_state_manager\";\nimport InnerTextHelper from \"../call_invitation/services/inner_text_helper\";\nimport { zloginfo } from \"../utils/logger\";\nimport OfflineCallEventListener from \"../call_invitation/services/offline_call_event_listener\";\nimport PrebuiltCallReport from \"../utils/report\";\n\n\nexport default class ZegoUIKitPrebuiltCallInvitation {\n  static _instance;\n  constructor() { }\n  static getInstance() {\n    return this._instance || (this._instance = new ZegoUIKitPrebuiltCallInvitation());\n  }\n\n  sendCallInvitation(invitees, isVideoCall, navigation, options) {\n    const {\n      resourceID = '',\n      timeout = 60,\n      notificationTitle, \n      notificationMessage, \n      callID, \n      customData = '',\n      callName,\n      showWaitingPageWhenGroupCall = false,\n    } = options;\n\n    const localUser = ZegoPrebuiltPlugins.getLocalUser();\n    const roomID = (callID && callID.length > 0) ? callID : `call_${localUser.userID}_${Date.now()}`;\n\n    const nonNullNotificationTitle = notificationTitle ?? InnerTextHelper.instance().getIncomingCallDialogTitle(\n      localUser.userName,\n      isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall,\n      invitees.length);\n    const nonNullNotificationMessage = notificationMessage ?? InnerTextHelper.instance().getIncomingCallDialogMessage(\n      isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall,\n      invitees.length);\n\n    const data = JSON.stringify({\n      call_id: roomID,\n      call_name: callName,\n      invitees: invitees.map(invitee => {\n        return {user_id: invitee.userID, user_name: invitee.userName}\n      }),\n      type: isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall,\n      inviter: {id: localUser.userID, name: localUser.userName},\n      timeout: timeout,\n      custom_data: customData,\n      notificationTitle: nonNullNotificationTitle,\n      notificationMessage: nonNullNotificationMessage,\n    });\n    const inviteeIDs = invitees.map(invitee => {\n      return invitee.userID\n    });\n    const type = isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall\n\n    // set notification config.\n    const notificationConfig = {\n      resourceID, \n      title: nonNullNotificationTitle, \n      message: nonNullNotificationMessage\n    }\n\n    return new Promise((resolve, reject) => {\n      ZegoUIKit.getSignalingPlugin().sendInvitation(inviteeIDs, timeout, type, data, notificationConfig)\n      .then(({ code, message, callID, errorInvitees }) => {\n        PrebuiltCallReport.reportEvent('call/invite', {\n          'call_id': callID,\n          'room_id': callID,\n          'source': 'sendCallInvitation'\n        })\n\n        zloginfo(\n          `[CallInvitation]Send invitation success, code: ${code}, message: ${message}, errorInvitees: ${errorInvitees}`\n          );\n        if (inviteeIDs.length > errorInvitees.length) {\n          const successfulInvitees = JSON.parse(JSON.stringify(inviteeIDs));\n          errorInvitees.forEach((errorInviteeID) => {\n            const index = successfulInvitees.findIndex(\n              (inviteeID) => errorInviteeID === inviteeID\n            );\n            index !== -1 && successfulInvitees.splice(index, 1);\n          });\n          this.onInvitationSent(navigation, callID, invitees, successfulInvitees, roomID, isVideoCall, callName, showWaitingPageWhenGroupCall);\n          resolve();\n        } else {\n          reject(-1, 'All invitees failed.');\n        }\n      })\n      .catch(({ code, message }) => {\n        reject(code, message);\n      });\n    });\n  }\n\n  onInvitationSent(navigation, callID, allInvitees, successfulInvitees, roomID, isVideoCall, callName, showWaitingPageWhenGroupCall) {\n    zloginfo(`[onInvitationSent] callID: ${callID}, roomID: ${roomID}`);\n\n    const localUser = ZegoPrebuiltPlugins.getLocalUser();\n    CallInviteStateManage.addInviteData(\n      callID,\n      localUser.userID,\n      successfulInvitees\n    );\n\n    if (allInvitees.length === 1 || showWaitingPageWhenGroupCall) {\n      // Jump to call waiting page\n      zloginfo('Jump to call waiting page.');\n      navigation.navigate('ZegoUIKitPrebuiltCallWaitingScreen', {\n        roomID,\n        isVideoCall,\n        invitees: allInvitees,\n        inviterID: localUser.userID,\n        invitationID: callID,\n        callName,\n      });\n    } else {\n      // Jump to call room page\n      zloginfo('Jump to call room page.');\n      const inviteeIDs = allInvitees.map(invitee => {\n        return invitee.userID\n      });\n\n      zloginfo('Navigate to ZegoUIKitPrebuiltCallInCallScreen')\n      navigation.navigate('ZegoUIKitPrebuiltCallInCallScreen', {\n        roomID,\n        isVideoCall,\n        invitees: inviteeIDs,\n        inviter: localUser.userID,\n        invitationID: callID,\n      });\n    }\n  }\n}"],"mappings":"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","ignoreList":[]}