{"version":3,"names":["_reactNative","require","_logger","_defineProperty","e","r","t","_toPropertyKey","Object","defineProperty","value","enumerable","configurable","writable","i","_toPrimitive","Symbol","toPrimitive","call","TypeError","String","Number","TimingHelper","constructor","_duration","_durationStart","Date","now","_onDurationUpdateCallbackMap","_timer","getInstance","_instance","startTimer","zloginfo","setInterval","_increaseDuration","stopTimer","clearInterval","resetDuration","Platform","OS","realDuration","Math","floor","duration","notifyDurationUpdate","getDuration","onDurationUpdate","callbackID","callback","keys","forEach","exports","default"],"sources":["timing_helper.js"],"sourcesContent":["import { Platform } from 'react-native';\nimport { zloginfo } from '../utils/logger';\n\nexport default class TimingHelper {\n    static _instance;\n    \n    constructor() { \n        this._duration = 0;\n        this._durationStart = Date.now();\n        this._onDurationUpdateCallbackMap = {};\n        this._timer = null;\n    }\n    \n    static getInstance() {\n        if (TimingHelper._instance) {\n            return TimingHelper._instance;\n        }\n        TimingHelper._instance = new TimingHelper();\n        return TimingHelper._instance;\n    }\n\n    startTimer() {\n        zloginfo('[TimingHelper][startTimer]')\n        if (!this._timer) {\n            this._durationStart = Date.now();\n            this._duration = 0;\n            this._timer = setInterval(() => {\n                this._increaseDuration();\n            }, 1000);\n        }\n    }\n\n    stopTimer() {\n        zloginfo('[TimingHelper][stopTimer]')\n        if (this._timer) {\n            clearInterval(this._timer);\n            this._timer = null;\n            this._durationStart = Date.now();\n            this._duration = 0;\n        }\n    }\n\n    resetDuration() {\n        zloginfo('[TimingHelper][resetDuration]')\n        this.stopTimer()\n\n        this._duration = 0;\n        this._durationStart = Date.now();\n    }\n\n    _increaseDuration() {\n        if (Platform.OS === 'android') {\n            // The timing depends on the hardware, and on machines with poor performance, the timing may be slower than the actual\n            const realDuration = Math.floor((Date.now() - this._durationStart) / 1000)\n            const duration = this._duration + 1\n            if (realDuration >= duration + 1) {\n                this._duration = realDuration;\n            } else {\n                this._duration = duration;\n            }\n        } else {\n            this._duration = Math.floor((Date.now() - this._durationStart) / 1000)\n        }\n\n        this.notifyDurationUpdate(this._duration)\n    }\n\n    getDuration() {\n        const realDuration = Math.floor((Date.now() - this._durationStart) / 1000)\n        if (realDuration - this._duration > 2) {\n            return realDuration;\n        }\n        return this._duration;\n    }\n\n    onDurationUpdate(callbackID, callback) {\n        if (typeof callback !== 'function') {\n            delete this._onDurationUpdateCallbackMap[callbackID];\n        } else {\n            this._onDurationUpdateCallbackMap[callbackID] = callback;\n        }\n    }\n\n    async notifyDurationUpdate(duration) {\n        Object.keys(this._onDurationUpdateCallbackMap).forEach((callbackID) => {\n            if (this._onDurationUpdateCallbackMap[callbackID]) {\n                this._onDurationUpdateCallbackMap[callbackID](duration);\n            }\n        });\n    }\n}"],"mappings":"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","ignoreList":[]}