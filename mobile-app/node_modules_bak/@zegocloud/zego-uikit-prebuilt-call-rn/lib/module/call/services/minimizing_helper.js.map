{"version":3,"names":["ZegoUIKit","zloginfo","MinimizingHelper","constructor","_defineProperty","getInstance","_instance","getIsMinimize","_isMinimize","setIsMinimizeSwitch","isMinimizeSwitch","from","_isMinimizeSwitch","getIsMinimizeSwitch","setInitParams","appID","appSign","userID","userName","roomID","config","_appInfo","_localUser","_roomID","Object","assign","_config","getInitAppInfo","getInitUser","getInitRoomID","getInitConfig","getInitPlugins","_plugins","minimizeWindow","callbackID","String","Math","floor","random","unRegisterAudioVideoListCallback","registerAudioVideoListCallback","notifyMinimize","startUpdateTimer","updateActiveUserIDByTimer","initUpdateTimer","clearInterval","_updateTimer","allUsers","getAllUsers","filter","user","isCameraOn","isMicrophoneOn","activeUserID","length","_activeUserID","notifyActiveUserIDUpdate","onUserLeave","userInfoList","temp","notifyPrebuiltInit","keys","_onPrebuiltInitCallbackMap","forEach","_onActiveUserIDUpdateCallbackMap","_onWindowMinimizeCallbackMap","notifyMaximize","_onWindowMaximizeCallbackMap","notifyEntryNormal","_onEntryNormalCallbackMap","onPrebuiltInit","callback","onActiveUserIDUpdate","onWindowMinimized","onWindowMaximized","onEntryNormal","_MinimizingHelper"],"sources":["minimizing_helper.ts"],"sourcesContent":["import ZegoUIKit from '@zegocloud/zego-uikit-rn';\nimport { zloginfo } from '../../utils/logger';\n\nexport default class MinimizingHelper {\n    static _instance: MinimizingHelper;\n    _isMinimize = false;\n    _isMinimizeSwitch = false;\n    _activeUserID = '';\n    _onActiveUserIDUpdateCallbackMap: { [index: string]: (data?: any) => void } = {};\n    _onWindowMinimizeCallbackMap: { [index: string]: (data?: any) => void } = {};\n    _onWindowMaximizeCallbackMap: { [index: string]: (data?: any) => void } = {};\n    _onEntryNormalCallbackMap: { [index: string]: (data?: any) => void } = {};\n    _updateTimer: null | NodeJS.Timeout = null;\n    _appInfo: {\n        appID?: number;\n        appSign?: String;\n    } = {};\n    _localUser: {\n        userID?: string;\n        userName?: string;\n    } = {};\n    _roomID = '';\n    _config: any = {};\n    _plugins: any[] = [];\n    _onPrebuiltInitCallbackMap: { [index: string]: (data?: any) => void } = {};\n    constructor() { }\n    static getInstance() {\n        return this._instance || (this._instance = new MinimizingHelper());\n    }\n    getIsMinimize() {\n        return this._isMinimize;\n    }\n    setIsMinimizeSwitch(isMinimizeSwitch: boolean, from: string) {\n        this._isMinimizeSwitch = !!isMinimizeSwitch;\n        zloginfo(`[MinimizingHelper] setIsMinimizeSwitch: ${this._isMinimizeSwitch}, from: ${from}`);\n    }\n    getIsMinimizeSwitch() {\n        return this._isMinimizeSwitch;\n    }\n    setInitParams(appID: number, appSign: string, userID: string, userName: string, roomID: string, config = {}) {\n        this._appInfo = { appID, appSign };\n        this._localUser = { userID, userName };\n        this._roomID = roomID;\n        Object.assign(this._config, config);\n    }\n    getInitAppInfo() {\n        return this._appInfo;\n    }\n    getInitUser() {\n        return this._localUser;\n    }\n    getInitRoomID() {\n        return this._roomID;\n    }\n    getInitConfig() {\n        return this._config;\n    }\n    getInitPlugins() {\n        return this._plugins;\n    }\n    minimizeWindow() {\n        zloginfo('[MinimizingHelper][minimizeWindow]');\n        \n        const callbackID = 'MinimizingHelper' + String(Math.floor(Math.random() * 10000));\n        this.unRegisterAudioVideoListCallback(callbackID);\n        this.registerAudioVideoListCallback(callbackID);\n\n        this.notifyMinimize();\n        this.startUpdateTimer();\n    }\n    startUpdateTimer() {\n        this.updateActiveUserIDByTimer();\n\n        this.initUpdateTimer();\n    }\n    initUpdateTimer() {\n        clearInterval(this._updateTimer);\n        this._updateTimer = null;\n    }\n    updateActiveUserIDByTimer() {\n        const allUsers = ZegoUIKit.getAllUsers().filter((user: { userID: string; isCameraOn: any; isMicrophoneOn: any; }) => user.userID && user.userID !== this._localUser.userID && (user.isCameraOn || user.isMicrophoneOn));\n        const activeUserID = allUsers.length ? allUsers[0].userID : this._localUser.userID;\n\n        this._activeUserID = activeUserID || '';\n        \n        // console.log('[MinimizingHelper]updateActiveUserIDByTimer', this._activeUserID);\n        this.notifyActiveUserIDUpdate(this._activeUserID);\n    }\n    registerAudioVideoListCallback(callbackID: string) {\n        ZegoUIKit.onUserLeave(callbackID, (userInfoList: any[]) => {\n            const temp = userInfoList.filter(user => user.userID === this._activeUserID);\n            if (temp.length) {\n                this.updateActiveUserIDByTimer(); \n            }\n        });\n    }\n    unRegisterAudioVideoListCallback(callbackID: string) {\n        ZegoUIKit.onUserLeave(callbackID);\n    }\n    notifyPrebuiltInit() {\n        Object.keys(this._onPrebuiltInitCallbackMap).forEach((callbackID) => {\n            if (this._onPrebuiltInitCallbackMap[callbackID]) {\n                this._onPrebuiltInitCallbackMap[callbackID]();\n            }\n        });\n    }\n    notifyActiveUserIDUpdate(activeUserID: string) {\n        Object.keys(this._onActiveUserIDUpdateCallbackMap).forEach((callbackID) => {\n            if (this._onActiveUserIDUpdateCallbackMap[callbackID]) {\n                this._onActiveUserIDUpdateCallbackMap[callbackID](activeUserID);\n            }\n        })\n    }\n    notifyMinimize() {\n        zloginfo('[MinimizingHelper][notifyMinimize]')\n        this._isMinimize = true;\n\n        Object.keys(this._onWindowMinimizeCallbackMap).forEach((callbackID) => {\n            if (this._onWindowMinimizeCallbackMap[callbackID]) {\n                this._onWindowMinimizeCallbackMap[callbackID]();\n            }\n        })\n    }\n    notifyMaximize() {\n        zloginfo('[MinimizingHelper][notifyMaximize]')\n        this._isMinimize = false;\n\n        Object.keys(this._onWindowMaximizeCallbackMap).forEach((callbackID) => {\n            if (this._onWindowMaximizeCallbackMap[callbackID]) {\n                this._onWindowMaximizeCallbackMap[callbackID]();\n            }\n        })\n    }\n    notifyEntryNormal() {\n        zloginfo('[MinimizingHelper][notifyEntryNormal]')\n        this._isMinimize = false;\n\n        Object.keys(this._onEntryNormalCallbackMap).forEach((callbackID) => {\n            if (this._onEntryNormalCallbackMap[callbackID]) {\n                this._onEntryNormalCallbackMap[callbackID]();\n            }\n        })\n    }\n    onPrebuiltInit(callbackID: string, callback?: (data: any) => void) {\n        if (typeof callback !== 'function') {\n            delete this._onPrebuiltInitCallbackMap[callbackID];\n        } else {\n            this._onPrebuiltInitCallbackMap[callbackID] = callback;\n        }\n    }\n    onActiveUserIDUpdate(callbackID: string, callback?: (data: any) => void) {\n        if (typeof callback !== 'function') {\n            delete this._onActiveUserIDUpdateCallbackMap[callbackID];\n        } else {\n            this._onActiveUserIDUpdateCallbackMap[callbackID] = callback;\n        }\n    }\n    onWindowMinimized(callbackID: string, callback?: (data: any) => void) {\n        if (typeof callback !== 'function') {\n            delete this._onWindowMinimizeCallbackMap[callbackID];\n        } else {\n            this._onWindowMinimizeCallbackMap[callbackID] = callback;\n        }\n    }\n    onWindowMaximized(callbackID: string, callback?: (data: any) => void) {\n        if (typeof callback !== 'function') {\n            delete this._onWindowMaximizeCallbackMap[callbackID];\n        } else {\n            this._onWindowMaximizeCallbackMap[callbackID] = callback;\n        }\n    }\n    onEntryNormal(callbackID: string, callback?: (data: any) => void) {\n        if (typeof callback !== 'function') {\n            delete this._onEntryNormalCallbackMap[callbackID];\n        } else {\n            this._onEntryNormalCallbackMap[callbackID] = callback;\n        }\n    }\n}"],"mappings":"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","ignoreList":[]}