{"version":3,"names":["React","useEffect","useState","StyleSheet","View","ZegoSendInvitationButton","ZegoInvitationType","ZegoPrebuiltPlugins","useNavigation","InnerTextHelper","ZegoUIKitPrebuiltCallInvitation","zloginfo","zlogwarning","eventEmitter","EventName","PrebuiltCallReport","CallInviteStateManage","ZegoSendCallInvitationButton","props","navigation","icon","text","invitees","isVideoCall","timeout","onWillPressed","onPressed","width","height","verticalLayout","textColor","fontSize","backgroundColor","borderRadius","borderWidth","borderColor","borderStyle","callID","callName","showWaitingPageWhenGroupCall","resourceID","_resourceID","customData","getInviteeIDList","map","invitee","userID","localUser","setLocalUser","getLocalUser","_roomID","isCanSendInvitation","canSendInvitation","isOnCall","isOncall","onPress","errorCode","errorMessage","errorInvitees","invitationID","successfulInvitees","reportEvent","getInstance","onInvitationSent","onFailure","code","message","undefined","onRequestStatusChanged","isInviteCalling","setOutgoingCallStatus","loginHandler","userName","unsubscribe1","addListener","unsubscribe2","unsubscribe3","on","LOGINED","off","updateData","Date","now","_data","JSON","stringify","call_id","call_name","user_id","user_name","type","videoCall","voiceCall","inviter","id","name","custom_data","createElement","style","styles","container","onRequestData","color","notificationTitle","instance","getIncomingCallDialogTitle","length","notificationMessage","getIncomingCallDialogMessage","create"],"sources":["ZegoSendCallInvitationButton.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { StyleSheet, View } from 'react-native';\nimport { ZegoSendInvitationButton } from '@zegocloud/zego-uikit-rn';\nimport { ZegoInvitationType } from '../services/defines';\nimport ZegoPrebuiltPlugins from '../services/plugins';\nimport { useNavigation } from '@react-navigation/native';\nimport InnerTextHelper from '../services/inner_text_helper';\nimport ZegoUIKitPrebuiltCallInvitation from '../../services/invitation';\nimport { zloginfo, zlogwarning } from '../../utils/logger';\nimport { eventEmitter, EventName } from '../../utils/EventEmitter';\nimport PrebuiltCallReport from '../../utils/report';\nimport CallInviteStateManage from '../services/invite_state_manager';\n\nexport default function ZegoSendCallInvitationButton(props) {\n  const navigation = useNavigation();\n  const {\n    icon,\n    text,\n    invitees = [],\n    isVideoCall = false,\n    timeout = 60,\n    onWillPressed,\n    onPressed,\n    width = 42,\n    height = 42,\n    verticalLayout = false,\n    textColor,\n    fontSize,\n    backgroundColor,\n    borderRadius,\n    borderWidth,\n    borderColor,\n    borderStyle,\n    callID,\n    callName,\n    showWaitingPageWhenGroupCall = false,\n    resourceID: _resourceID = '',\n    customData,\n  } = props;\n\n  const getInviteeIDList = () => {\n    return invitees.map((invitee) => {\n      return invitee.userID;\n    });\n  };\n\n  const [localUser, setLocalUser] = useState({\n    ...ZegoPrebuiltPlugins.getLocalUser(),\n  });\n\n  let _roomID = ''\n\n  const isCanSendInvitation = () => {\n    let canSendInvitation = false\n\n    let isOnCall = CallInviteStateManage.isOncall()\n    if (isOnCall) {\n      canSendInvitation = false\n    } else if (callID && typeof callID !== 'string') {\n      zlogwarning('[ZegoSendCallInvitationButton][isCanSendInvitation] callID should be string')\n      canSendInvitation = false\n    } else if (!onWillPressed) {\n      canSendInvitation = true\n    } else if (typeof onWillPressed === 'function') {\n      canSendInvitation = onWillPressed();\n    } else {\n      // don't support promise\n      canSendInvitation = false\n    }\n\n    zloginfo('isCanSendInvitation', canSendInvitation)\n    return canSendInvitation\n  }\n\n  const onPress = ({\n    errorCode,\n    errorMessage,\n    errorInvitees,\n    invitationID,\n    invitees: successfulInvitees,\n  }) => {\n    PrebuiltCallReport.reportEvent('call/invite', {\n      'call_id': invitationID,\n      'room_id': callID,\n      'source': 'button'\n    })\n\n    ZegoUIKitPrebuiltCallInvitation.getInstance().onInvitationSent(\n      navigation,\n      invitationID,\n      invitees,\n      successfulInvitees,\n      _roomID,\n      isVideoCall,\n      callName,\n      showWaitingPageWhenGroupCall\n    );\n\n    if (typeof onPressed === 'function') {\n      onPressed(errorCode, errorMessage, errorInvitees);\n    }\n  };\n\n  const onFailure = ({ code: errorCode, message: errorMessage }) => {\n    if (typeof onPressed === 'function') {\n      onPressed(errorCode, errorMessage, undefined);\n    }\n  };\n\n  const onRequestStatusChanged = (isInviteCalling) => {\n    CallInviteStateManage.setOutgoingCallStatus(isInviteCalling)\n  }\n\n  const loginHandler = ({ userID, userName }) => {\n    if (localUser.userID === userID) {\n      zloginfo(`[ZegoSendCallInvitationButton][loginHandler] userID not changed, userID: ${userID}`)\n      return;\n    }\n\n    zloginfo(`[ZegoSendCallInvitationButton][loginHandler] userID: ${userID}, userName: ${userName}`)\n    setLocalUser({ userID, userName });\n  };\n\n  useEffect(() => {\n    zloginfo(`[ZegoSendCallInvitationButton] useEffect, callName: ${callName}`)\n\n    const unsubscribe1 = navigation.addListener('blur', () => {\n      zloginfo(\n        `[Navigation] ZegoSendCallInvitationButton blur, isVideoCall: ${isVideoCall}`\n      );\n    });\n    const unsubscribe2 = navigation.addListener('focus', () => {\n      zloginfo(\n        `[Navigation] ZegoSendCallInvitationButton focus, isVideoCall: ${isVideoCall}`\n      );\n    });\n    const unsubscribe3 = navigation.addListener('beforeRemove', () => {\n      zloginfo(\n        `[Navigation] ZegoSendCallInvitationButton beforeRemove, isVideoCall: ${isVideoCall}`\n      );\n    });\n    eventEmitter.on(EventName.LOGINED, loginHandler);\n\n    return () => {\n      zloginfo(`[ZegoSendCallInvitationButton] useEffect return`)\n\n      unsubscribe1();\n      unsubscribe2();\n      unsubscribe3();\n      eventEmitter.off(EventName.LOGINED, loginHandler);\n    };\n  }, []);\n\n  const updateData = () => {\n    _roomID = callID ?? `call_${localUser.userID}_${Date.now()}`;\n    zloginfo(`ZegoSendCallInvitationButton _roomID: ${_roomID}`);\n\n    const _data = JSON.stringify({\n      call_id: _roomID,\n      call_name: callName,\n      invitees: invitees.map((invitee) => {\n        return { user_id: invitee.userID, user_name: invitee.userName };\n      }),\n      type: isVideoCall\n        ? ZegoInvitationType.videoCall\n        : ZegoInvitationType.voiceCall,\n      inviter: { id: localUser.userID, name: localUser.userName },\n      timeout: timeout,\n      custom_data: customData,\n    });\n\n    return _data\n  }\n\n  return (\n    <View style={styles.container}>\n      <ZegoSendInvitationButton\n        icon={icon}\n        text={text}\n        invitees={getInviteeIDList()}\n        type={\n          isVideoCall\n            ? ZegoInvitationType.videoCall\n            : ZegoInvitationType.voiceCall\n        }\n        onRequestData={() => {return updateData()}}\n        timeout={timeout}\n        onWillPressed={() => {return isCanSendInvitation()}}\n        onPressed={onPress}\n        onFailure={onFailure}\n        onRequestStatusChanged={onRequestStatusChanged}\n        resourceID={_resourceID}\n        width={width}\n        height={height}\n        color={textColor}\n        fontSize={fontSize}\n        backgroundColor={backgroundColor}\n        verticalLayout={verticalLayout}\n        borderRadius={borderRadius}\n        borderWidth={borderWidth}\n        borderColor={borderColor}\n        borderStyle={borderStyle}\n        notificationTitle={\n          callName ? callName :\n            InnerTextHelper.instance().getIncomingCallDialogTitle(\n              localUser.userName,\n              isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall,\n              invitees.length)\n        }\n        notificationMessage={\n          InnerTextHelper.instance().getIncomingCallDialogMessage(\n            isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall,\n            invitees.length\n          )}\n      />\n    </View>\n  );\n}\nconst styles = StyleSheet.create({\n  container: {},\n});\n"],"mappings":"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","ignoreList":[]}