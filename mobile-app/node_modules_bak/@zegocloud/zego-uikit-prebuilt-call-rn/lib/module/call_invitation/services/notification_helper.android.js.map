{"version":3,"names":["AppState","NativeEventEmitter","NativeModules","PermissionsAndroid","Platform","ZegoUIKit","zlogerror","zloginfo","zlogwarning","PrebuiltCallReport","CallInviteHelper","InnerTextHelper","ZegoPrebuiltPlugins","ZegoUIKitPrebuiltCallRNModule","eventEmitter","NotificationHelper","constructor","_defineProperty","getSignalingPlugin","getZegoUIKitSignalingPlugin","getInstance","TAG","String","Math","floor","random","Map","addEventListener","nextState","dismissNotification","_currentCallID","_instance","init","plugins","_alreadyInit","_plugins","addListener","data","_onCallKitEndCall","_onCallKitAnswerCall","showOfflineNotification","callID","callUUID","callData","JSON","stringify","notifyUuid","_callIDUuidMap","get","set","call_id","roomID","call_name","type","inviter","invitees","timeout","_currentCallStatus","_offlineRefuse","setOfflineData","undefined","_callData","isPureOfflinePush","callerName","instance","getIncomingCallDialogTitle","name","length","message","getIncomingCallDialogMessage","_displayIncomingCall","showOnlineNotification","notifyTag","currentState","Date","now","toString","appState","areEnabledPromise","Version","areNotificationsEnabled","check","PERMISSIONS","POST_NOTIFICATIONS","then","hasPermission","_displayIncomingCallInternal","displayIncomingCall","reportEvent","reason","from","dismissCallNotification","action","_whenEndCallFinal","_onlineRefuse","loadLoginInfoFromLocalEncryptedStorage","loginInfo","_callbackID","appID","appSign","userID","userName","_signalingPlugin","refuseInvitation","id","result","code","refuseCall","uninit","catch","error","getLocalUser","app_state","onLoginSuccess","acceptCall","acceptInvitation","getCurrentInCallID","_NotificationHelper"],"sources":["notification_helper.android.tsx"],"sourcesContent":["import { AppState, NativeEventEmitter, NativeModules, PermissionsAndroid, Platform } from 'react-native';\n\nimport ZegoUIKit, { ZegoPluginResult } from '@zegocloud/zego-uikit-rn';\nimport { ZIMError } from 'zego-zim-react-native';\n\nimport { zlogerror, zloginfo, zlogwarning } from '../../utils/logger';\nimport PrebuiltCallReport from '../../utils/report';\nimport CallInviteHelper from './call_invite_helper';\nimport InnerTextHelper from './inner_text_helper';\nimport ZegoPrebuiltPlugins from './plugins';\n\nconst { ZegoUIKitPrebuiltCallRNModule } = NativeModules;\nconst eventEmitter = new NativeEventEmitter(ZegoUIKitPrebuiltCallRNModule);\n\nexport type CallStatus = 'waiting' | 'notification' | 'calling';\n\nexport default class NotificationHelper {\n    TAG = 'NotificationHelper';\n    static _instance: NotificationHelper;\n\n    _signalingPlugin = ZegoUIKit.getSignalingPlugin()\n    _uikitSignalingPlugin = ZegoUIKit.getSignalingPlugin().getZegoUIKitSignalingPlugin().getInstance()\n    _callbackID = `${this.TAG}_${String(Math.floor(Math.random() * 10000))}`\n\n    _callData = {};\n    _callIDUuidMap = new Map<string, string>();\n    _currentCallID = '';\n    _currentCallStatus: CallStatus = 'waiting'\n    _alreadyInit = false\n    _plugins: [] = []\n\n    constructor() {\n        AppState.addEventListener('change', async nextState => {\n            zloginfo('nextState', nextState);\n            if (nextState === 'active') {\n                this.dismissNotification(this._currentCallID, 'active', this.TAG)\n            }\n        });\n    }\n    static getInstance() {\n        return this._instance || (this._instance = new NotificationHelper());\n    }\n\n    init(plugins?: any) {\n        if (this._alreadyInit) {\n            return\n        }\n\n        zloginfo(`[NotificationHelper][init]`)\n        this._plugins = plugins\n\n        eventEmitter.addListener('RNCallKitPerformEndCallAction', (data) => {\n            zloginfo(`[EventListener] receive RNCallKitPerformEndCallAction from NativeModule, action: ${data}`)\n            this._onCallKitEndCall(data)\n        });\n        zloginfo(`[NotificationHelper][init] set onCallKitEndCall`)\n\n        eventEmitter.addListener('RNCallKitPerformAnswerCallAction', (data) => {\n            zloginfo(`[EventListener] receive RNCallKitPerformAnswerCallAction from NativeModule, action: ${data}`)\n            this._onCallKitAnswerCall()\n        });\n        zloginfo(`[NotificationHelper][init] set onCallKitAnswerCall`)\n\n        this._alreadyInit = true\n    }\n\n    // for offline call\n    showOfflineNotification(callID: string, callUUID: string, callData: any) {\n        if (!callData) {\n            zlogerror('[NotificationHelper][showOfflineNotification] callData is empty')\n            return\n        }\n        zloginfo(`[NotificationHelper][showOfflineNotification] callID: ${callID}, callUUID: ${callUUID}, callData: ${JSON.stringify(callData)}`)\n\n        let notifyUuid = this._callIDUuidMap.get(callID);\n        if (notifyUuid) {\n            zloginfo(`[NotificationHelper][showOfflineNotification] callID: ${callID} ignore, already shown notification`)\n            return\n        }\n        this._callIDUuidMap.set(callID, callUUID)\n\n        let { call_id: roomID, call_name, type, inviter, invitees, timeout } = callData;\n\n        if (this._currentCallID && this._currentCallStatus === 'notification') {\n            zloginfo(`[NotificationHelper][showOfflineNotification] another call is showing`)\n            this._offlineRefuse(callID, roomID, inviter, 'busy')\n            return;\n        }\n\n        this._currentCallID = callID\n        this._currentCallStatus = 'notification'\n        zloginfo(`[NotificationHelper][showOfflineNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n        CallInviteHelper.getInstance().setOfflineData(undefined)\n\n        // callID mean zim callID\n        this._callData = { callID, roomID, call_name, type, inviter, invitees, isPureOfflinePush: true }\n        zloginfo(`[NotificationHelper][showOfflineNotification] _callData: ${JSON.stringify(this._callData)}`)\n\n        const callerName = call_name ?? InnerTextHelper.instance().getIncomingCallDialogTitle(inviter.name, type, invitees.length);\n        const message = InnerTextHelper.instance().getIncomingCallDialogMessage(type, invitees.length);\n        zloginfo(`[NotificationHelper][showOfflineNotification], callerName: ${callerName}, message: ${message}`);\n\n        this._displayIncomingCall(callID, callerName, message, timeout ?? 60, 'restarted')\n    }\n\n    // for online call when background\n    showOnlineNotification(callID: string, callData: any) {\n        let notifyTag = this._callIDUuidMap.get(callID);\n        if (notifyTag) {\n            zloginfo(`[NotificationHelper][showOnlineNotification] callID: ${callID} ignore, already shown notification`)\n            return\n        }\n\n        if (!callData) {\n            zlogerror('[NotificationHelper][showOnlineNotification] _callData is empty')\n            return\n        }\n\n        // @ts-ignore\n        let { roomID, type, inviter, invitees, timeout } = callData;\n        zloginfo(`[NotificationHelper][showOnlineNotification] callID: ${callID}, roomID: ${roomID}, isVideoCall: ${type}, inviter: ${JSON.stringify(inviter)}, invitees: ${JSON.stringify(invitees)}, timeout: ${timeout}`)\n        \n        const callerName = InnerTextHelper.instance().getIncomingCallDialogTitle(inviter.name, type, invitees.length);\n        const message = InnerTextHelper.instance().getIncomingCallDialogMessage(type, invitees.length);\n        zloginfo(`[NotificationHelper][showOnlineNotification], callerName: ${callerName}, message: ${message}`);\n\n        this._displayIncomingCall(callID, callerName, message, timeout ?? 60, AppState.currentState)\n        \n        this._currentCallID = callID\n        this._currentCallStatus = 'notification'\n        zloginfo(`[NotificationHelper][showOnlineNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n        notifyTag = Date.now().toString()\n        this._callIDUuidMap.set(callID, notifyTag)\n        zloginfo(`[NotificationHelper][showOnlineNotification] set ${callID} into _callIDUuidMap`)\n\n        // callID mean zim callID\n        this._callData = { callID, roomID, type, inviter, invitees }\n        zloginfo(`[NotificationHelper][showOnlineNotification] _callData: ${JSON.stringify(this._callData)}`)\n    }\n\n    _displayIncomingCall(callID: string, callerName: string, message: string, timeout: number, appState: string) {\n        var areEnabledPromise = (Platform.Version as number < 33) ? ZegoUIKitPrebuiltCallRNModule.areNotificationsEnabled() : PermissionsAndroid.check(PermissionsAndroid.PERMISSIONS.POST_NOTIFICATIONS)\n        areEnabledPromise.then((hasPermission: boolean) => {\n            if (hasPermission) {\n                this._displayIncomingCallInternal(callID, callerName, message, timeout, appState)\n            } else {\n                zlogwarning(`[NotificationHelper][_displayIncomingCall] displayIncomingCall failed, no permission`)\n            }\n        })\n}\n\n    _displayIncomingCallInternal(callID: string, callerName: string, message: string, timeout: number, appState: string) {\n        ZegoUIKitPrebuiltCallRNModule.displayIncomingCall(callID, callerName, message, timeout);\n        zloginfo(`[NotificationHelper][_displayIncomingCall] displayIncomingCall callID: ${callID}, state: ${appState}`)\n        PrebuiltCallReport.reportEvent('call/displayNotification', {\n            'call_id': callID,\n            'app_state': appState\n        })\n    }\n\n    dismissNotification(callID: string, reason: string, from: string) {\n        zloginfo(`[NotificationHelper][dismissNotification] callID: ${callID}, reason: ${reason}, from: ${from}`)\n\n        if (reason === 'BeCancelled' || reason === 'Timeout') {\n            if (!callID || callID !== this._currentCallID) {\n                zloginfo(`[NotificationHelper][dismissNotification] ignore callID: ${callID}`)\n                return\n            }\n    \n            let notifyUuid = this._callIDUuidMap.get(callID);\n            if (notifyUuid) {\n                ZegoUIKitPrebuiltCallRNModule.dismissCallNotification();\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][dismissNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n                PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                    'call_id': callID,\n                    'app_state': AppState.currentState,\n                    'action': reason\n                })\n            }\n        } else {\n            // Handed over to the active state for handling\n            let notifyUuid = this._callIDUuidMap.get(callID);\n            if (notifyUuid) {\n                ZegoUIKitPrebuiltCallRNModule.dismissCallNotification();\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][dismissNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n            }\n        }\n    }\n\n    async _onCallKitEndCall(action: string) {\n        if (!this._callData) {\n            zlogerror('[NotificationHelper][_onCallKitEndCall] _callData is empty')\n            return\n        }\n        zloginfo(`[NotificationHelper][_onCallKitEndCall] callData: ${JSON.stringify(this._callData)}, state: ${AppState.currentState}`)\n        \n        // Offline incoming calls are not supported (too early), and online incoming calls rely on ZegoCallInvitationDialog\n        // CallEventNotifyApp.getInstance().notifyIncomingCallDeclineButtonPressed()\n        \n        // @ts-ignore\n        let { callID, roomID, inviter, isPureOfflinePush } = this._callData;\n        this._callData = undefined\n\n        if (action === 'Timeout') {\n            this._whenEndCallFinal()\n        } else if (action !== 'Refuse') {\n            // Currently, there are only two actions: Timeout and Refuse.\n        } else if (isPureOfflinePush) {\n            // click decline button from notification\n            this._offlineRefuse(callID, roomID, inviter, 'refuse')\n        } else {\n            // click decline button from notification\n            this._onlineRefuse(callID, roomID, inviter)\n        }\n    }\n\n    _offlineRefuse(callID: string, roomID: string, inviter: any, reason: string) {\n        zloginfo('[NotificationHelper][_onCallKitEndCall] loadLoginInfoFromLocalEncryptedStorage')\n        ZegoPrebuiltPlugins.loadLoginInfoFromLocalEncryptedStorage()\n        .then((loginInfo: any) => {\n            zloginfo(`[NotificationHelper][_onCallKitEndCall] will refuse after signalingPlugin login succ, callbackID: ${this._callbackID}`)\n            ZegoPrebuiltPlugins.init(loginInfo.appID, loginInfo.appSign, loginInfo.userID, loginInfo.userName, this._plugins)\n            .then(() => {\n                this._signalingPlugin.refuseInvitation(inviter.id, JSON.stringify({\n                    callID, \n                    call_id: roomID, \n                    reason,\n                    'invitee': {userID: loginInfo.userID, userName: loginInfo.userName}\n                }))\n                .then((result: ZegoPluginResult) => {\n                    zloginfo(`[NotificationHelper][_onCallKitEndCall] refuseInvitation then, code: ${result.code}, message: ${result.message}`)\n\n                    PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                        'call_id': callID,\n                        'app_state': 'restarted',\n                        'action': reason\n                    })\n            \n                    CallInviteHelper.getInstance().refuseCall(callID);\n                    this._whenEndCallFinal()\n                    // In order to continue receiving offline push notifications in the future.\n                    ZegoUIKit.getSignalingPlugin().uninit()\n                })\n                .catch((error: ZIMError) => {\n                    zloginfo(`[NotificationHelper][_onCallKitEndCall] refuseInvitation catch, error: ${error.code}, message: ${error.message}`)\n\n                    CallInviteHelper.getInstance().refuseCall(callID);\n                    this._whenEndCallFinal()\n                    // In order to continue receiving offline push notifications in the future.\n                    ZegoUIKit.getSignalingPlugin().uninit()\n                })\n            })\n            .catch(() => {\n                this._whenEndCallFinal()\n            })\n        }).catch(() => {\n            this._whenEndCallFinal()\n        })\n    }\n\n    _onlineRefuse(callID: string, roomID: string, inviter: any) {\n        this._signalingPlugin.refuseInvitation(inviter.id, JSON.stringify({\n            callID, \n            call_id: roomID,\n            // @ts-ignore\n            'invitee': {userID: ZegoPrebuiltPlugins.getLocalUser().userID, userName: ZegoPrebuiltPlugins.getLocalUser().userName}\n        }))\n        .then((result: ZegoPluginResult) => {\n            zloginfo(`[NotificationHelper][_onCallKitEndCall] refuseInvitation then, code: ${result.code}, message: ${result.message}`)\n\n            PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                'call_id': callID,\n                'app_state': AppState.currentState,\n                'action': 'refuse'\n            })\n    \n            CallInviteHelper.getInstance().refuseCall(callID);\n            this._whenEndCallFinal()\n        })\n        .catch((error: ZIMError) => {\n            zloginfo(`[NotificationHelper][_onCallKitEndCall] refuseInvitation catch, error: ${error.code}, message: ${error.message}`)\n\n            CallInviteHelper.getInstance().refuseCall(callID);\n            this._whenEndCallFinal()\n        })\n    }\n\n    _whenEndCallFinal() {\n        this._currentCallID = ''\n        this._currentCallStatus = 'waiting'\n        zloginfo(`[NotificationHelper][_onCallKitEndCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n        // auto dismiss\n        // ZegoUIKitPrebuiltCallRNModule.dismissCallNotification();\n    }\n\n    _onCallKitAnswerCall() {\n        if (!this._callData) {\n            zlogerror('[NotificationHelper][_onCallKitAnswerCall] _callData is empty')\n            return\n        }\n        zloginfo(`[NotificationHelper][_onCallKitAnswerCall] callData: ${JSON.stringify(this._callData)}, state: ${AppState.currentState}`)\n\n        // @ts-ignore\n        let { callID, roomID, type, inviter, invitees, isPureOfflinePush } = this._callData;\n        this._callData = undefined\n\n        let app_state: string = (isPureOfflinePush) ? \"restarted\" : AppState.currentState\n\n        if (isPureOfflinePush) {\n            CallInviteHelper.getInstance().setOfflineData({call_id: roomID, type, inviter, invitees})\n        } else {\n            zloginfo(`[NotificationHelper][_onCallKitAnswerCall] will accept after signalingPlugin login succ, callbackID: ${this._callbackID}`)\n            this._signalingPlugin.onLoginSuccess(this._callbackID, () => {\n                CallInviteHelper.getInstance().acceptCall(callID, {call_id: roomID, type, inviter, invitees});\n                ZegoUIKit.getSignalingPlugin().acceptInvitation(inviter.id, JSON.stringify({\n                    callID, \n                    call_id: roomID,\n                    // @ts-ignore\n                    'invitee': {userID: ZegoPrebuiltPlugins.getLocalUser().userID, userName: ZegoPrebuiltPlugins.getLocalUser().userName}\n                }))\n                .then((result: ZegoPluginResult) => {\n                    zloginfo(`[NotificationHelper][_onCallKitAnswerCall] acceptInvitation then, code: ${result.code}, message: ${result.message}`)\n    \n                    PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                        'call_id': callID,\n                        app_state,\n                        'action': 'accept'\n                    })\n    \n                    this._currentCallID = ''\n                    this._currentCallStatus = 'waiting'\n                    zloginfo(`[NotificationHelper][_onCallKitAnswerCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n                    \n                    if (AppState.currentState === 'background') {\n                        this._currentCallID = callID\n                        this._currentCallStatus = 'calling'\n                        zloginfo(`[NotificationHelper][_onCallKitAnswerCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n                    }\n                })\n                .catch((error: ZIMError) => {\n                    zloginfo(`[NotificationHelper][_onCallKitAnswerCall] acceptInvitation catch, error: ${error.code}, message: ${error.message}`)\n    \n                    CallInviteHelper.getInstance().refuseCall(callID);\n                    this._currentCallID = ''\n                    this._currentCallStatus = 'waiting'\n                    zloginfo(`[NotificationHelper][_onCallKitAnswerCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n                })    \n            })\n        }\n    }\n\n    getCurrentInCallID() {\n        if (this._currentCallStatus === 'calling') {\n            return this._currentCallID;\n        } else {\n            return ''\n        }\n    }\n}"],"mappings":"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","ignoreList":[]}