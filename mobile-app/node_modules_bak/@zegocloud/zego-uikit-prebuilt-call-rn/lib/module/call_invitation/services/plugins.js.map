{"version":3,"names":["ZegoUIKit","ZegoInvitationConnectionState","ZegoUIKitLogger","zlogerror","zloginfo","EncryptedStorage","eventEmitter","EventName","_appInfo","_localUser","_pluginConnectionState","ZIMKitPlugin","_install","plugins","installPlugins","forEach","plugin","ZIMKit","default","getModuleName","temp","_storeLoginInfo","setItem","JSON","stringify","userID","userName","appID","appSign","error","ZegoPrebuiltPlugins","init","logSetUserID","callbackID","String","Math","floor","random","getSignalingPlugin","onConnectionStateChanged","state","login","then","emit","LOGINED","reconnectIfDisconnected","disconnected","logout","uninit","getLocalUser","getAppInfo","getZIMKitPlugin","loadLoginInfoFromLocalEncryptedStorage","loginInfoStr","getItem","parse","Promise","resolve","undefined"],"sources":["plugins.js"],"sourcesContent":["import ZegoUIKit, {\n  ZegoInvitationConnectionState,\n  ZegoUIKitLogger,\n} from '@zegocloud/zego-uikit-rn';\nimport { zlogerror, zloginfo } from '../../utils/logger';\nimport EncryptedStorage from 'react-native-encrypted-storage';\nimport { eventEmitter, EventName } from '../../utils/EventEmitter';\n\nconst _appInfo = {};\nconst _localUser = {};\nlet _pluginConnectionState;\nlet ZIMKitPlugin = null;\n\nconst _install = (plugins) => {\n  ZegoUIKit.installPlugins(plugins);\n  plugins.forEach(plugin => {\n    if (plugin.ZIMKit) {\n      zloginfo('[Plugins] install ZIMKit success.');\n      ZIMKitPlugin = plugin;\n    } else if (plugin.default && typeof plugin.default.getModuleName === 'function') {\n      const temp = plugin.default.getModuleName();\n      if (temp === 'ZIMKit') {\n        zloginfo('[Plugins] install ZIMKit success.');\n        ZIMKitPlugin = plugin;\n      }\n    }\n  })\n};\n\nconst _storeLoginInfo = async () => {\n  try {\n    await EncryptedStorage.setItem(\n      \"_ZegoUIKitPrebuiltCallLoginInfo\",\n      JSON.stringify({\n        userID: _localUser.userID,\n        userName: _localUser.userName,\n        appID: _appInfo.appID,\n        appSign: _appInfo.appSign,\n      })\n    );\n  } catch (error) {\n    zlogerror('[Plugins] _storeLoginInfo error', error)\n  }\n}\n\nconst ZegoPrebuiltPlugins = {\n  init: (appID, appSign, userID, userName, plugins) => {\n    ZegoUIKitLogger.logSetUserID(userID)\n\n    zloginfo('[ZegoPrebuiltPlugins] init', {\n      appID,\n      userID,\n      userName,\n    });\n\n    const callbackID =\n      'ZegoPrebuiltPlugins' + String(Math.floor(Math.random() * 10000));\n    _install(plugins);\n    ZegoUIKit.getSignalingPlugin().init(appID, appSign);\n    ZegoUIKit.getSignalingPlugin().onConnectionStateChanged(\n      callbackID,\n      ({ state }) => {\n        _pluginConnectionState = state;\n      }\n    );\n    _appInfo.appID = appID;\n    _appInfo.appSign = appSign;\n    _localUser.userID = userID;\n    _localUser.userName = userName;\n    _storeLoginInfo();\n\n    return ZegoUIKit.getSignalingPlugin()\n      .login(userID, userName)\n      .then(() => {\n        zloginfo(`[Plugins] login success. userID: ${userID}, userName: ${userName}`);\n        eventEmitter.emit(EventName.LOGINED, { userID, userName });\n      });\n  },\n  reconnectIfDisconnected: () => {\n    zloginfo(\n      '[Plugins] reconnectIfDisconnected',\n      _pluginConnectionState,\n      ZegoInvitationConnectionState.disconnected\n    );\n    if (_pluginConnectionState === ZegoInvitationConnectionState.disconnected) {\n      ZegoUIKit.getSignalingPlugin().logout().then(() => {\n        zloginfo('[Plugins] auto logout success.');\n        ZegoUIKit.getSignalingPlugin().login(\n          _localUser.userID,\n          _localUser.userName\n        ).then(() => {\n          zloginfo('[Plugins] auto reconnect success.');\n        });\n      });\n    }\n  },\n  uninit: () => {\n    zloginfo('[ZegoPrebuiltPlugins] uninit');\n\n    delete _appInfo.appID;\n    delete _appInfo.appSign;\n    delete _localUser.userID;\n    delete _localUser.userName;\n    ZegoUIKit.getSignalingPlugin().logout();\n    ZegoUIKit.getSignalingPlugin().uninit();\n  },\n  getLocalUser: () => {\n    return _localUser;\n  },\n  getAppInfo: () => {\n    return _appInfo;\n  },\n  getZIMKitPlugin: () => {\n    return ZIMKitPlugin;\n  },\n  loadLoginInfoFromLocalEncryptedStorage: async () => {\n    try {\n      const loginInfoStr = await EncryptedStorage.getItem(\n        \"_ZegoUIKitPrebuiltCallLoginInfo\"\n      );\n      if (loginInfoStr) {\n        return JSON.parse(loginInfoStr);\n      }\n    } catch (error) {\n      zlogerror('[Plugins] getAppInfoFromLocalEncryptedStorage error', error)\n      return Promise.resolve(undefined)\n    }\n  }\n};\n\nexport default ZegoPrebuiltPlugins;\n"],"mappings":"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","ignoreList":[]}