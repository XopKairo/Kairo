{"version":3,"names":["AppState","setCategory","uuid","ZegoUIKit","ZegoUIKitPrebuiltCallService","zlogerror","zloginfo","PrebuiltCallReport","CallInviteHelper","ZegoInvitationType","InnerTextHelper","ZegoPrebuiltPlugins","NotificationHelper","constructor","_defineProperty","getSignalingPlugin","getZegoUIKitSignalingPlugin","getInstance","TAG","String","Math","floor","random","Map","addEventListener","nextState","dismissNotification","_currentCallID","_instance","init","_uikitSignalingPlugin","onCallKitEndCall","_onCallKitEndCall","bind","onCallKitAnswerCall","_onCallKitAnswerCall","showOfflineNotification","callID","callUUID","callData","JSON","stringify","notifyUuid","_callIDUuidMap","get","reportCallKitCallEnded","set","call_id","roomID","type","inviter","invitees","_currentCallStatus","_refuse","undefined","reportEvent","_callData","isPureOfflinePush","showOnlineNotification","v4","callerName","instance","getIncomingCallDialogTitle","name","length","cxCallUpdate","localizedCallerName","hasVideo","videoCall","reportIncomingCall","then","catch","message","currentState","reason","from","action","hangUp","fulfill","_callbackID","appState","_signalingPlugin","onLoginSuccess","refuseInvitation","id","userID","getLocalUser","userName","result","code","refuseCall","error","fail","app_state","setOfflineData","acceptCall","acceptInvitation","getCurrentInCallID","_NotificationHelper"],"sources":["notification_helper.ios.tsx"],"sourcesContent":["import { AppState } from 'react-native';\n// @ts-ignore\nimport { setCategory } from 'react-native-sound';\nimport uuid from 'react-native-uuid';\n\nimport ZegoUIKit, { CXAction, CXCallUpdate, ZegoPluginResult } from '@zegocloud/zego-uikit-rn';\nimport { ZIMError } from 'zego-zim-react-native';\n\nimport ZegoUIKitPrebuiltCallService from '../../services';\nimport { zlogerror, zloginfo } from '../../utils/logger';\nimport PrebuiltCallReport from '../../utils/report';\nimport CallInviteHelper from './call_invite_helper';\nimport { ZegoInvitationType } from './defines';\nimport InnerTextHelper from './inner_text_helper';\nimport ZegoPrebuiltPlugins from './plugins';\n\nexport type CallStatus = 'waiting' | 'notification' | 'calling';\n\nexport default class NotificationHelper {\n    TAG = 'NotificationHelper';\n    static _instance: NotificationHelper;\n\n    _signalingPlugin = ZegoUIKit.getSignalingPlugin()\n    _uikitSignalingPlugin = ZegoUIKit.getSignalingPlugin().getZegoUIKitSignalingPlugin().getInstance()\n    _callbackID = `${this.TAG}_${String(Math.floor(Math.random() * 10000))}`\n\n    _callData = {};\n    _callIDUuidMap = new Map<string, string>();\n    _currentCallID = '';\n    _currentCallStatus: CallStatus = 'waiting'\n\n    constructor() {\n        AppState.addEventListener('change', async nextState => {\n            zloginfo('nextState', nextState);\n            if (nextState === 'active') {\n                this.dismissNotification(this._currentCallID, 'active', this.TAG)\n            }\n        });\n    }\n    static getInstance() {\n        return this._instance || (this._instance = new NotificationHelper());\n    }\n\n    init() {\n        zloginfo(`[NotificationHelper][init]`)\n\n        this._uikitSignalingPlugin.onCallKitEndCall(this._onCallKitEndCall.bind(this))\n        zloginfo(`[NotificationHelper][init] set onCallKitEndCall`)\n\n        this._uikitSignalingPlugin.onCallKitAnswerCall(this._onCallKitAnswerCall.bind(this))\n        zloginfo(`[NotificationHelper][init] set onCallKitAnswerCall`)\n    }\n\n    // for offline call\n    showOfflineNotification(callID: string, callUUID: string, callData: any) {\n        if (!callData) {\n            zlogerror('[NotificationHelper][showOfflineNotification] callData is empty')\n            return\n        }\n        zloginfo(`[NotificationHelper][showOfflineNotification] callID: ${callID}, callUUID: ${callUUID}, callData: ${JSON.stringify(callData)}`)\n\n        let notifyUuid = this._callIDUuidMap.get(callID);\n        if (notifyUuid) {\n            zloginfo(`[NotificationHelper][showOfflineNotification] callID: ${callID} ignore, already shown notification`)\n            this._uikitSignalingPlugin.reportCallKitCallEnded(callUUID, 2)    // 2 - RemoteEnded\n            return\n        }\n        this._callIDUuidMap.set(callID, callUUID)\n\n        let { call_id: roomID, type, inviter, invitees } = callData;\n\n        if (this._currentCallID && this._currentCallStatus === 'notification') {\n            zloginfo(`[NotificationHelper][showOfflineNotification] another call is showing`)\n\n            this._refuse(undefined, callID, roomID, inviter, 'busy', 'restarted')\n            this._uikitSignalingPlugin.reportCallKitCallEnded(callUUID, 2)    // 2 - RemoteEnded\n\n            PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                'call_id': callID,\n                'app_state': 'restarted',\n                'action': 'busy'\n            })\n            return;\n        }\n\n        this._currentCallID = callID\n        this._currentCallStatus = 'notification'\n        zloginfo(`[NotificationHelper][showOfflineNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n        \n        zloginfo(`[NotificationHelper][showOfflineNotification] displayIncomingCall callID: ${callID}`)\n\n        // callID mean zim callID\n        this._callData = { callID, roomID, type, inviter, invitees, isPureOfflinePush: true }\n        zloginfo(`[NotificationHelper][showOfflineNotification] _callData: ${JSON.stringify(this._callData)}`)\n    }\n\n    // for online call when background\n    showOnlineNotification(callID: string, callData: any) {\n        let notifyUuid = this._callIDUuidMap.get(callID);\n        if (notifyUuid) {\n            zloginfo(`[NotificationHelper][showOnlineNotification] callID: ${callID} ignore, already shown notification`)\n            return\n        }\n\n        if (!callData) {\n            zlogerror('[NotificationHelper][showOnlineNotification] _callData is empty')\n            return\n        }\n\n        // @ts-ignore\n        let { roomID, type, inviter, invitees } = callData;\n\n        zloginfo(`[NotificationHelper][showOnlineNotification] callID: ${callID}, roomID: ${roomID}, isVideoCall: ${type}, inviter: ${JSON.stringify(inviter)}, invitees: ${JSON.stringify(invitees)}`)\n        \n        notifyUuid = uuid.v4();\n        zloginfo(`[NotificationHelper][showOnlineNotification] reportIncomingCall callID: ${callID}, uuid: ${notifyUuid}`)\n\n        const callerName = InnerTextHelper.instance().getIncomingCallDialogTitle(inviter.name, type, invitees.length);\n        zloginfo(`[NotificationHelper][showOnlineNotification], callerName: ${callerName}`);\n        \n        let cxCallUpdate = { } as CXCallUpdate;\n        cxCallUpdate.localizedCallerName = callerName\n        cxCallUpdate.hasVideo = (type === ZegoInvitationType.videoCall)\n        this._uikitSignalingPlugin.reportIncomingCall(cxCallUpdate, notifyUuid).then(() => {\n            zloginfo(`[NotificationHelper][showOnlineNotification] reportIncomingCall succeeded, callID: ${callID}`)\n        }).catch((message: string) => {\n            zlogerror(`[NotificationHelper][showOnlineNotification] reportIncomingCall failed, reason: ${message}`)\n        })\n        \n        this._currentCallID = callID\n        this._currentCallStatus = 'notification'\n        zloginfo(`[NotificationHelper][showOnlineNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n        this._callIDUuidMap.set(callID, notifyUuid)\n        zloginfo(`[NotificationHelper][showOnlineNotification] set ${callID} into _callIDUuidMap`)\n\n        PrebuiltCallReport.reportEvent('call/displayNotification', {\n            'call_id': callID,\n            'app_state': AppState.currentState\n        })\n\n        this._callData = { callID, roomID, type, inviter, invitees }\n        zloginfo(`[NotificationHelper][showOnlineNotification] _callData: ${JSON.stringify(this._callData)}`)\n    }\n\n    dismissNotification(callID: string, reason: string, from: string) {\n        zloginfo(`[NotificationHelper][dismissNotification] callID: ${callID}, reason: ${reason}, from: ${from}`)\n\n        if (reason === 'active') {\n            // Handed over to the active state for handling\n            let notifyUuid = this._callIDUuidMap.get(callID);\n            if (notifyUuid) {\n                this._uikitSignalingPlugin.reportCallKitCallEnded(notifyUuid, 2)    // 2 - RemoteEnded\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][dismissNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n            }\n        } else if (reason === 'BeCancelled' || reason === 'Timeout') {\n            if (!callID || callID !== this._currentCallID) {\n                zloginfo(`[NotificationHelper][dismissNotification] ignore callID: ${callID}`)\n                return\n            }\n    \n            let notifyUuid = this._callIDUuidMap.get(callID);\n            if (notifyUuid) {\n                this._uikitSignalingPlugin.reportCallKitCallEnded(notifyUuid, 2)    // 2 - RemoteEnded\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][dismissNotification] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n                PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                    'call_id': callID,\n                    'app_state': AppState.currentState,\n                    'action': reason\n                })\n            }\n        }\n    }\n\n    _onCallKitEndCall(action: CXAction) {\n        if (!this._callData) {\n            zlogerror('[NotificationHelper][_onCallKitEndCall] _callData is empty')\n            return\n        }\n        zloginfo(`[NotificationHelper][_onCallKitEndCall] callData: ${JSON.stringify(this._callData)}, state: ${AppState.currentState}`)\n        \n        // Offline incoming calls are not supported (too early), and online incoming calls rely on ZegoCallInvitationDialog\n        // CallEventNotifyApp.getInstance().notifyIncomingCallDeclineButtonPressed()\n        \n        if (this._currentCallID && this._currentCallStatus === 'calling') {\n            // click accept and hangup\n            this.hangUp(this._currentCallID, 'onCallKitEndCall')\n            zloginfo(`[NotificationHelper][_onCallKitEndCall] hangUp`)\n            this._currentCallID = ''\n            this._currentCallStatus = 'waiting'\n            zloginfo(`[NotificationHelper][_onCallKitEndCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n            action.fulfill();\n        } else {\n            // click decline button from notification\n        \n            // @ts-ignore\n            let { callID, roomID, inviter } = this._callData;\n            this._callData = undefined\n\n            zloginfo(`[NotificationHelper][_onCallKitEndCall] will refuse after signalingPlugin login succ, callbackID: ${this._callbackID}`)\n            this._refuse(action, callID, roomID, inviter, 'refuse', AppState.currentState)\n        }\n    }\n\n    _refuse(action: CXAction, callID: string, roomID: string, inviter: any, reason: string, appState: string) {\n        this._signalingPlugin.onLoginSuccess(this._callbackID, () => {\n            // tell caller\n            this._signalingPlugin.refuseInvitation(inviter.id, JSON.stringify({\n                callID, \n                call_id: roomID,\n                // @ts-ignore\n                'invitee': {userID: ZegoPrebuiltPlugins.getLocalUser().userID, userName: ZegoPrebuiltPlugins.getLocalUser().userName}\n            }))\n            .then((result: ZegoPluginResult) => {\n                zloginfo(`[NotificationHelper][_onCallKitEndCall] refuseInvitation then, code: ${result.code}, message: ${result.message}`)\n\n                PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                    'call_id': callID,\n                    'app_state': appState,\n                    'action': reason\n                })\n        \n                CallInviteHelper.getInstance().refuseCall(callID);\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][_onCallKitEndCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n                // tell ios decline completion\n                if (action) {\n                    action.fulfill();\n                }\n            })\n            .catch((error: ZIMError) => {\n                zloginfo(`[NotificationHelper][_onCallKitEndCall] refuseInvitation catch, error: ${error.code}, message: ${error.message}`)\n\n                CallInviteHelper.getInstance().refuseCall(callID);\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][_onCallKitEndCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n                // tell ios decline fail\n                if (action) {\n                    action.fail();\n                }\n            })\n\n            this._signalingPlugin.onLoginSuccess(this._callbackID)\n        })\n    }\n\n    _onCallKitAnswerCall(action: CXAction) {\n        if (!this._callData) {\n            zlogerror('[NotificationHelper][_onCallKitAnswerCall] _callData is empty')\n            return\n        }\n        zloginfo(`[NotificationHelper][_onCallKitAnswerCall] callData: ${JSON.stringify(this._callData)}, state: ${AppState.currentState}`)\n\n        // @ts-ignore\n        let { callID, roomID, type, inviter, invitees, isPureOfflinePush } = this._callData;\n        // this._callData = undefined   // Do not clear it, as it will still be needed when the VoIP call is hangup later.\n\n        zloginfo(`[NotificationHelper][_onCallKitAnswerCall] will accept after signalingPlugin login succ, callbackID: ${this._callbackID}`)\n        this._signalingPlugin.onLoginSuccess(this._callbackID, () => {\n            let app_state: string = AppState.currentState\n            if (isPureOfflinePush) {\n                CallInviteHelper.getInstance().setOfflineData({call_id: roomID, type, inviter, invitees});\n                app_state = \"restarted\"\n            }\n\n            setCategory('PlayAndRecord');\n            CallInviteHelper.getInstance().acceptCall(callID, {call_id: roomID, type, inviter, invitees});\n            ZegoUIKit.getSignalingPlugin().acceptInvitation(inviter.id, JSON.stringify({\n                callID, \n                call_id: roomID,\n                // @ts-ignore\n                'invitee': {userID: ZegoPrebuiltPlugins.getLocalUser().userID, userName: ZegoPrebuiltPlugins.getLocalUser().userName}\n            }))\n            .then((result: ZegoPluginResult) => {\n                zloginfo(`[NotificationHelper][_onCallKitAnswerCall] acceptInvitation then, code: ${result.code}, message: ${result.message}`)\n\n                PrebuiltCallReport.reportEvent('call/respondInvitation', {\n                    'call_id': callID,\n                    app_state,\n                    'action': 'accept'\n                })\n\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][_onCallKitAnswerCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n                if (AppState.currentState === 'background') {\n                    this._currentCallID = callID\n                    this._currentCallStatus = 'calling'\n                    zloginfo(`[NotificationHelper][_onCallKitAnswerCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n                }\n\n                action.fulfill();\n            })\n            .catch((error: ZIMError) => {\n                zloginfo(`[NotificationHelper][_onCallKitAnswerCall] acceptInvitation catch, error: ${error.code}, message: ${error.message}`)\n\n                this.hangUp(callID, 'acceptFailed')\n                CallInviteHelper.getInstance().refuseCall(callID);\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][_onCallKitAnswerCall] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n\n                // tell ios decline fail\n                action.fail();\n            })\n        })\n    }\n\n    hangUp(callID: string, reason: string) {\n        zloginfo(`[NotificationHelper][hangUp] callID: ${callID}, reason: ${reason}`)\n\n        if (reason === 'onCallKitEndCall' || reason === 'acceptFailed') {\n            ZegoUIKitPrebuiltCallService.getInstance().hangUp();\n        } else {\n            let notifyUuid = this._callIDUuidMap.get(callID);\n            if (notifyUuid) {\n                this._uikitSignalingPlugin.reportCallKitCallEnded(notifyUuid, 2)    // 2 - RemoteEnded\n                this._currentCallID = ''\n                this._currentCallStatus = 'waiting'\n                zloginfo(`[NotificationHelper][hangUp] set _currentCallID: ${this._currentCallID}, status: ${this._currentCallStatus}`)\n            }\n        }\n    }\n\n    getCurrentInCallID() {\n        if (this._currentCallStatus === 'calling') {\n            return this._currentCallID;\n        } else {\n            return ''\n        }\n    }\n}"],"mappings":"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","ignoreList":[]}