{"version":3,"names":["ZegoUIKit","ZegoPrebuiltPlugins","zloginfo","InviteState","uncompleted","completed","pending","accepted","missed","rejected","CallInviteStateManage","_callbackID","_invitationMap","Map","_onInviteCompletedWithNobodyMap","_onSomeoneAcceptedInviteMap","_inOutgoingCall","_notifyInviteCompletedWithNobody","callID","stateDetails","get","completedWithNobody","inviteState","Array","from","invitees","values","find","forEach","callback","_judgeInviteCompleted","inviteDetails","init","registerCallback","uninit","unRegisterCallback","clear","String","Math","floor","random","getSignalingPlugin","onInvitationResponseTimeout","data","invitee","set","id","onInvitationRefused","isInviteCompleted","onInvitationAccepted","onInvitationReceived","type","inviter","TAG","JSON","stringify","parse","addInviteData","map","user_id","onInvitationCanceled","delete","onInvitationTimeout","localUser","getLocalUser","userID","initInviteData","setOutgoingCallStatus","isInviteCalling","invitationID","inviterID","temp","inviteeID","updateInviteDataAfterRejected","updateInviteDataAfterAccepted","updateInviteDataAfterCancel","isAutoCancelInvite","auto","filter","length","isOncall","newCallID","localUserID","isOn","size","callIDs","keys","index","len","currentCallID","onSomeoneAcceptedInvite","callbackID","has","onInviteCompletedWithNobody"],"sources":["invite_state_manager.js"],"sourcesContent":["import ZegoUIKit from '@zegocloud/zego-uikit-rn';\nimport ZegoPrebuiltPlugins from './plugins';\nimport { zloginfo } from '../../utils/logger';\n\n// completed: Someone ran out of time, accepted or declined an invitation\n// uncompleted: Others did not accept or reject the invitation, and the invitation did not time out\n\n// Consider having multiple call invitation processes at the same time\n\nconst InviteState = {\n  uncompleted: 1, // inviter: send an invitation、init state\n  completed: 2, // inviter: send an invitation\n  pending: 3, // invitee: call pending、init state\n  accepted: 4, // invitee: accept\n  missed: 5, // invitee: timout\n  rejected: 6, // invitee: rejection\n};\n\nconst CallInviteStateManage = {\n  _callbackID: '',\n  _invitationMap: new Map(), // callID -> state detail\n  _onInviteCompletedWithNobodyMap: new Map(),\n  _onSomeoneAcceptedInviteMap: new Map(),\n  \n  // Set to true when making an outgoing call, and reset to false after the call is answered or canceled\n  _inOutgoingCall: false,\n\n  _notifyInviteCompletedWithNobody: (callID) => {\n    const stateDetails = CallInviteStateManage._invitationMap.get(callID);\n    if (stateDetails) {\n      zloginfo(\n        '######_notifyInviteCompletedWithNobody######',\n        callID,\n        CallInviteStateManage._invitationMap\n      );\n      const completedWithNobody =\n        stateDetails.inviteState === InviteState.completed &&\n        !Array.from(stateDetails.invitees.values()).find(\n          (inviteState) => inviteState === InviteState.accepted\n        );\n      if (completedWithNobody) {\n        // notify\n        Array.from(\n          CallInviteStateManage._onInviteCompletedWithNobodyMap.values()\n        ).forEach((callback) => {\n          callback && callback(callID);\n        });\n      }\n    }\n  },\n  _judgeInviteCompleted: (callID) => {\n    const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n    return !Array.from(inviteDetails.invitees.values()).find(\n      (inviteState) => inviteState === InviteState.pending\n    );\n  },\n  init: () => {\n    CallInviteStateManage.registerCallback();\n  },\n  uninit: () => {\n    CallInviteStateManage.unRegisterCallback();\n    CallInviteStateManage._invitationMap.clear();\n    CallInviteStateManage._onInviteCompletedWithNobodyMap.clear();\n    CallInviteStateManage._onSomeoneAcceptedInviteMap.clear();\n    zloginfo('[CallInviteStateManage][uninit]')\n  },\n  registerCallback: () => {\n    zloginfo('[CallInviteStateManage]registerCallback success');\n    CallInviteStateManage._callbackID =\n      'CallInviteStateManage' + String(Math.floor(Math.random() * 10000));\n    ZegoUIKit.getSignalingPlugin().onInvitationResponseTimeout(\n      CallInviteStateManage._callbackID,\n      ({ callID, invitees, data }) => {\n        // update _invitationMap\n        const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n        if (inviteDetails) {\n          zloginfo(`[InviteStateManage][onInvitationResponseTimeout], callID: ${callID}, inviteDetails: ${inviteDetails}`)\n          invitees.forEach((invitee) => {\n            inviteDetails.invitees.set(invitee.id, InviteState.missed);\n          });\n          inviteDetails.inviteState =\n            CallInviteStateManage._judgeInviteCompleted(callID)\n              ? InviteState.completed\n              : InviteState.uncompleted;\n          zloginfo(`[InviteStateManage][onInvitationResponseTimeout], callID: ${callID}, set inviteState: ${inviteDetails.inviteState}`)\n          CallInviteStateManage._notifyInviteCompletedWithNobody(callID);\n        }\n      }\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationRefused(\n      CallInviteStateManage._callbackID,\n      ({ callID, invitee, data }) => {\n        // update _invitationMap\n        const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n        if (inviteDetails) {\n          inviteDetails.invitees.set(invitee.id, InviteState.rejected);\n          let isInviteCompleted = CallInviteStateManage._judgeInviteCompleted(callID)\n          zloginfo(`[InviteStateManage][onInvitationRefused] isInviteCompleted: ${isInviteCompleted}`)\n          inviteDetails.inviteState = isInviteCompleted ? InviteState.completed : InviteState.uncompleted;\n          CallInviteStateManage._notifyInviteCompletedWithNobody(callID);\n        }\n      }\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationAccepted(\n      CallInviteStateManage._callbackID,\n      ({ callID, invitee, data }) => {\n        // update _invitationMap\n        zloginfo(\n          '######onInvitationAccepted######',\n          CallInviteStateManage._invitationMap,\n          callID\n        );\n        const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n        if (inviteDetails) {\n          inviteDetails.invitees.set(invitee.id, InviteState.accepted);\n          inviteDetails.inviteState =\n            CallInviteStateManage._judgeInviteCompleted(callID)\n              ? InviteState.completed\n              : InviteState.uncompleted;\n          // notify\n          Array.from(\n            CallInviteStateManage._onSomeoneAcceptedInviteMap.values()\n          ).forEach((callback) => {\n            callback && callback(callID);\n          });\n        }\n      }\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationReceived(CallInviteStateManage._callbackID,\n      ({ callID, type, inviter, data }) => {\n        zloginfo(`onInvitationReceived implement by ${TAG}, callID: ${callID}, inviter: ${JSON.stringify(inviter)}, data: ${data}`);\n\n        data = JSON.parse(data);\n        // update _invitationMap\n        const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n        if (inviteDetails) {\n          // No such case\n        } else {\n          CallInviteStateManage.addInviteData(\n            callID,\n            inviter.id,\n            data.invitees.map((invitee) => invitee.user_id)\n          );\n        }\n      },\n      TAG\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationCanceled(\n      CallInviteStateManage._callbackID,\n      ({ callID, inviter, data }) => {\n        // update _invitationMap\n        CallInviteStateManage._invitationMap.delete(callID);\n      }\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationTimeout(\n      CallInviteStateManage._callbackID,\n      ({ callID, inviter, data }) => {\n        // update _invitationMap\n        const inviteDetails = CallInviteStateManage._invitationMap.get(callID);\n        if (inviteDetails) {\n          const localUser = ZegoPrebuiltPlugins.getLocalUser();\n          inviteDetails.invitees.set(localUser.userID, InviteState.missed);\n        } else {\n          // No such case\n        }\n      }\n    );\n  },\n  unRegisterCallback: () => {\n    ZegoUIKit.getSignalingPlugin().onInvitationResponseTimeout(\n      CallInviteStateManage._callbackID\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationRefused(\n      CallInviteStateManage._callbackID\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationAccepted(\n      CallInviteStateManage._callbackID\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationReceived(\n      CallInviteStateManage._callbackID\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationCanceled(\n      CallInviteStateManage._callbackID\n    );\n    ZegoUIKit.getSignalingPlugin().onInvitationTimeout(\n      CallInviteStateManage._callbackID\n    );\n  },\n  // This call is called after the call invitation has ended or before an invitation starts\n  initInviteData: () => {\n    zloginfo('[CallInviteStateManage][initInviteData]')\n    CallInviteStateManage._invitationMap.clear();\n  },\n  setOutgoingCallStatus: (isInviteCalling) => {\n    zloginfo('[CallInviteStateManage][setOutgoingCallStatus]', isInviteCalling)\n    CallInviteStateManage._inOutgoingCall = isInviteCalling\n  },\n  // This interface is called after the invitation is received and the invitation is successfully sent\n  addInviteData: (invitationID, inviterID, invitees) => {\n    const temp = new Map();\n    invitees.forEach((inviteeID) => {\n      temp.set(inviteeID, InviteState.pending);\n    });\n    CallInviteStateManage._invitationMap.set(invitationID, {\n      inviterID,\n      inviteState: InviteState.uncompleted,\n      invitees: temp,\n    });\n    zloginfo('[CallInviteStateManage][addInviteData]', JSON.stringify(...CallInviteStateManage._invitationMap));\n  },\n  // This interface is called after the invitation is successfully rejected\n  updateInviteDataAfterRejected: (callID) => {\n    // update _invitationMap\n    CallInviteStateManage._invitationMap.delete(callID);\n    zloginfo('[CallInviteStateManage][updateInviteDataAfterRejected]', JSON.stringify(...CallInviteStateManage._invitationMap));\n  },\n  // This interface is called after the invitation is successfully accepted\n  updateInviteDataAfterAccepted: (invitationID) => {\n    // update _invitationMap\n    const localUser = ZegoPrebuiltPlugins.getLocalUser();\n    const inviteDetails = CallInviteStateManage._invitationMap.get(invitationID);\n    if (inviteDetails) {\n      inviteDetails.invitees.set(localUser.userID, InviteState.accepted);\n    }\n    zloginfo('[CallInviteStateManage][updateInviteDataAfterAccepted]', JSON.stringify(...CallInviteStateManage._invitationMap));\n  },\n  // This interface is called after the invitation is successfully cancel\n  updateInviteDataAfterCancel: (invitationID) => {\n    // update _invitationMap\n    CallInviteStateManage._invitationMap.delete(invitationID);\n    zloginfo('[CallInviteStateManage][updateInviteDataAfterCancel]', JSON.stringify(...CallInviteStateManage._invitationMap));\n  },\n  isInviteCompleted: (invitationID) => {\n    const inviteDetails = CallInviteStateManage._invitationMap.get(invitationID);\n    if (inviteDetails) {\n      return inviteDetails.inviteState === InviteState.completed;\n    } else {\n      return false;\n    }\n  },\n  isAutoCancelInvite: (invitationID) => {\n    zloginfo(\n      '######isAutoCancelInvite######',\n      invitationID,\n      CallInviteStateManage._invitationMap\n    );\n    let auto = false;\n    if (!CallInviteStateManage.isInviteCompleted(invitationID)) {\n      const inviteDetails = CallInviteStateManage._invitationMap.get(invitationID);\n      if (inviteDetails) {\n        const temp = Array.from(inviteDetails.invitees.values());\n        if (\n          !temp.find(\n            (inviteState) =>\n              inviteState === InviteState.accepted ||\n              inviteState === InviteState.rejected\n          )\n        ) {\n          // Scene1: When no one clicks accept or reject\n          auto = true;\n        } else if (\n          !temp.find((inviteState) => inviteState === InviteState.accepted) &&\n          temp.filter((inviteState) => inviteState === InviteState.rejected)\n            .length < temp.length\n        ) {\n          // Scene2: No one accepts, only some people refuse\n          auto = true;\n        }\n      }\n    }\n    return auto;\n  },\n  // Determine whether a call is being made\n  isOncall: (newCallID) => {\n    let localUserID = ZegoPrebuiltPlugins.getLocalUser().userID\n    zloginfo('[InviteStateManage]######isOncall######', newCallID);\n\n    // determine for onInvitationReceived\n    if (newCallID && CallInviteStateManage._inOutgoingCall) {\n      isOn = true;\n      zloginfo(`[InviteStateManage][isOncall] isOn: ${isOn}, reason: _inOutgoingCall === true`)\n      return isOn\n    }\n\n    zloginfo(`[InviteStateManage][isOncall] _invitationMap.size: ${CallInviteStateManage._invitationMap.size}, _invitationMap: ${JSON.stringify(...CallInviteStateManage._invitationMap)}`)\n    let isOn = false;\n    const callIDs = Array.from(CallInviteStateManage._invitationMap.keys());\n    for (let index = 0, len = callIDs.length; index < len; index++) {\n      const currentCallID = callIDs[index];\n      if (currentCallID !== newCallID) {\n        const stateDetails = CallInviteStateManage._invitationMap.get(currentCallID);\n        if (!stateDetails) {\n          continue\n        }\n\n        if (stateDetails.inviterID === localUserID && stateDetails.inviteState == InviteState.uncompleted) {\n          isOn = true;\n          zloginfo(`[InviteStateManage][isOncall] isOn: ${isOn}, reason: stateDetails.inviterID === localUserID, stateDetails: ${currentCallID} ${JSON.stringify(stateDetails)}`)\n          break;\n        }\n\n        const inviteState = stateDetails.invitees.get(localUserID);\n        if (\n          inviteState === InviteState.pending ||\n          inviteState === InviteState.accepted\n        ) {\n          isOn = true;\n          zloginfo(`[InviteStateManage][isOncall] isOn: ${isOn}, reason: localUserID pending or accepted, stateDetails: ${currentCallID} ${JSON.stringify(stateDetails)}`)\n          break;\n        }\n      }\n    }\n    zloginfo(`[InviteStateManage][isOncall] isOn: ${isOn}`)\n    return isOn;\n  },\n\n  onSomeoneAcceptedInvite: (callbackID, callback) => {\n    if (typeof callback !== 'function') {\n      if (CallInviteStateManage._onSomeoneAcceptedInviteMap.has(callbackID)) {\n        CallInviteStateManage._onSomeoneAcceptedInviteMap.delete(callbackID);\n      }\n    } else {\n      CallInviteStateManage._onSomeoneAcceptedInviteMap.set(\n        callbackID,\n        callback\n      );\n    }\n  },\n  onInviteCompletedWithNobody: (callbackID, callback) => {\n    if (typeof callback !== 'function') {\n      if (CallInviteStateManage._onInviteCompletedWithNobodyMap.has(callbackID)) {\n        CallInviteStateManage._onInviteCompletedWithNobodyMap.delete(\n          callbackID\n        );\n      }\n    } else {\n      CallInviteStateManage._onInviteCompletedWithNobodyMap.set(\n        callbackID,\n        callback\n      );\n    }\n  },\n};\n\nexport default CallInviteStateManage;\nconst TAG = 'invite_state_manager';"],"mappings":"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","ignoreList":[]}