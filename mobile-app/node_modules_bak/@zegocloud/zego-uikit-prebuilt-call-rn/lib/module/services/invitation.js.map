{"version":3,"names":["ZegoInvitationType","ZegoPrebuiltPlugins","ZegoUIKit","CallInviteStateManage","InnerTextHelper","zloginfo","OfflineCallEventListener","PrebuiltCallReport","ZegoUIKitPrebuiltCallInvitation","constructor","getInstance","_instance","sendCallInvitation","invitees","isVideoCall","navigation","options","resourceID","timeout","notificationTitle","notificationMessage","callID","customData","callName","showWaitingPageWhenGroupCall","localUser","getLocalUser","roomID","length","userID","Date","now","nonNullNotificationTitle","instance","getIncomingCallDialogTitle","userName","videoCall","voiceCall","nonNullNotificationMessage","getIncomingCallDialogMessage","data","JSON","stringify","call_id","call_name","map","invitee","user_id","user_name","type","inviter","id","name","custom_data","inviteeIDs","notificationConfig","title","message","Promise","resolve","reject","getSignalingPlugin","sendInvitation","then","code","errorInvitees","reportEvent","successfulInvitees","parse","forEach","errorInviteeID","index","findIndex","inviteeID","splice","onInvitationSent","catch","allInvitees","addInviteData","navigate","inviterID","invitationID","_defineProperty"],"sources":["invitation.js"],"sourcesContent":["import { ZegoInvitationType } from \"../call_invitation/services/defines\";\nimport ZegoPrebuiltPlugins from \"../call_invitation/services/plugins\";\nimport ZegoUIKit from '@zegocloud/zego-uikit-rn';\nimport CallInviteStateManage from \"../call_invitation/services/invite_state_manager\";\nimport InnerTextHelper from \"../call_invitation/services/inner_text_helper\";\nimport { zloginfo } from \"../utils/logger\";\nimport OfflineCallEventListener from \"../call_invitation/services/offline_call_event_listener\";\nimport PrebuiltCallReport from \"../utils/report\";\n\n\nexport default class ZegoUIKitPrebuiltCallInvitation {\n  static _instance;\n  constructor() { }\n  static getInstance() {\n    return this._instance || (this._instance = new ZegoUIKitPrebuiltCallInvitation());\n  }\n\n  sendCallInvitation(invitees, isVideoCall, navigation, options) {\n    const {\n      resourceID = '',\n      timeout = 60,\n      notificationTitle, \n      notificationMessage, \n      callID, \n      customData = '',\n      callName,\n      showWaitingPageWhenGroupCall = false,\n    } = options;\n\n    const localUser = ZegoPrebuiltPlugins.getLocalUser();\n    const roomID = (callID && callID.length > 0) ? callID : `call_${localUser.userID}_${Date.now()}`;\n\n    const nonNullNotificationTitle = notificationTitle ?? InnerTextHelper.instance().getIncomingCallDialogTitle(\n      localUser.userName,\n      isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall,\n      invitees.length);\n    const nonNullNotificationMessage = notificationMessage ?? InnerTextHelper.instance().getIncomingCallDialogMessage(\n      isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall,\n      invitees.length);\n\n    const data = JSON.stringify({\n      call_id: roomID,\n      call_name: callName,\n      invitees: invitees.map(invitee => {\n        return {user_id: invitee.userID, user_name: invitee.userName}\n      }),\n      type: isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall,\n      inviter: {id: localUser.userID, name: localUser.userName},\n      timeout: timeout,\n      custom_data: customData,\n      notificationTitle: nonNullNotificationTitle,\n      notificationMessage: nonNullNotificationMessage,\n    });\n    const inviteeIDs = invitees.map(invitee => {\n      return invitee.userID\n    });\n    const type = isVideoCall ? ZegoInvitationType.videoCall : ZegoInvitationType.voiceCall\n\n    // set notification config.\n    const notificationConfig = {\n      resourceID, \n      title: nonNullNotificationTitle, \n      message: nonNullNotificationMessage\n    }\n\n    return new Promise((resolve, reject) => {\n      ZegoUIKit.getSignalingPlugin().sendInvitation(inviteeIDs, timeout, type, data, notificationConfig)\n      .then(({ code, message, callID, errorInvitees }) => {\n        PrebuiltCallReport.reportEvent('call/invite', {\n          'call_id': callID,\n          'room_id': callID,\n          'source': 'sendCallInvitation'\n        })\n\n        zloginfo(\n          `[CallInvitation]Send invitation success, code: ${code}, message: ${message}, errorInvitees: ${errorInvitees}`\n          );\n        if (inviteeIDs.length > errorInvitees.length) {\n          const successfulInvitees = JSON.parse(JSON.stringify(inviteeIDs));\n          errorInvitees.forEach((errorInviteeID) => {\n            const index = successfulInvitees.findIndex(\n              (inviteeID) => errorInviteeID === inviteeID\n            );\n            index !== -1 && successfulInvitees.splice(index, 1);\n          });\n          this.onInvitationSent(navigation, callID, invitees, successfulInvitees, roomID, isVideoCall, callName, showWaitingPageWhenGroupCall);\n          resolve();\n        } else {\n          reject(-1, 'All invitees failed.');\n        }\n      })\n      .catch(({ code, message }) => {\n        reject(code, message);\n      });\n    });\n  }\n\n  onInvitationSent(navigation, callID, allInvitees, successfulInvitees, roomID, isVideoCall, callName, showWaitingPageWhenGroupCall) {\n    zloginfo(`[onInvitationSent] callID: ${callID}, roomID: ${roomID}`);\n\n    const localUser = ZegoPrebuiltPlugins.getLocalUser();\n    CallInviteStateManage.addInviteData(\n      callID,\n      localUser.userID,\n      successfulInvitees\n    );\n\n    if (allInvitees.length === 1 || showWaitingPageWhenGroupCall) {\n      // Jump to call waiting page\n      zloginfo('Jump to call waiting page.');\n      navigation.navigate('ZegoUIKitPrebuiltCallWaitingScreen', {\n        roomID,\n        isVideoCall,\n        invitees: allInvitees,\n        inviterID: localUser.userID,\n        invitationID: callID,\n        callName,\n      });\n    } else {\n      // Jump to call room page\n      zloginfo('Jump to call room page.');\n      const inviteeIDs = allInvitees.map(invitee => {\n        return invitee.userID\n      });\n\n      zloginfo('Navigate to ZegoUIKitPrebuiltCallInCallScreen')\n      navigation.navigate('ZegoUIKitPrebuiltCallInCallScreen', {\n        roomID,\n        isVideoCall,\n        invitees: inviteeIDs,\n        inviter: localUser.userID,\n        invitationID: callID,\n      });\n    }\n  }\n}"],"mappings":"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","ignoreList":[]}