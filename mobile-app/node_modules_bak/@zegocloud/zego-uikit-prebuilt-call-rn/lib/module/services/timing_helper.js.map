{"version":3,"names":["Platform","zloginfo","TimingHelper","constructor","_duration","_durationStart","Date","now","_onDurationUpdateCallbackMap","_timer","getInstance","_instance","startTimer","setInterval","_increaseDuration","stopTimer","clearInterval","resetDuration","OS","realDuration","Math","floor","duration","notifyDurationUpdate","getDuration","onDurationUpdate","callbackID","callback","Object","keys","forEach","_defineProperty"],"sources":["timing_helper.js"],"sourcesContent":["import { Platform } from 'react-native';\nimport { zloginfo } from '../utils/logger';\n\nexport default class TimingHelper {\n    static _instance;\n    \n    constructor() { \n        this._duration = 0;\n        this._durationStart = Date.now();\n        this._onDurationUpdateCallbackMap = {};\n        this._timer = null;\n    }\n    \n    static getInstance() {\n        if (TimingHelper._instance) {\n            return TimingHelper._instance;\n        }\n        TimingHelper._instance = new TimingHelper();\n        return TimingHelper._instance;\n    }\n\n    startTimer() {\n        zloginfo('[TimingHelper][startTimer]')\n        if (!this._timer) {\n            this._durationStart = Date.now();\n            this._duration = 0;\n            this._timer = setInterval(() => {\n                this._increaseDuration();\n            }, 1000);\n        }\n    }\n\n    stopTimer() {\n        zloginfo('[TimingHelper][stopTimer]')\n        if (this._timer) {\n            clearInterval(this._timer);\n            this._timer = null;\n            this._durationStart = Date.now();\n            this._duration = 0;\n        }\n    }\n\n    resetDuration() {\n        zloginfo('[TimingHelper][resetDuration]')\n        this.stopTimer()\n\n        this._duration = 0;\n        this._durationStart = Date.now();\n    }\n\n    _increaseDuration() {\n        if (Platform.OS === 'android') {\n            // The timing depends on the hardware, and on machines with poor performance, the timing may be slower than the actual\n            const realDuration = Math.floor((Date.now() - this._durationStart) / 1000)\n            const duration = this._duration + 1\n            if (realDuration >= duration + 1) {\n                this._duration = realDuration;\n            } else {\n                this._duration = duration;\n            }\n        } else {\n            this._duration = Math.floor((Date.now() - this._durationStart) / 1000)\n        }\n\n        this.notifyDurationUpdate(this._duration)\n    }\n\n    getDuration() {\n        const realDuration = Math.floor((Date.now() - this._durationStart) / 1000)\n        if (realDuration - this._duration > 2) {\n            return realDuration;\n        }\n        return this._duration;\n    }\n\n    onDurationUpdate(callbackID, callback) {\n        if (typeof callback !== 'function') {\n            delete this._onDurationUpdateCallbackMap[callbackID];\n        } else {\n            this._onDurationUpdateCallbackMap[callbackID] = callback;\n        }\n    }\n\n    async notifyDurationUpdate(duration) {\n        Object.keys(this._onDurationUpdateCallbackMap).forEach((callbackID) => {\n            if (this._onDurationUpdateCallbackMap[callbackID]) {\n                this._onDurationUpdateCallbackMap[callbackID](duration);\n            }\n        });\n    }\n}"],"mappings":"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","ignoreList":[]}