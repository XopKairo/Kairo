"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.logComponentsVersion = exports.getRnVersion = void 0;
var _reactNative = require("react-native");
var _ReactNativeVersion = require("react-native/Libraries/Core/ReactNativeVersion");
var _ZegoUIKitCorePlugin = _interopRequireDefault(require("../components/internal/ZegoUIKitCorePlugin"));
var _logger = require("./logger");
var _package_version = require("./package_version");
var _report = _interopRequireDefault(require("./report"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
// @ts-ignore

const {
  ZegoUIKitRNModule
} = _reactNative.NativeModules;
const logComponentsVersion = extraInfo => {
  var expressVersionPromise = require('zego-express-engine-reactnative').default.getVersion();
  var zimVersionPromise = _ZegoUIKitCorePlugin.default.getZIMPlugin() ? _ZegoUIKitCorePlugin.default.getZIMPlugin().default.getVersion() : _getCustomVersionPromise("Not installed");
  var zpnsVersionPromise = _ZegoUIKitCorePlugin.default.getZPNsPlugin() ? _ZegoUIKitCorePlugin.default.getZPNsPlugin().default.getVersion() : _getCustomVersionPromise("Not installed");
  var callkitVersionPromise = _getCustomVersionPromise('Not necessary');
  if (_reactNative.Platform.OS === 'ios') {
    callkitVersionPromise = _ZegoUIKitCorePlugin.default.getCallKitPlugin() ? _getCustomVersionPromise("Unknown version") : _getCustomVersionPromise("Not installed");
  }
  var iosBackgroundModesPromise = ZegoUIKitRNModule.getBackgroundModes();
  var reportVersionPromise = _report.default.getVersion();
  Promise.all([expressVersionPromise, zimVersionPromise, zpnsVersionPromise, callkitVersionPromise, iosBackgroundModesPromise, reportVersionPromise]).then(versions => {
    let versionTable = new Map(Object.entries({
      'OS': `${_reactNative.Platform.OS} ${_reactNative.Platform.Version ?? ''}`,
      'RN': getRnVersion(),
      'Express': versions[0],
      'ZIM': versions[1],
      'ZPNs': versions[2],
      'CallKit(iOS)': versions[3],
      'BackgroundModes(iOS)': versions[4],
      'ZegoUIKit': (0, _package_version.getPackageVersion)(),
      'Report': versions[5]
    }));
    extraInfo.forEach((version, component) => {
      versionTable.set(component, version);
    });
    (0, _logger.zloginfo)('Components version: ');
    versionTable.forEach((version, component) => {
      (0, _logger.zloginfo)(`  ${component} => ${version}`);
    });
  });
};
exports.logComponentsVersion = logComponentsVersion;
const getRnVersion = () => {
  const displayVersion = [_ReactNativeVersion.version.major, _ReactNativeVersion.version.minor, _ReactNativeVersion.version.patch].join('.') + (_ReactNativeVersion.version.prerelease != null ? '-' + _ReactNativeVersion.version.prerelease : '');
  return displayVersion;
};
exports.getRnVersion = getRnVersion;
const _getCustomVersionPromise = verDesc => {
  return new Promise(resolve => {
    resolve(verDesc);
  });
};
//# sourceMappingURL=version.js.map