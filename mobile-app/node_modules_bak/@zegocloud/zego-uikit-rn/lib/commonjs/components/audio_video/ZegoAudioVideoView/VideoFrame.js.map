{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_zegoExpressEngineReactnative","_ZegoUIKitInternal","_interopRequireDefault","_logger","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","VideoFrame","props","userID","roomID","fillMode","isPictureInPicture","isScreenShare","textureViewRef","useRef","textureViewID","updateRenderingProperty","zloginfo","appOrientation","ZegoUIKitInternal","user","getUser","newFillMode","Number","isLandscape","undefined","onTextureLayout","useCallback","event","width","height","nativeEvent","layout","ZegoExpressEngine","instance","error","useEffect","callbackID","String","Math","floor","random","findNodeHandle","current","onSDKConnected","onUserJoin","userInfoList","forEach","onVideoViewForceRender","createElement","View","style","styles","container","ZegoTextureView","videoContainer","ref","collapsable","onLayout","audioContainer","children","StyleSheet","create","flex","position","top","left","zIndex"],"sources":["VideoFrame.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useRef } from \"react\";\nimport { findNodeHandle, LayoutChangeEvent, View, StyleSheet } from \"react-native\";\nimport ZegoExpressEngine, { ZegoTextureView } from 'zego-express-engine-reactnative';\nimport ZegoUIKitInternal from \"../../internal/ZegoUIKitInternal\";\nimport { zloginfo } from \"../../../utils/logger\";\n\nexport default function VideoFrame(props: any) {\n    const { userID, roomID, fillMode, isPictureInPicture, isScreenShare } = props;\n    const textureViewRef = useRef(null);\n    let textureViewID = -1;\n\n    const updateRenderingProperty = () => {\n        zloginfo(`[VideoFrame][updateRenderingProperty] isPictureInPicture: ${isPictureInPicture}`);\n        const appOrientation = ZegoUIKitInternal.appOrientation();\n        const user = ZegoUIKitInternal.getUser(userID);\n        var newFillMode = fillMode;\n        if (isPictureInPicture && user) {\n          newFillMode = appOrientation === 0 ? Number(!user.isLandscape) : Number(user.isLandscape);\n        }\n        ZegoUIKitInternal.updateRenderingProperty(userID, textureViewID, undefined, newFillMode, isScreenShare);\n    }\n\n    const onTextureLayout = useCallback((event: LayoutChangeEvent) => {\n        const { width, height } = event.nativeEvent.layout;\n        zloginfo(`[VideoFrame][onTextureLayout] userID: ${userID}, textureViewID: ${textureViewID}, width: ${width}, height: ${height}`)\n\n        if (width > 0 || height > 0) {\n            try {\n                ZegoExpressEngine.instance\n                updateRenderingProperty();\n            } catch (error) {\n            }\n        } else {\n            // for FloatingMinimizedView\n            ZegoUIKitInternal.updateRenderingProperty(userID, -1, textureViewID, fillMode, isScreenShare);\n        }\n    }, []);\n\n    useEffect(() => {\n        const callbackID = 'VideoFrame' + userID + String(Math.floor(Math.random() * 10000));\n        textureViewID = findNodeHandle(textureViewRef.current)\n        zloginfo(`[VideoFrame] useEffect, userID: ${userID}, viewID: ${textureViewID}, callbackID: ${callbackID}`)\n\n        ZegoUIKitInternal.onSDKConnected(callbackID, () => {\n            updateRenderingProperty();\n        });\n        ZegoUIKitInternal.onUserJoin(callbackID, (userInfoList: any[]) => {\n            userInfoList.forEach(user => {\n                if (user.userID == userID) {\n                    updateRenderingProperty()\n                }\n            })\n        });\n        ZegoUIKitInternal.onVideoViewForceRender(callbackID, () => {\n            updateRenderingProperty();\n        });\n        return () => {\n            zloginfo(`[VideoFrame] useEffect return, viewID: ${textureViewID}`)\n\n            ZegoUIKitInternal.onSDKConnected(callbackID);\n            ZegoUIKitInternal.onUserJoin(callbackID);\n            ZegoUIKitInternal.onVideoViewForceRender(callbackID);\n            // for normal view\n            ZegoUIKitInternal.updateRenderingProperty(userID, -1, textureViewID, fillMode, isScreenShare);\n        }\n    }, []);\n\n    return (\n        <View style={styles.container}>\n            <ZegoTextureView\n                // @ts-ignore\n                style={styles.videoContainer}\n                ref={textureViewRef}\n                collapsable={false}\n                onLayout={onTextureLayout}\n            />\n            <View style={styles.audioContainer}>\n                {props.children}\n            </View>\n        </View>\n    );\n}\n\n\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n        width: '100%',\n        height: '100%',\n        position: 'absolute',\n    },\n    videoContainer: {\n        // flex: 1,\n        width: '100%',\n        height: '100%',\n        top: 0,\n        left: 0,\n        position: 'absolute',\n        zIndex: 1,\n    },\n    audioContainer: {\n        width: '100%',\n        height: '100%',\n        top: 0,\n        left: 0,\n        position: 'absolute',\n        zIndex: 2,\n    }\n});"],"mappings":"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","ignoreList":[]}