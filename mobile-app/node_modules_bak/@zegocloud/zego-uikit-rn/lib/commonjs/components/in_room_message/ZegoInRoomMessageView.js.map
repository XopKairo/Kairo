{"version":3,"names":["_react","_interopRequireWildcard","require","_reactNative","_reactDelegateComponent","_interopRequireDefault","_ZegoUIKitInternal","e","__esModule","default","_getRequireWildcardCache","WeakMap","r","t","has","get","n","__proto__","a","Object","defineProperty","getOwnPropertyDescriptor","u","hasOwnProperty","call","i","set","ZegoInRoomMessageView","props","itemBuilder","systemMessageList","listRef","useRef","messageList","setMessageList","useState","systemMessageListRef","refreshMessage","roomMessages","ZegoUIKitInternal","getInRoomMessages","length","latestSystemMessageList","current","allMessages","sort","b","sendTime","arr","renderItem","item","_item$sender","type","createElement","View","style","styles","messageContainer","Text","systemMessageLabel","message","senderNameLabel","sender","userName","messageLabel","to","useEffect","callbackID","String","Math","floor","random","onInRoomMessageReceived","onInRoomMessageSent","FlatList","showsVerticalScrollIndicator","ref","data","onContentSizeChange","scrollToEnd","StyleSheet","create","alignSelf","backgroundColor","borderRadius","flexDirection","justifyContent","alignItems","marginTop","paddingTop","paddingBottom","paddingRight","paddingLeft","color","fontSize","marginLeft","textAlign","fontStyle"],"sources":["ZegoInRoomMessageView.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { FlatList, StyleSheet, Text, View } from 'react-native';\nimport Delegate from 'react-delegate-component';\nimport ZegoUIKitInternal from '../internal/ZegoUIKitInternal';\n\nexport default function ZegoInRoomMessageView(props: any) {\n  const { itemBuilder, systemMessageList } = props;\n  const listRef = useRef(null);\n  const [messageList, setMessageList] = useState([]);\n  const systemMessageListRef = useRef(systemMessageList);\n\n  const refreshMessage = () => {\n    const roomMessages = ZegoUIKitInternal.getInRoomMessages();\n    if (systemMessageList && systemMessageList.length) {\n      const latestSystemMessageList = systemMessageListRef.current;\n      const allMessages = [...roomMessages, ...latestSystemMessageList];\n      allMessages.sort((a, b) => a.sendTime - b.sendTime);\n      setMessageList(allMessages);\n    } else {\n      setMessageList((arr) => [...ZegoUIKitInternal.getInRoomMessages()]);\n    }\n  };\n\n  const renderItem = ({ item }: any) => {\n    let type = item.type || 'user';\n    return (\n      !itemBuilder ? <View style={styles.messageContainer}>\n        {type === 'system' ? (\n            <Text style={[styles.systemMessageLabel]}>\n              {item.message}\n            </Text>\n          ) : (\n            <Text style={styles.senderNameLabel}>\n              {item.sender?.userName || 'Unknown User'}\n              <Text style={styles.messageLabel}> {item.message}</Text>\n            </Text>\n        )}\n      </View> : <Delegate to={itemBuilder} props={{ message: item }} />\n    );\n  }\n\n  useEffect(() => {\n    refreshMessage();\n  }, []);\n\n  useEffect(() => {\n    systemMessageListRef.current = systemMessageList;\n    refreshMessage();\n  }, [systemMessageList]);\n\n  useEffect(() => {\n    const callbackID = 'ZegoInRoomMessageView' + String(Math.floor(Math.random() * 10000));\n    ZegoUIKitInternal.onInRoomMessageReceived(callbackID, () => {\n      refreshMessage();\n    });\n    ZegoUIKitInternal.onInRoomMessageSent(callbackID, () => {\n      refreshMessage();\n    });\n\n    return () => {\n      ZegoUIKitInternal.onInRoomMessageReceived(callbackID);\n      ZegoUIKitInternal.onInRoomMessageSent(callbackID);\n    };\n  }, []);\n\n  return (\n    <FlatList\n      showsVerticalScrollIndicator={false}\n      ref={listRef}\n      data={messageList}\n      // https://stackoverflow.com/questions/46304677/scrolltoend-after-update-data-for-flatlist\n      onContentSizeChange={() => {\n        if (messageList.length) {\n          listRef.current.scrollToEnd();\n        }\n      }}\n      renderItem={renderItem}\n    />\n  );\n}\n\nconst styles = StyleSheet.create({\n  messageContainer: {\n    alignSelf: 'flex-start',\n    backgroundColor: 'rgba(1, 7, 18, 0.3000)',\n    borderRadius: 13,\n    flexDirection: 'row',\n    justifyContent: 'flex-start',\n    alignItems: 'center',\n    marginTop: 4,\n    paddingTop: 5,\n    paddingBottom: 5,\n    paddingRight: 10,\n    paddingLeft: 10,\n  },\n  senderNameLabel: {\n    color: '#8BE7FF',\n    fontSize: 13,\n  },\n  messageLabel: {\n    color: 'white',\n    fontSize: 13,\n    marginLeft: 5,\n  },\n  systemMessageLabel: {\n    color: '#FFD700',\n    textAlign: 'center',\n    fontStyle: 'italic',\n  },\n});\n"],"mappings":"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","ignoreList":[]}