{"version":3,"names":["zlogerror","zloginfo","ZegoPluginResult","ZegoPluginUserInRoomAttributesCore","ZegoUIKitCorePlugin","ZegoPluginRoomPropertiesCore","constructor","_defineProperty","shared","getInstance","_registerEngineCallback","getZIMPlugin","default","on","zim","roomID","infos","forEach","info","_notifyRoomPropertiesUpdated","_unregisterEngineCallback","off","notifyData","Object","keys","_onRoomPropertyUpdatedCallbackMap","callbackID","updateRoomProperty","attributes","config","Promise","reject","getRoomBaseInfo","resolve","setRoomAttributes","then","resRoomID","errorKeys","catch","error","code","message","deleteRoomProperties","deleteRoomAttributes","beginRoomPropertiesBatchOperation","beginRoomAttributesBatchOperation","endRoomPropertiesBatchOperation","endRoomAttributesBatchOperation","queryRoomProperties","queryRoomAllAttributes","roomAttributes","onRoomPropertyUpdated","callback","_ZegoPluginRoomPropertiesCore"],"sources":["room_properties_core.ts"],"sourcesContent":["import type {\n  ZIMRoomAttributesBatchOperationConfig,\n  ZIMRoomAttributesDeleteConfig,\n  ZIMRoomAttributesSetConfig,\n  ZIMRoomAttributesUpdateInfo,\n  ZIMEventOfRoomAttributesUpdatedResult,\n  ZIMRoomAttributesOperatedResult,\n  ZIMRoomAttributesBatchOperatedResult,\n  ZIMRoomAttributesQueriedResult,\n  ZIMError,\n} from 'zego-zim-react-native';\nimport { zlogerror, zloginfo } from '../utils/logger';\nimport ZegoPluginResult from './defines';\nimport ZegoPluginUserInRoomAttributesCore from './user_in_room_attributes_core';\nimport ZegoUIKitCorePlugin from \"../../components/internal/ZegoUIKitCorePlugin\";\n\nexport default class ZegoPluginRoomPropertiesCore {\n  static shared: ZegoPluginRoomPropertiesCore;\n  _onRoomPropertyUpdatedCallbackMap: { [index: string]: (notifyData: ZIMRoomAttributesUpdateInfo) => void } = {};\n\n  constructor() {\n    if (!ZegoPluginRoomPropertiesCore.shared) {\n      ZegoPluginRoomPropertiesCore.shared = this;\n    }\n    return ZegoPluginRoomPropertiesCore.shared;\n  }\n  static getInstance() {\n    if (!ZegoPluginRoomPropertiesCore.shared) {\n      ZegoPluginRoomPropertiesCore.shared = new ZegoPluginRoomPropertiesCore();\n    }\n    return ZegoPluginRoomPropertiesCore.shared;\n  }\n  // ------- internal events register ------\n  _registerEngineCallback() {\n    ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance().on('roomAttributesUpdated', (zim: any, { roomID, infos }: ZIMEventOfRoomAttributesUpdatedResult) => {\n      zloginfo(\n        `[ZegoPluginRoomPropertiesCore]NotifyRoomPropertiesUpdated`,\n        infos\n      );\n      infos.forEach((info) => {\n        this._notifyRoomPropertiesUpdated(info);\n      });\n    });\n    ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance().on(\n      'roomAttributesBatchUpdated',\n      (zim: any, { roomID, infos }: ZIMEventOfRoomAttributesUpdatedResult) => {\n        zloginfo(\n          `[ZegoPluginRoomPropertiesCore]NotifyRoomPropertiesUpdated`,\n          infos\n        );\n        infos.forEach((info) => {\n          this._notifyRoomPropertiesUpdated(info);\n        });\n      }\n    );\n\n    zloginfo('[ZegoPluginRoomPropertiesCore]Register callback for ZIM...');\n  }\n  _unregisterEngineCallback() {\n    zloginfo('[ZegoPluginRoomPropertiesCore]Unregister callback from ZIM...');\n    ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance().off('roomAttributesUpdated');\n    ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance().off('roomAttributesBatchUpdated');\n  }\n  // ------- internal events exec ------\n  _notifyRoomPropertiesUpdated(notifyData: ZIMRoomAttributesUpdateInfo) {\n    Object.keys(this._onRoomPropertyUpdatedCallbackMap).forEach(\n      (callbackID) => {\n        if (this._onRoomPropertyUpdatedCallbackMap[callbackID]) {\n          this._onRoomPropertyUpdatedCallbackMap[callbackID](notifyData);\n        }\n      }\n    );\n  }\n\n  // ------- external method ------\n  updateRoomProperty(attributes: Record<string, string>, config: ZIMRoomAttributesSetConfig) {\n    if (!ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance()) {\n      zlogerror('[ZegoPluginRoomPropertiesCore]Please initialize it first.');\n      return Promise.reject();\n    }\n    const roomID =\n      ZegoPluginUserInRoomAttributesCore.getInstance().getRoomBaseInfo().roomID;\n    return new Promise((resolve, reject) => {\n      ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance()\n        .setRoomAttributes(attributes, roomID, config)\n        .then(({ roomID: resRoomID, errorKeys }: ZIMRoomAttributesOperatedResult) => {\n          zloginfo(\n            `[ZegoPluginRoomPropertiesCore]Update the room properties successfully.`\n          );\n          resolve({ ...new ZegoPluginResult('', ''), errorKeys });\n        })\n        .catch((error: ZIMError) => {\n          zlogerror(\n            `[ZegoPluginRoomPropertiesCore]Failed to update room properties, code: ${error.code}, message: ${error.message}`\n          );\n          reject(error);\n        });\n    });\n  }\n  deleteRoomProperties(keys: string[], config: ZIMRoomAttributesDeleteConfig) {\n    if (!ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance()) {\n      zlogerror('[ZegoPluginRoomPropertiesCore]Please initialize it first.');\n      return Promise.reject();\n    }\n    const roomID =\n      ZegoPluginUserInRoomAttributesCore.getInstance().getRoomBaseInfo().roomID;\n    return new Promise((resolve, reject) => {\n      ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance()\n        .deleteRoomAttributes(keys, roomID, config)\n        .then(({ roomID: resRoomID, errorKeys }: ZIMRoomAttributesOperatedResult) => {\n          zloginfo(\n            `[ZegoPluginRoomPropertiesCore]Delete the room properties successfully.`\n          );\n          resolve({ ...new ZegoPluginResult('', ''), errorKeys });\n        })\n        .catch((error: ZIMError) => {\n          zlogerror(\n            `[ZegoPluginRoomPropertiesCore]Failed to delete room properties, code: ${error.code}, message: ${error.message}`\n          );\n          reject(error);\n        });\n    });\n  }\n  beginRoomPropertiesBatchOperation(config: ZIMRoomAttributesBatchOperationConfig) {\n    if (!ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance()) {\n      zlogerror('[ZegoPluginRoomPropertiesCore]Please initialize it first.');\n      return Promise.reject();\n    }\n    const roomID =\n      ZegoPluginUserInRoomAttributesCore.getInstance().getRoomBaseInfo().roomID;\n    ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance().beginRoomAttributesBatchOperation(roomID, config);\n    zloginfo(\n      `[ZegoPluginRoomPropertiesCore]Begin batch operate room properties successfully.`\n    );\n  }\n  endRoomPropertiesBatchOperation() {\n    if (!ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance()) {\n      zlogerror('[ZegoPluginRoomPropertiesCore]Please initialize it first.');\n      return Promise.reject();\n    }\n    const roomID =\n      ZegoPluginUserInRoomAttributesCore.getInstance().getRoomBaseInfo().roomID;\n    return new Promise((resolve, reject) => {\n      ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance()\n        .endRoomAttributesBatchOperation(roomID)\n        .then(({ roomID: resRoomID }: ZIMRoomAttributesBatchOperatedResult) => {\n          zloginfo(\n            `[ZegoPluginRoomPropertiesCore]End batch operate room properties successfully.`\n          );\n          resolve(new ZegoPluginResult('', ''));\n        })\n        .catch((error: ZIMError) => {\n          zlogerror(\n            `[ZegoPluginRoomPropertiesCore]Failed to end batch operate room properties, code: ${error.code}, message: ${error.message}`\n          );\n          reject(error);\n        });\n    });\n  }\n  queryRoomProperties() {\n    if (!ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance()) {\n      zlogerror('[ZegoPluginRoomPropertiesCore]Please initialize it first.');\n      return Promise.reject();\n    }\n    const roomID =\n      ZegoPluginUserInRoomAttributesCore.getInstance().getRoomBaseInfo().roomID;\n    return new Promise((resolve, reject) => {\n      ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance()\n        .queryRoomAllAttributes(roomID)\n        .then(({ roomID: resRoomID, roomAttributes }: ZIMRoomAttributesQueriedResult) => {\n          zloginfo(\n            `[ZegoPluginRoomPropertiesCore]Query room all attributes successfully.`\n          );\n          resolve({ roomAttributes, ...new ZegoPluginResult('', '') });\n        })\n        .catch((error: ZIMError) => {\n          zlogerror(\n            `[ZegoPluginRoomPropertiesCore]Failed to query room all properties, code: ${error.code}, message: ${error.message}`\n          );\n          reject(error);\n        });\n    });\n  }\n  onRoomPropertyUpdated(callbackID: string, callback: (notifyData: ZIMRoomAttributesUpdateInfo) => void) {\n    if (!ZegoUIKitCorePlugin.getZIMPlugin().default.getInstance()) {\n      zlogerror('[ZegoPluginRoomPropertiesCore]Please initialize it first.');\n    }\n    if (typeof callback !== 'function') {\n      if (callbackID in this._onRoomPropertyUpdatedCallbackMap) {\n        zloginfo(\n          '[Core][onRoomPropertyUpdated] Remove callback for: [',\n          callbackID,\n          '] because callback is not a valid function!'\n        );\n        delete this._onRoomPropertyUpdatedCallbackMap[callbackID];\n      }\n    } else {\n      this._onRoomPropertyUpdatedCallbackMap[callbackID] = callback;\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}