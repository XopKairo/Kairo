{"version":3,"names":["React","useEffect","useRef","useState","FlatList","StyleSheet","Text","View","Delegate","ZegoUIKitInternal","ZegoInRoomMessageView","props","itemBuilder","systemMessageList","listRef","messageList","setMessageList","systemMessageListRef","refreshMessage","roomMessages","getInRoomMessages","length","latestSystemMessageList","current","allMessages","sort","a","b","sendTime","arr","renderItem","item","_item$sender","type","createElement","style","styles","messageContainer","systemMessageLabel","message","senderNameLabel","sender","userName","messageLabel","to","callbackID","String","Math","floor","random","onInRoomMessageReceived","onInRoomMessageSent","showsVerticalScrollIndicator","ref","data","onContentSizeChange","scrollToEnd","create","alignSelf","backgroundColor","borderRadius","flexDirection","justifyContent","alignItems","marginTop","paddingTop","paddingBottom","paddingRight","paddingLeft","color","fontSize","marginLeft","textAlign","fontStyle"],"sources":["ZegoInRoomMessageView.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { FlatList, StyleSheet, Text, View } from 'react-native';\nimport Delegate from 'react-delegate-component';\nimport ZegoUIKitInternal from '../internal/ZegoUIKitInternal';\n\nexport default function ZegoInRoomMessageView(props: any) {\n  const { itemBuilder, systemMessageList } = props;\n  const listRef = useRef(null);\n  const [messageList, setMessageList] = useState([]);\n  const systemMessageListRef = useRef(systemMessageList);\n\n  const refreshMessage = () => {\n    const roomMessages = ZegoUIKitInternal.getInRoomMessages();\n    if (systemMessageList && systemMessageList.length) {\n      const latestSystemMessageList = systemMessageListRef.current;\n      const allMessages = [...roomMessages, ...latestSystemMessageList];\n      allMessages.sort((a, b) => a.sendTime - b.sendTime);\n      setMessageList(allMessages);\n    } else {\n      setMessageList((arr) => [...ZegoUIKitInternal.getInRoomMessages()]);\n    }\n  };\n\n  const renderItem = ({ item }: any) => {\n    let type = item.type || 'user';\n    return (\n      !itemBuilder ? <View style={styles.messageContainer}>\n        {type === 'system' ? (\n            <Text style={[styles.systemMessageLabel]}>\n              {item.message}\n            </Text>\n          ) : (\n            <Text style={styles.senderNameLabel}>\n              {item.sender?.userName || 'Unknown User'}\n              <Text style={styles.messageLabel}> {item.message}</Text>\n            </Text>\n        )}\n      </View> : <Delegate to={itemBuilder} props={{ message: item }} />\n    );\n  }\n\n  useEffect(() => {\n    refreshMessage();\n  }, []);\n\n  useEffect(() => {\n    systemMessageListRef.current = systemMessageList;\n    refreshMessage();\n  }, [systemMessageList]);\n\n  useEffect(() => {\n    const callbackID = 'ZegoInRoomMessageView' + String(Math.floor(Math.random() * 10000));\n    ZegoUIKitInternal.onInRoomMessageReceived(callbackID, () => {\n      refreshMessage();\n    });\n    ZegoUIKitInternal.onInRoomMessageSent(callbackID, () => {\n      refreshMessage();\n    });\n\n    return () => {\n      ZegoUIKitInternal.onInRoomMessageReceived(callbackID);\n      ZegoUIKitInternal.onInRoomMessageSent(callbackID);\n    };\n  }, []);\n\n  return (\n    <FlatList\n      showsVerticalScrollIndicator={false}\n      ref={listRef}\n      data={messageList}\n      // https://stackoverflow.com/questions/46304677/scrolltoend-after-update-data-for-flatlist\n      onContentSizeChange={() => {\n        if (messageList.length) {\n          listRef.current.scrollToEnd();\n        }\n      }}\n      renderItem={renderItem}\n    />\n  );\n}\n\nconst styles = StyleSheet.create({\n  messageContainer: {\n    alignSelf: 'flex-start',\n    backgroundColor: 'rgba(1, 7, 18, 0.3000)',\n    borderRadius: 13,\n    flexDirection: 'row',\n    justifyContent: 'flex-start',\n    alignItems: 'center',\n    marginTop: 4,\n    paddingTop: 5,\n    paddingBottom: 5,\n    paddingRight: 10,\n    paddingLeft: 10,\n  },\n  senderNameLabel: {\n    color: '#8BE7FF',\n    fontSize: 13,\n  },\n  messageLabel: {\n    color: 'white',\n    fontSize: 13,\n    marginLeft: 5,\n  },\n  systemMessageLabel: {\n    color: '#FFD700',\n    textAlign: 'center',\n    fontStyle: 'italic',\n  },\n});\n"],"mappings":"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","ignoreList":[]}