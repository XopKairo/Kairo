{"version":3,"names":["Platform","zloginfo","zlogerror","zlogwarning","ZegoUIKitPluginType","_plugins","Map","ZegoUIKitCorePlugin","installPlugins","plugins","Array","forEach","plugin","index","ZIMConnectionState","get","set","ZPNsPushSourceType","OS","callKitPlugin","require","error","getInstance","type","getPluginType","Object","values","includes","getZIMPlugin","getZPNsPlugin","getCallKitPlugin","getPlugin","signaling","getPluginName","name"],"sources":["ZegoUIKitCorePlugin.ts"],"sourcesContent":["import { Platform } from 'react-native';\nimport { zloginfo, zlogerror, zlogwarning } from '../../utils/logger';\nimport { ZegoUIKitPluginType } from './defines';\n\nconst _plugins = new Map(); // type -> plugin\nconst ZegoUIKitCorePlugin = {\n  installPlugins: (plugins: any[]) => {\n    zloginfo(`[ZegoUIKitCorePlugin] installPlugins, plugins: ${plugins}`)\n\n    if (!plugins || !(plugins instanceof Array)) {\n      zlogerror('[ZegoUIKitCorePlugin][installPlugins]The parameter passed in was incorrect');\n      return;\n    }\n    plugins.forEach((plugin, index) => {\n      if (plugin.ZIMConnectionState) {\n        if (_plugins.get('ZIM')) {\n          zloginfo(\n            '[ZegoUIKitCorePlugin][installPlugins]Plugin already exists, this install does not take effect, plugin: ZIM'\n          );\n        } else {\n          _plugins.set('ZIM', plugin);\n          zloginfo(`[ZegoUIKitCorePlugin][installPlugins]Plugin install success, plugin: ZIM, index: ${index}`);\n        }\n      } else if (plugin.ZPNsPushSourceType) {\n        if (_plugins.get('ZPNs')) {\n          zloginfo(\n            '[ZegoUIKitCorePlugin][installPlugins]Plugin already exists, this install does not take effect, plugin: ZPNs'\n          );\n        } else {\n          _plugins.set('ZPNs', plugin);\n          zloginfo(`[ZegoUIKitCorePlugin][installPlugins]Plugin install success, plugin: ZPNs, index: ${index}`);\n\n          if (!(_plugins.get('CallKit')) && Platform.OS === 'ios') {\n            try {\n              let callKitPlugin = require('zego-callkit-react-native');\n              _plugins.set('CallKit', callKitPlugin);\n              zloginfo(`[ZegoUIKitCorePlugin][installPlugins] Plugin install success, plugin: CallKit, index: ${index}`);\n            } catch(error) {\n              zlogwarning(`[ZegoUIKitCorePlugin][installPlugins] Cannot resolve module zego-callkit-react-native`);\n            }\n          }\n        }\n      } else if (typeof plugin.getInstance === 'function') {\n        // Compatible with the original usage\n        const type = plugin.getInstance().getPluginType\n          ? plugin.getInstance().getPluginType()\n          : null;\n        if (Object.values(ZegoUIKitPluginType).includes(type)) {\n          if (_plugins.get(type)) {\n            zloginfo(\n              '[ZegoUIKitCorePlugin][installPlugins]Plugin already exists, this install does not take effect, plugins: ', type\n            );\n          } else {\n            _plugins.set(type, plugin);\n            zloginfo('[ZegoUIKitCorePlugin][installPlugins]Plugin install success, plugin: ', type);\n          }\n        }\n      }\n    });\n  },\n  getZIMPlugin: () => {\n    return _plugins.get('ZIM');\n  },\n  getZPNsPlugin: () => {\n    return _plugins.get('ZPNs');\n  },\n  getCallKitPlugin: () => {\n    return _plugins.get('CallKit');\n  },\n  getPlugin: (type: number) => {\n    if (type === ZegoUIKitPluginType.signaling) {\n      zloginfo('[ZegoUIKitCorePlugin][getPlugin] type:', type);\n      return _plugins.get(type) || ZegoUIKitCorePlugin.getZIMPlugin();\n    }\n    return _plugins.get(type);\n  },\n  getPluginName: (name: string) => {\n    return _plugins.get(name);\n  }\n};\nexport default ZegoUIKitCorePlugin;\nexport { ZegoUIKitPluginType };\n"],"mappings":"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","ignoreList":[]}