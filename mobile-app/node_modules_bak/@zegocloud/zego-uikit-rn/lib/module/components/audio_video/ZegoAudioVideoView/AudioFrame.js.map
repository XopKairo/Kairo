{"version":3,"names":["View","StyleSheet","Text","ImageBackground","Image","React","useState","useEffect","ZegoUIKitInternal","Delegate","zloginfo","defaultAvatarSizeRatio","flexStyle","AudioFrame","props","userInfo","showSoundWave","audioViewBackgroudColor","audioViewBackgroudImage","avatarBackgroundColor","avatarSize","avatarAlignment","avatarBuilder","soundWaveColor","avatar","soundLevel","setSoundLevel","dimensions","setDimensions","width","height","isLoadError","setIsLoadError","getShortName","name","nl","split","shotName","forEach","part","substring","callbackID","userID","String","Math","floor","random","onSoundLevelUpdate","createElement","style","cstyle","container","onLayout","event","nativeEvent","layout","source","uri","require","resizeMode","styles","imgBackground","justifyContent","waveStyle","circleWave","subCircleWave","backgroundColor","nameLabel","userName","onLoadStart","onLoadEnd","onError","onLoad","alignItems","to","bgColor","create","flex","position","w","color","opacity","alignSelf","aspectRatio","borderRadius","zIndex","alignContent","marginTop","marginBottom","toString","overflow","fontSize"],"sources":["AudioFrame.tsx"],"sourcesContent":["import { View, StyleSheet, Text, ImageBackground, Image } from 'react-native';\nimport React, { useState, useEffect } from 'react';\nimport ZegoUIKitInternal from '../../internal/ZegoUIKitInternal';\nimport Delegate from 'react-delegate-component';\nimport { zloginfo } from '../../../utils/logger';\n\nconst defaultAvatarSizeRatio = 129 / 375;\nconst flexStyle = ['center', 'flex-start', 'flex-end'];\n\nexport default function AudioFrame(props: any) {\n  const {\n    userInfo,\n    showSoundWave,\n    audioViewBackgroudColor,\n    audioViewBackgroudImage,\n    avatarBackgroundColor = '#DBDDE3',\n    avatarSize,\n    avatarAlignment,\n    avatarBuilder,\n    soundWaveColor = '#6B6A71',\n    avatar = '',\n  } = props;\n\n  const [soundLevel, setSoundLevel] = useState(0);\n  const [dimensions, setDimensions] = useState({ width: 0, height: 0 });\n  const [isLoadError, setIsLoadError] = useState(false);\n\n  const getShortName = (name: string) => {\n    if (!name) {\n      return '';\n    }\n    const nl = name.split(' ');\n    var shotName = '';\n    nl.forEach((part) => {\n      if (part !== '') {\n        shotName += part.substring(0, 1);\n      }\n    });\n    return shotName;\n  };\n\n  useEffect(() => {\n    const callbackID = 'AudioFrame' + userInfo.userID + String(Math.floor(Math.random() * 10000));\n    ZegoUIKitInternal.onSoundLevelUpdate(\n      callbackID,\n      (userID: string, soundLevel: number) => {\n        if (userInfo.userID == userID) {\n          setSoundLevel(soundLevel);\n        }\n      }\n    );\n\n    return () => {\n      ZegoUIKitInternal.onSoundLevelUpdate(callbackID);\n    };\n  }, []);\n\n  return (\n    <View\n      style={\n        cstyle(audioViewBackgroudColor ? audioViewBackgroudColor : '#4A4B4D')\n          .container\n      }\n      onLayout={(event) => {\n        setDimensions({\n          width: event.nativeEvent.layout.width,\n          height: event.nativeEvent.layout.height,\n        });\n      }}\n    >\n      <ImageBackground\n        source={\n          audioViewBackgroudImage ? { uri: audioViewBackgroudImage } : require('../../internal/resources/transparent_200x300.png')\n        }\n        resizeMode=\"cover\"\n        style={[\n          styles.imgBackground,\n          // @ts-ignore\n          { justifyContent: flexStyle[avatarAlignment] },\n        ]}\n      >\n        {showSoundWave && soundLevel > 5 ? (\n          <View\n            style={\n              waveStyle(\n                (avatarSize\n                  ? avatarSize.width\n                  : defaultAvatarSizeRatio * dimensions.width) +\n                  0.04 * dimensions.width,\n                soundWaveColor,\n                1\n              ).circleWave\n            }\n          >\n            {soundLevel > 10 ? (\n              <View\n                style={\n                  waveStyle(\n                    (avatarSize\n                      ? avatarSize.width\n                      : defaultAvatarSizeRatio * dimensions.width) +\n                      0.06 * dimensions.width,\n                    soundWaveColor,\n                    0.6\n                  ).subCircleWave\n                }\n              />\n            ) : null}\n            {soundLevel > 15 ? (\n              <View\n                style={\n                  waveStyle(\n                    (avatarSize\n                      ? avatarSize.width\n                      : defaultAvatarSizeRatio * dimensions.width) +\n                      +0.08 * dimensions.width,\n                    soundWaveColor,\n                    0.3\n                  ).subCircleWave\n                }\n              />\n            ) : null}\n          </View>\n        ) : (\n          <View />\n        )}\n        <View\n          style={[\n            styles.avatar,\n            {\n              backgroundColor: avatarBackgroundColor,\n              width: avatarSize\n                ? avatarSize.width\n                : defaultAvatarSizeRatio * dimensions.width,\n            },\n          ]}\n        >\n          {\n            !avatarBuilder ?\n              (!avatar || isLoadError) ?\n                <Text style={styles.nameLabel}>{getShortName(userInfo.userName)}</Text> :\n                <Image \n                  style={{ width: '100%', height: '100%', resizeMode: 'contain' }}\n                  resizeMode=\"contain\"\n                  source={{ uri: avatar }}\n                  onLoadStart={() =>  zloginfo('avatar onLoadStart')}\n                  onLoadEnd={() =>  zloginfo('avatar onLoadEnd')}\n                  onError={() =>  { zloginfo('avatar onError'); setIsLoadError(true);}}\n                  onLoad={() =>  { zloginfo('avatar onLoad'); setIsLoadError(false);}}\n                />\n              : <View style={{ width: '100%', height: '100%', alignItems: 'center', justifyContent: 'center', }}>\n                {\n                  (!avatar || isLoadError) ? <Text style={styles.nameLabel}>{getShortName(userInfo.userName)}</Text> : null\n                }\n                <Delegate\n                  to={avatarBuilder}\n                  props={{ userInfo: userInfo }}\n                />\n              </View>\n          }\n        </View>\n      </ImageBackground>\n    </View>\n  );\n}\n\nconst cstyle = (bgColor: string) =>\n  StyleSheet.create({\n    container: {\n      flex: 1,\n      width: '100%',\n      height: '100%',\n      position: 'absolute',\n      justifyContent: 'center',\n      backgroundColor: bgColor,\n    },\n  });\nconst waveStyle = (w: number, color: string, opacity: number) =>\n  StyleSheet.create({\n    circleWave: {\n      flex: 1,\n      position: 'absolute',\n      alignSelf: 'center',\n      width: w, //((w / 375) * 100).toString() + '%',\n      aspectRatio: 1,\n      borderRadius: 1000,\n      backgroundColor: color,\n      opacity: opacity,\n      zIndex: 0,\n      justifyContent: 'center',\n      alignContent: 'center',\n    },\n    subCircleWave: {\n      flex: 1,\n      position: 'absolute',\n      alignSelf: 'center',\n      width: w, //((w / 164) * 100).toString() + '%',\n      aspectRatio: 1,\n      borderRadius: 1000,\n      backgroundColor: color,\n      opacity: opacity,\n      zIndex: 0,\n    },\n  });\nconst styles = StyleSheet.create({\n  imgBackground: {\n    flex: 1,\n    width: '100%',\n    height: '100%',\n    position: 'absolute',\n  },\n  avatar: {\n    flex: 1,\n    marginTop: 1.5,\n    marginBottom: 1.5,\n    width: ((129 / 375) * 100).toString() + '%',\n    aspectRatio: 1,\n    borderRadius: 1000,\n    position: 'absolute',\n    alignSelf: 'center',\n    alignItems: 'center',\n    justifyContent: 'center',\n    zIndex: 2,\n    overflow: 'hidden',\n  },\n  nameLabel: {\n    flex: 1,\n    position: 'absolute',\n    color: '#222222',\n    fontSize: 22,\n  },\n});\n"],"mappings":"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","ignoreList":[]}