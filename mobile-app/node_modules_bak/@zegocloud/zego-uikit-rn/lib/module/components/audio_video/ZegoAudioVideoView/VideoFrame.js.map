{"version":3,"names":["React","useCallback","useEffect","useRef","findNodeHandle","View","StyleSheet","ZegoExpressEngine","ZegoTextureView","ZegoUIKitInternal","zloginfo","VideoFrame","props","userID","roomID","fillMode","isPictureInPicture","isScreenShare","textureViewRef","textureViewID","updateRenderingProperty","appOrientation","user","getUser","newFillMode","Number","isLandscape","undefined","onTextureLayout","event","width","height","nativeEvent","layout","instance","error","callbackID","String","Math","floor","random","current","onSDKConnected","onUserJoin","userInfoList","forEach","onVideoViewForceRender","createElement","style","styles","container","videoContainer","ref","collapsable","onLayout","audioContainer","children","create","flex","position","top","left","zIndex"],"sources":["VideoFrame.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useRef } from \"react\";\nimport { findNodeHandle, LayoutChangeEvent, View, StyleSheet } from \"react-native\";\nimport ZegoExpressEngine, { ZegoTextureView } from 'zego-express-engine-reactnative';\nimport ZegoUIKitInternal from \"../../internal/ZegoUIKitInternal\";\nimport { zloginfo } from \"../../../utils/logger\";\n\nexport default function VideoFrame(props: any) {\n    const { userID, roomID, fillMode, isPictureInPicture, isScreenShare } = props;\n    const textureViewRef = useRef(null);\n    let textureViewID = -1;\n\n    const updateRenderingProperty = () => {\n        zloginfo(`[VideoFrame][updateRenderingProperty] isPictureInPicture: ${isPictureInPicture}`);\n        const appOrientation = ZegoUIKitInternal.appOrientation();\n        const user = ZegoUIKitInternal.getUser(userID);\n        var newFillMode = fillMode;\n        if (isPictureInPicture && user) {\n          newFillMode = appOrientation === 0 ? Number(!user.isLandscape) : Number(user.isLandscape);\n        }\n        ZegoUIKitInternal.updateRenderingProperty(userID, textureViewID, undefined, newFillMode, isScreenShare);\n    }\n\n    const onTextureLayout = useCallback((event: LayoutChangeEvent) => {\n        const { width, height } = event.nativeEvent.layout;\n        zloginfo(`[VideoFrame][onTextureLayout] userID: ${userID}, textureViewID: ${textureViewID}, width: ${width}, height: ${height}`)\n\n        if (width > 0 || height > 0) {\n            try {\n                ZegoExpressEngine.instance\n                updateRenderingProperty();\n            } catch (error) {\n            }\n        } else {\n            // for FloatingMinimizedView\n            ZegoUIKitInternal.updateRenderingProperty(userID, -1, textureViewID, fillMode, isScreenShare);\n        }\n    }, []);\n\n    useEffect(() => {\n        const callbackID = 'VideoFrame' + userID + String(Math.floor(Math.random() * 10000));\n        textureViewID = findNodeHandle(textureViewRef.current)\n        zloginfo(`[VideoFrame] useEffect, userID: ${userID}, viewID: ${textureViewID}, callbackID: ${callbackID}`)\n\n        ZegoUIKitInternal.onSDKConnected(callbackID, () => {\n            updateRenderingProperty();\n        });\n        ZegoUIKitInternal.onUserJoin(callbackID, (userInfoList: any[]) => {\n            userInfoList.forEach(user => {\n                if (user.userID == userID) {\n                    updateRenderingProperty()\n                }\n            })\n        });\n        ZegoUIKitInternal.onVideoViewForceRender(callbackID, () => {\n            updateRenderingProperty();\n        });\n        return () => {\n            zloginfo(`[VideoFrame] useEffect return, viewID: ${textureViewID}`)\n\n            ZegoUIKitInternal.onSDKConnected(callbackID);\n            ZegoUIKitInternal.onUserJoin(callbackID);\n            ZegoUIKitInternal.onVideoViewForceRender(callbackID);\n            // for normal view\n            ZegoUIKitInternal.updateRenderingProperty(userID, -1, textureViewID, fillMode, isScreenShare);\n        }\n    }, []);\n\n    return (\n        <View style={styles.container}>\n            <ZegoTextureView\n                // @ts-ignore\n                style={styles.videoContainer}\n                ref={textureViewRef}\n                collapsable={false}\n                onLayout={onTextureLayout}\n            />\n            <View style={styles.audioContainer}>\n                {props.children}\n            </View>\n        </View>\n    );\n}\n\n\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n        width: '100%',\n        height: '100%',\n        position: 'absolute',\n    },\n    videoContainer: {\n        // flex: 1,\n        width: '100%',\n        height: '100%',\n        top: 0,\n        left: 0,\n        position: 'absolute',\n        zIndex: 1,\n    },\n    audioContainer: {\n        width: '100%',\n        height: '100%',\n        top: 0,\n        left: 0,\n        position: 'absolute',\n        zIndex: 2,\n    }\n});"],"mappings":"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","ignoreList":[]}